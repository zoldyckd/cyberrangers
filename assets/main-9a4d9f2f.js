class Y{constructor(t){this.properties=t??[]}get(t){const n=this.properties.filter(o=>o.name===t).map(o=>o.value);if(n.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(n.length!==0)return n[0]}getString(t){return this.getByType(t,"string")}getNumber(t){return this.getByType(t,"number")}getBoolean(t){return this.getByType(t,"boolean")}getByType(t,n){const o=this.get(t);if(o!==void 0){if(n!=="json"&&typeof o!==n)throw new Error('Expected property "'+t+'" to have type "'+n+'"');return o}}mustGetString(t){return this.mustGetByType(t,"string")}mustGetNumber(t){return this.mustGetByType(t,"number")}mustGetBoolean(t){return this.mustGetByType(t,"boolean")}mustGetByType(t,n){const o=this.get(t);if(o===void 0)throw new Error('Property "'+t+'" is missing');if(n!=="json"&&typeof o!==n)throw new Error('Expected property "'+t+'" to have type "'+n+'"');return o}getType(t){const n=this.properties.filter(o=>o.name===t).map(o=>o.type);if(n.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(n.length!==0)return n[0]}}const De="https://unpkg.com/@workadventure/scripting-api-extra@1.9.10/dist";class Xe{constructor(t){this.name=t.name,this.x=t.x,this.y=t.y,this.properties=new Y(t.properties)}get isReadable(){const t=this.properties.getString("readableBy");return t?WA.player.tags.includes(t):!0}get isWritable(){const t=this.properties.getString("writableBy");return t?WA.player.tags.includes(t):!0}}function Ae(e){const t=e?"#"+e.join():"";WA.nav.openCoWebSite(De+"/configuration.html"+t,!0)}async function Je(e,t){const n=await WA.room.getTiledMap(),o=new Map;return Ve(n.layers,o,e,t),o}function Ve(e,t,n,o){for(const r of e)if(r.type==="objectgroup"){for(const i of r.objects)if(i.type==="variable"||i.class==="variable"){if(n&&r.name!==n||o&&!o.includes(i.name))continue;t.set(i.name,new Xe(i))}}else r.type==="group"&&Ve(r.layers,t,n,o)}let ie;async function J(){return ie===void 0&&(ie=Ze()),ie}async function Ze(){return $e(await WA.room.getTiledMap())}function $e(e){const t=new Map;return He(e.layers,"",t),t}function He(e,t,n){for(const o of e)o.type==="group"?He(o.layers,t+o.name+"/",n):(o.name=t+o.name,n.set(o.name,o))}async function Ye(){const e=await J(),t=[];for(const n of e.values())if(n.type==="objectgroup")for(const o of n.objects)(o.type==="area"||o.class==="area")&&t.push(o);return t}function et(e){let t=1/0,n=1/0,o=0,r=0;const i=e.data;if(typeof i=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let s=0;s<e.height;s++)for(let a=0;a<e.width;a++)i[a+s*e.width]!==0&&(t=Math.min(t,a),r=Math.max(r,a),n=Math.min(n,s),o=Math.max(o,s));return{top:n,left:t,right:r+1,bottom:o+1}}function Qe(e){let t=1/0,n=1/0,o=0,r=0;for(const i of e){const s=et(i);s.left<t&&(t=s.left),s.top<n&&(n=s.top),s.right>r&&(r=s.right),s.bottom>o&&(o=s.bottom)}return{top:n,left:t,right:r,bottom:o}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var tt=Object.prototype.toString,K=Array.isArray||function(t){return tt.call(t)==="[object Array]"};function ye(e){return typeof e=="function"}function nt(e){return K(e)?"array":typeof e}function se(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function ve(e,t){return e!=null&&typeof e=="object"&&t in e}function ot(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var rt=RegExp.prototype.test;function it(e,t){return rt.call(e,t)}var st=/\S/;function at(e){return!it(st,e)}var ct={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function ut(e){return String(e).replace(/[&<>"'`=\/]/g,function(n){return ct[n]})}var lt=/\s*/,pt=/\s+/,we=/\s*=/,ft=/\s*\}/,ht=/#|\^|\/|>|\{|&|=|!/;function dt(e,t){if(!e)return[];var n=!1,o=[],r=[],i=[],s=!1,a=!1,c="",l=0;function f(){if(s&&!a)for(;i.length;)delete r[i.pop()];else i=[];s=!1,a=!1}var y,k,$;function q(E){if(typeof E=="string"&&(E=E.split(pt,2)),!K(E)||E.length!==2)throw new Error("Invalid tags: "+E);y=new RegExp(se(E[0])+"\\s*"),k=new RegExp("\\s*"+se(E[1])),$=new RegExp("\\s*"+se("}"+E[1]))}q(t||g.tags);for(var p=new Z(e),S,u,m,F,ee,C;!p.eos();){if(S=p.pos,m=p.scanUntil(y),m)for(var re=0,ze=m.length;re<ze;++re)F=m.charAt(re),at(F)?(i.push(r.length),c+=F):(a=!0,n=!0,c+=" "),r.push(["text",F,S,S+1]),S+=1,F===`
`&&(f(),c="",l=0,n=!1);if(!p.scan(y))break;if(s=!0,u=p.scan(ht)||"name",p.scan(lt),u==="="?(m=p.scanUntil(we),p.scan(we),p.scanUntil(k)):u==="{"?(m=p.scanUntil($),p.scan(ft),p.scanUntil(k),u="&"):m=p.scanUntil(k),!p.scan(k))throw new Error("Unclosed tag at "+p.pos);if(u==">"?ee=[u,m,S,p.pos,c,l,n]:ee=[u,m,S,p.pos],l++,r.push(ee),u==="#"||u==="^")o.push(ee);else if(u==="/"){if(C=o.pop(),!C)throw new Error('Unopened section "'+m+'" at '+S);if(C[1]!==m)throw new Error('Unclosed section "'+C[1]+'" at '+S)}else u==="name"||u==="{"||u==="&"?a=!0:u==="="&&q(m)}if(f(),C=o.pop(),C)throw new Error('Unclosed section "'+C[1]+'" at '+p.pos);return yt(gt(r))}function gt(e){for(var t=[],n,o,r=0,i=e.length;r<i;++r)n=e[r],n&&(n[0]==="text"&&o&&o[0]==="text"?(o[1]+=n[1],o[3]=n[3]):(t.push(n),o=n));return t}function yt(e){for(var t=[],n=t,o=[],r,i,s=0,a=e.length;s<a;++s)switch(r=e[s],r[0]){case"#":case"^":n.push(r),o.push(r),n=r[4]=[];break;case"/":i=o.pop(),i[5]=r[2],n=o.length>0?o[o.length-1][4]:t;break;default:n.push(r)}return t}function Z(e){this.string=e,this.tail=e,this.pos=0}Z.prototype.eos=function(){return this.tail===""};Z.prototype.scan=function(t){var n=this.tail.match(t);if(!n||n.index!==0)return"";var o=n[0];return this.tail=this.tail.substring(o.length),this.pos+=o.length,o};Z.prototype.scanUntil=function(t){var n=this.tail.search(t),o;switch(n){case-1:o=this.tail,this.tail="";break;case 0:o="";break;default:o=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=o.length,o};function Q(e,t){this.view=e,this.cache={".":this.view},this.parent=t}Q.prototype.push=function(t){return new Q(t,this)};Q.prototype.lookup=function(t){var n=this.cache,o;if(n.hasOwnProperty(t))o=n[t];else{for(var r=this,i,s,a,c=!1;r;){if(t.indexOf(".")>0)for(i=r.view,s=t.split("."),a=0;i!=null&&a<s.length;)a===s.length-1&&(c=ve(i,s[a])||ot(i,s[a])),i=i[s[a++]];else i=r.view[t],c=ve(r.view,t);if(c){o=i;break}r=r.parent}n[t]=o}return ye(o)&&(o=o.call(this.view)),o};function d(){this.templateCache={_cache:{},set:function(t,n){this._cache[t]=n},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}d.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};d.prototype.parse=function(t,n){var o=this.templateCache,r=t+":"+(n||g.tags).join(":"),i=typeof o<"u",s=i?o.get(r):void 0;return s==null&&(s=dt(t,n),i&&o.set(r,s)),s};d.prototype.render=function(t,n,o,r){var i=this.getConfigTags(r),s=this.parse(t,i),a=n instanceof Q?n:new Q(n,void 0);return this.renderTokens(s,a,o,t,r)};d.prototype.renderTokens=function(t,n,o,r,i){for(var s="",a,c,l,f=0,y=t.length;f<y;++f)l=void 0,a=t[f],c=a[0],c==="#"?l=this.renderSection(a,n,o,r,i):c==="^"?l=this.renderInverted(a,n,o,r,i):c===">"?l=this.renderPartial(a,n,o,i):c==="&"?l=this.unescapedValue(a,n):c==="name"?l=this.escapedValue(a,n,i):c==="text"&&(l=this.rawValue(a)),l!==void 0&&(s+=l);return s};d.prototype.renderSection=function(t,n,o,r,i){var s=this,a="",c=n.lookup(t[1]);function l(k){return s.render(k,n,o,i)}if(c){if(K(c))for(var f=0,y=c.length;f<y;++f)a+=this.renderTokens(t[4],n.push(c[f]),o,r,i);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")a+=this.renderTokens(t[4],n.push(c),o,r,i);else if(ye(c)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(n.view,r.slice(t[3],t[5]),l),c!=null&&(a+=c)}else a+=this.renderTokens(t[4],n,o,r,i);return a}};d.prototype.renderInverted=function(t,n,o,r,i){var s=n.lookup(t[1]);if(!s||K(s)&&s.length===0)return this.renderTokens(t[4],n,o,r,i)};d.prototype.indentPartial=function(t,n,o){for(var r=n.replace(/[^ \t]/g,""),i=t.split(`
`),s=0;s<i.length;s++)i[s].length&&(s>0||!o)&&(i[s]=r+i[s]);return i.join(`
`)};d.prototype.renderPartial=function(t,n,o,r){if(o){var i=this.getConfigTags(r),s=ye(o)?o(t[1]):o[t[1]];if(s!=null){var a=t[6],c=t[5],l=t[4],f=s;c==0&&l&&(f=this.indentPartial(s,l,a));var y=this.parse(f,i);return this.renderTokens(y,n,o,f,r)}}};d.prototype.unescapedValue=function(t,n){var o=n.lookup(t[1]);if(o!=null)return o};d.prototype.escapedValue=function(t,n,o){var r=this.getConfigEscape(o)||g.escape,i=n.lookup(t[1]);if(i!=null)return typeof i=="number"&&r===g.escape?String(i):r(i)};d.prototype.rawValue=function(t){return t[1]};d.prototype.getConfigTags=function(t){return K(t)?t:t&&typeof t=="object"?t.tags:void 0};d.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!K(t))return t.escape};var g={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){X.templateCache=e},get templateCache(){return X.templateCache}},X=new d;g.clearCache=function(){return X.clearCache()};g.parse=function(t,n){return X.parse(t,n)};g.render=function(t,n,o,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+nt(t)+'" was given as the first argument for mustache#render(template, view, partials)');return X.render(t,n,o,r)};g.escape=ut;g.Scanner=Z;g.Context=Q;g.Writer=d;class Ke{constructor(t,n){this.template=t,this.state=n,this.ast=g.parse(t)}getValue(){return this.value===void 0&&(this.value=g.render(this.template,this.state)),this.value}onChange(t){const n=[];for(const o of this.getUsedVariables().values())n.push(this.state.onVariableChange(o).subscribe(()=>{const r=g.render(this.template,this.state);r!==this.value&&(this.value=r,t(this.value))}));return{unsubscribe:()=>{for(const o of n)o.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const t=new Set;return this.recursiveGetUsedVariables(this.ast,t),t}recursiveGetUsedVariables(t,n){for(const o of t){const r=o[0],i=o[1],s=o[4];["name","&","#","^"].includes(r)&&n.add(i),s!==void 0&&typeof s!="string"&&this.recursiveGetUsedVariables(s,n)}}}async function mt(){var e;const t=await Ye();for(const n of t){const o=(e=n.properties)!==null&&e!==void 0?e:[];for(const r of o){if(r.type==="int"||r.type==="bool"||r.type==="object"||typeof r.value!="string")continue;const i=new Ke(r.value,WA.state);if(i.isPureString())continue;const s=i.getValue();await We(n.name,r.name,s),i.onChange(async a=>{await We(n.name,r.name,a)})}}}async function bt(){var e;const t=await J();for(const[n,o]of t.entries())if(o.type!=="objectgroup"){const r=(e=o.properties)!==null&&e!==void 0?e:[];for(const i of r){if(i.type==="int"||i.type==="bool"||i.type==="object"||typeof i.value!="string")continue;const s=new Ke(i.value,WA.state);if(s.isPureString())continue;const a=s.getValue();Pe(n,i.name,a),s.onChange(c=>{Pe(n,i.name,c)})}}}async function We(e,t,n){console.log(e),(await WA.room.area.get(e)).setProperty(t,n)}function Pe(e,t,n){WA.room.setProperty(e,t,n),t==="visible"&&(n?WA.room.showLayer(e):WA.room.hideLayer(e))}const At="https://admin.workadventu.re/html";let he,me=0,be=0;function ke(e){if(WA.state[e.name]){let t=e.properties.mustGetString("openLayer");for(const n of t.split(`
`))WA.room.showLayer(n);t=e.properties.mustGetString("closeLayer");for(const n of t.split(`
`))WA.room.hideLayer(n)}else{let t=e.properties.mustGetString("openLayer");for(const n of t.split(`
`))WA.room.hideLayer(n);t=e.properties.mustGetString("closeLayer");for(const n of t.split(`
`))WA.room.showLayer(n)}}function vt(e){const t=e.properties.getString("openSound"),n=e.properties.getNumber("soundRadius");let o=1;if(n){const r=Fe(e.properties.mustGetString("openLayer").split(`
`));if(r>n)return;o=1-r/n}t&&WA.sound.loadSound(t).play({volume:o})}function wt(e){const t=e.properties.getString("closeSound"),n=e.properties.getNumber("soundRadius");let o=1;if(n){const r=Fe(e.properties.mustGetString("closeLayer").split(`
`));if(r>n)return;o=1-r/n}t&&WA.sound.loadSound(t).play({volume:o})}function qe(e){return e.map(t=>he.get(t)).filter(t=>(t==null?void 0:t.type)==="tilelayer")}function Fe(e){const t=qe(e),n=Qe(t),o=((n.right-n.left)/2+n.left)*32,r=((n.bottom-n.top)/2+n.top)*32;return Math.sqrt(Math.pow(me-o,2)+Math.pow(be-r,2))}function Wt(e){WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]?vt(e):wt(e),ke(e)}),ke(e)}function Se(e,t,n,o){const r=e.name;let i,s,a=!1;const c=n.getString("tag");let l=!0;c&&!WA.player.tags.includes(c)&&(l=!1);const f=!!c;function y(){var u;i&&i.remove(),i=WA.ui.displayActionMessage({message:(u=n.getString("closeTriggerMessage"))!==null&&u!==void 0?u:"Press SPACE to close the door",callback:()=>{WA.state[t.name]=!1,k()}})}function k(){var u;i&&i.remove(),i=WA.ui.displayActionMessage({message:(u=n.getString("openTriggerMessage"))!==null&&u!==void 0?u:"Press SPACE to open the door",callback:()=>{WA.state[t.name]=!0,y()}})}function $(){let u;if(e.type==="tilelayer")u=Qe(qe(t.properties.mustGetString("closeLayer").split(`
`)));else{if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)throw new Error(`Doorstep zone "${e.name}" is missing x, y, width or height`);u={top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}s=WA.room.website.create({name:"doorKeypad"+r,url:o+"/keypad.html#"+encodeURIComponent(r),position:{x:u.right*32,y:u.top*32,width:32*3,height:32*4},allowApi:!0})}function q(){s&&(WA.room.website.delete(s.name),s=void 0)}function p(){if(a=!0,n.getBoolean("autoOpen")&&l){WA.state[t.name]=!0;return}if(!WA.state[t.name]&&(f&&!l||!f)&&(n.getString("code")||n.getString("codeVariable"))){$();return}l&&(WA.state[t.name]?y():k())}function S(){a=!1,n.getBoolean("autoClose")&&(WA.state[t.name]=!1),i&&i.remove(),q()}e.type==="tilelayer"?(WA.room.onEnterLayer(r).subscribe(p),WA.room.onLeaveLayer(r).subscribe(S)):(WA.room.area.onEnter(r).subscribe(p),WA.room.area.onLeave(r).subscribe(S)),WA.state.onVariableChange(t.name).subscribe(()=>{a&&(!n.getBoolean("autoClose")&&WA.state[t.name]===!0&&y(),s&&WA.state[t.name]===!0&&q(),!n.getBoolean("autoOpen")&&WA.state[t.name]===!1&&k())})}function Pt(e){const t=e.properties.mustGetString("bellSound"),n=e.properties.getNumber("soundRadius");let o=1;if(n){const r=Math.sqrt(Math.pow(e.x-me,2)+Math.pow(e.y-be,2));if(r>n)return;o=1-r/n}WA.sound.loadSound(t).play({volume:o})}function kt(e){WA.state[e.name]===void 0&&(WA.state[e.name]=0),WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]&&Pt(e)})}function Ee(e,t,n){let o;const r=t.getString("bellPopup");if(n.type==="tilelayer"){const i=n.name;WA.room.onEnterLayer(i).subscribe(()=>{var s;r?o=WA.ui.openPopup(r,"",[{label:(s=t.getString("bellButtonText"))!==null&&s!==void 0?s:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.onLeaveLayer(i).subscribe(()=>{o&&(o.close(),o=void 0)})}else{const i=n.name;WA.room.area.onEnter(i).subscribe(()=>{var s;r?o=WA.ui.openPopup(r,"",[{label:(s=t.getString("bellButtonText"))!==null&&s!==void 0?s:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.area.onLeave(i).subscribe(()=>{o&&(o.close(),o=void 0)})}}async function St(e){e=e??At;const t=await Je();he=await J();for(const n of t.values())n.properties.get("door")&&Wt(n),n.properties.get("bell")&&kt(n);for(const n of he.values()){const o=new Y(n.properties),r=o.getString("doorVariable");if(r&&n.type==="tilelayer"){const s=t.get(r);if(s===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of layer "'+n.name+'"');Se(n,s,o,e)}const i=o.getString("bellVariable");i&&n.type==="tilelayer"&&Ee(i,o,n)}for(const n of await Ye()){const o=new Y(n.properties),r=o.getString("doorVariable");if(r){const s=t.get(r);if(s===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of object "'+n.name+'"');Se(n,s,o,e)}const i=o.getString("bellVariable");i&&Ee(i,o,n)}WA.player.onPlayerMove(n=>{me=n.x,be=n.y})}function Et(e,t){const n=e.getString("bindVariable");if(n){const o=e.get("enterValue"),r=e.get("leaveValue"),i=e.getString("triggerMessage"),s=e.getString("tag");Ct(n,t,o,r,i,s)}}let te;function Ct(e,t,n,o,r,i){i&&!WA.player.tags.includes(i)||(n!==void 0&&WA.room.onEnterLayer(t).subscribe(()=>{r?te=WA.ui.displayActionMessage({type:"message",message:r,callback:()=>{WA.state[e]=n}}):WA.state[e]=n}),o!==void 0&&WA.room.onLeaveLayer(t).subscribe(()=>{WA.state[e]=o,te&&(te.remove().catch(s=>{console.error(s)}),te=void 0)}))}async function Mt(){const e=await J();for(const t of e.values()){const n=new Y(t.properties);Et(n,t.name)}}let Ce;async function Lt(e){const t=await WA.room.getTiledMap();e=e??De,Ce=await J();const n=t.layers.find(o=>o.name==="configuration");if(n){const r=new Y(n.properties).getString("tag");(!r||WA.player.tags.includes(r))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(e+"/configuration.html",!0)});for(const i of Ce.values()){const s=new Y(i.properties),a=s.getString("openConfig");a&&i.type==="tilelayer"&&Tt(a.split(","),i.name,s)}}}function Tt(e,t,n){let o;const r=n.getString("openConfigAdminTag");let i=!0;r&&!WA.player.tags.includes(r)&&(i=!1);function s(){var c;o&&o.remove(),o=WA.ui.displayActionMessage({message:(c=n.getString("openConfigTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE or touch here to configure",callback:()=>Ae(e)})}function a(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(t).subscribe(()=>{const c=n.getString("openConfigTrigger");i&&(c&&c==="onaction"?s():Ae(e))}),WA.room.onLeaveLayer(t).subscribe(()=>{o&&o.remove(),a()})}function It(){return WA.onInit().then(()=>{St().catch(e=>console.error(e)),Mt().catch(e=>console.error(e)),Lt().catch(e=>console.error(e)),bt().catch(e=>console.error(e)),mt().catch(e=>console.error(e))}).catch(e=>console.error(e))}let _;function Rt(){WA.room.area.onEnter("clock").subscribe(()=>{const e=new Date,t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");_&&_.close(),_=WA.ui.openPopup("clockPopup",`It's ${t}:${n}`,[])}),WA.room.area.onLeave("clock").subscribe(()=>{_&&(_.close(),_=void 0)})}let ne;function _t(){const e=()=>{ne&&(ne.close(),ne=void 0)};WA.room.area.onEnter("board").subscribe(()=>{e();const t="The bulletin board hums with strange energy. Five portals shimmer before you—choose your path: 💜 Malware — malicious code that corrupts, spies, and destroys • 🔵 Phishing/Quishing — fake messages or QR Codes that trick you into giving secrets • 🔴 Identity Theft — criminals using your identity • 🟡 xxxxxxxxxxxx • 💚 Password Security — strong, unique passwords and MFA to protect your accounts.";ne=WA.ui.openPopup("boardPopup",t,[])}),WA.room.area.onLeave("board").subscribe(e)}let G;function ae(){var e;if(G){try{(e=G.close)==null||e.call(G)}catch{}G=void 0}}function Bt(){var e,t;try{const n=(t=(e=WA.room.object)==null?void 0:e.get)==null?void 0:t.call(e,"MarvieZone");if(n&&n.properties){const o=n.properties;if(Array.isArray(o)){const r=o.find(i=>i.name==="marvieMessage"||i.name==="marviePopup");if(r!=null&&r.value)return String(r.value)}else if(o.marvieMessage)return String(o.marvieMessage)}}catch{}return["👋 Hi — I'm Marvie.","","Welcome to the Room of Malware.","Do you think you can find the 3 easter eggs around the map?","Tip: Check the walls, the chairs or the floor for suspicious objects."].join(`
`)}function xt(){console.log("[Marvie] init"),WA.room.area.onEnter("MarvieZone").subscribe(()=>{ae();const e=Bt();G=WA.ui.openPopup("marviePopup",e,[{label:"Got it",callback:()=>ae()}])}),WA.room.area.onLeave("MarvieZone").subscribe(()=>{ae()})}const Nt={library:{tasks:[{key:"phishing_SMSphishing",label:"SMS",area:"phishing_SMSphishing"},{key:"phishing_MurdochEmail",label:"MurdochEmail",area:"phishing_MurdochEmail"},{key:"phishing_QRcode",label:"QRcode",area:"phishing_QRcode"},{key:"phishing_Brock",label:"Brock",area:"phishing_Brock"}],exitGate:{area:"to-canteen",nextRoom:"canteen.tmj#from-library"}},canteen:{tasks:[{key:"malware_instructions",label:"Slides",area:"malware_instructions"}]}};let V={},H=[],Me=0;function Ot(){WA.onInit().then(async()=>{const e=await Ut(),t=Nt[e];if(!t){console.log("[ProgressChecker] No config for map:",e);return}console.log("[ProgressChecker] Init for map:",e),H=t.tasks,V=Object.fromEntries(H.map(n=>[n.key,!1])),H.forEach(n=>{try{WA.room.area.onEnter(n.area).subscribe(()=>{V[n.key]||(V[n.key]=!0,Le())})}catch(o){console.warn(`[ProgressChecker] area '${n.area}' not found on map '${e}'`,o)}}),t.exitGate&&WA.room.area.onEnter(t.exitGate.area).subscribe(()=>{var n;if(Gt())setTimeout(()=>WA.nav.goToRoom(t.exitGate.nextRoom),30);else{const o=jt();if((n=t.exitGate)!=null&&n.warnAnchorId)try{WA.ui.openPopup(t.exitGate.warnAnchorId,`🚧 Hold up!

You still need to complete:
• ${o.join(`
• `)}

Find all tasks in this room before leaving.`,[{label:"OK",className:"primary",callback:r=>r.close()}]);return}catch{}WA.ui.displayActionMessage({message:`🚧 Hold up! Missing: ${o.join(", ")}`,callback:()=>{}})}}),setTimeout(Le,300)})}function Gt(){return H.every(e=>V[e.key])}function jt(){return H.filter(e=>!V[e.key]).map(e=>e.label)}function Le(){const e=Date.now();if(e-Me<150)return;Me=e;const t=H.map(n=>V[n.key]?`✅ ${n.label}`:`⬜ ${n.label}`).join("   ");WA.ui.displayActionMessage({message:`Progress:  ${t}`,callback:()=>{}})}async function Ut(){var e,t,n;try{const o=decodeURIComponent(location.href).match(/\/([^\/?#]+)\.tmj/i);if(o!=null&&o[1])return o[1].toLowerCase()}catch{}try{const o=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),r=o==null?void 0:o.properties,i=(n=r==null?void 0:r.find(s=>(s==null?void 0:s.name)==="mapId"))==null?void 0:n.value;if(typeof i=="string"&&i.trim())return i.trim().toLowerCase()}catch{}return""}let M;const Te="phishing_QRcode",Dt="phishing_QRcodePopup";function Vt(){WA.onInit().then(()=>{WA.room.area.onEnter(Te).subscribe(()=>{ce(),M=WA.ui.openPopup(Dt,"🍗 You spot a poster in the library:“FREE NUGGETS FOR LIFE – Scan Me!” Your friend insists it looks real, but scanning random QR codes can lead to fake websites or data theft. What would you do? Press SPACE to help!",[{label:"Got it",callback:()=>ce()}])}),WA.room.area.onLeave(Te).subscribe(()=>{ce()})})}function ce(){var e;try{M&&((e=M.close)==null||e.call(M),M=void 0)}catch{M=void 0}}let L;const Ie="phishing_MurdochEmail",Ht="phishing_MurdochEmailPopup";function Yt(){WA.onInit().then(()=>{WA.room.area.onEnter(Ie).subscribe(()=>{ue(),L=WA.ui.openPopup(Ht,`📧 You received an email: “Your university fees are overdue. Click here to pay immediately.”

⚠️ This looks suspicious... What would you do? Press SPACE to help!`,[{label:"Got it",callback:()=>ue()}])}),WA.room.area.onLeave(Ie).subscribe(()=>{ue()})})}function ue(){var e;try{L&&((e=L.close)==null||e.call(L),L=void 0)}catch{L=void 0}}let T;const Re="phishing_SMSphishing",Qt="phishing_SMSphishingPopup";function Kt(){WA.onInit().then(()=>{WA.room.area.onEnter(Re).subscribe(()=>{le(),T=WA.ui.openPopup(Qt,"🔗 You received a message: “Your Murdoch account needs verification! Click here: https://tinyurl.com/murdoch-reset. Shortened links can hide where they actually lead. Always check the real destination before clicking! What would you do? Press SPACE to help!",[{label:"Got it",callback:()=>le()}])}),WA.room.area.onLeave(Re).subscribe(()=>{le()})})}function le(){var e;try{T&&((e=T.close)==null||e.call(T),T=void 0)}catch{T=void 0}}let j;function qt(){WA.onInit().then(()=>{console.log("[WA] Phishing sign instructions ready"),WA.room.area.onEnter("phishing_instructions").subscribe(()=>{Ft()}),WA.room.area.onLeave("phishing_instructions").subscribe(()=>{de()})})}function Ft(){de(),j=WA.ui.openPopup("phishing_instructionsPopup","🧑‍💻 Quick! We saw one of the hackers going through this room! They are using phishing emails and dodgy QR codes to endanger students on campus! Before you chase after him, you should read these slides to learn how you can defend against Phishing.  ",[{label:"Got it!",className:"primary",callback:()=>de()}])}function de(){var e;j&&((e=j.close)==null||e.call(j),j=void 0)}let b,A;function pe(){var e,t;try{(e=b==null?void 0:b.close)==null||e.call(b)}catch{}b=void 0;try{(t=A==null?void 0:A.unsubscribe)==null||t.call(A)}catch{}A=void 0}function _e(){var e,t;try{(e=b==null?void 0:b.close)==null||e.call(b)}catch{}b=WA.ui.openPopup("phishing_librarySpawnPopup","📌 Please proceed and talk to Professor Byte.",[{label:"OK",callback:pe}]);try{(t=A==null?void 0:A.unsubscribe)==null||t.call(A)}catch{}A=WA.room.area.onLeave("from-garden").subscribe(pe),setTimeout(()=>{pe()},5e3)}function zt(){WA.onInit().then(()=>{WA.room.area.onEnter("from-garden").subscribe(_e),setTimeout(()=>{WA.player.getPosition().then(()=>_e())},250)})}let oe;function Xt(){const e="phishing_BrockPopup",t=()=>{oe&&(oe.close(),oe=void 0)};WA.room.area.onEnter("phishing_Brock").subscribe(()=>{t();const n="🧑‍🏫 Brock: Hey there! Before you move on, have you checked out all the phishing clues? Make sure you’ve seen the email, QR code, and SMS examples — they’ll help you spot scams in the future!";oe=WA.ui.openPopup(e,n,[{label:"Got it!",callback:()=>t()}])}),WA.room.area.onLeave("phishing_Brock").subscribe(t)}let I,B,x,Be=!1;const xe="billboard",Jt="billboardPopup";function z(){var e;try{(e=I==null?void 0:I.close)==null||e.call(I)}catch{}I=void 0}function Zt(){Be||(Be=!0,WA.onInit().then(()=>{var e,t,n,o,r,i;try{(e=B==null?void 0:B.unsubscribe)==null||e.call(B)}catch{}try{(t=x==null?void 0:x.unsubscribe)==null||t.call(x)}catch{}B=WA.room.area.onEnter(xe).subscribe(()=>{console.log("[billboard] enter"),z(),I=WA.ui.openPopup(Jt,`📜 The community billboard

➡️ Move towards the ladder on the right and begin your adventure!`,[{label:"Close",className:"primary",callback:()=>z()}])}),x=WA.room.area.onLeave(xe).subscribe(()=>{console.log("[billboard] leave"),z()}),(i=(o=(n=WA.room).onLeaveLayer)==null?void 0:(r=o.call(n,"**")).subscribe)==null||i.call(r,()=>z()),window.addEventListener("blur",z)}))}let U;function $t(){WA.onInit().then(()=>{setTimeout(en,50)})}function en(){Ne(),U=WA.ui.openPopup("spawnIntroPopup","👋 Welcome! Use the Arrow Keys or WASD to move. Explore the map and look for Professor Byte for guidance. Tip: Walk close to objects (signs, boards, NPCs) to interact with them.",[{label:"Got it",className:"primary",callback:e=>{var t;try{(t=e.close)==null||t.call(e)}catch{}Ne()}}])}function Ne(){var e;if(U){try{(e=U.close)==null||e.call(U)}catch{}U=void 0}}let R,N,O,Oe=!1;const Ge="instructions",tn="instructionsPopup";function nn(){Oe||(Oe=!0,WA.onInit().then(()=>{var e,t;try{(e=N==null?void 0:N.unsubscribe)==null||e.call(N)}catch{}try{(t=O==null?void 0:O.unsubscribe)==null||t.call(O)}catch{}N=WA.room.area.onEnter(Ge).subscribe(()=>{fe(),R=WA.ui.openPopup(tn,"🏫 Thank the heavens you're here! Brave student, Murdoch University is under a Cyber Attack! We need your help to protect the school against evildoers who wish us harm. Please proceed through the school and learn about how you can help us!",[{label:"Close",className:"primary",callback:()=>fe()}])}),O=WA.room.area.onLeave(Ge).subscribe(()=>{fe()})}))}function fe(){var e;try{(e=R==null?void 0:R.close)==null||e.call(R)}catch{}R=void 0}const on="posterPopup";let v;function rn(e){var t;try{(t=v==null?void 0:v.close)==null||t.call(v)}catch{}v=WA.ui.openPopup(on,e,[])}function sn(){var e;try{(e=v==null?void 0:v.close)==null||e.call(v)}catch{}v=void 0}function an(){WA.room.area.onEnter("poster").subscribe(()=>{rn(`🪧 You notice a faded poster: "Think Before You Click! Your Cyber Kingdom Depends On It."

💭 You: (to yourself) 'Think before you click.' That's a good motto.

📢 Narrator: Always pause before clicking unknown links. Your vigilance protects your cyber kingdom!`)}),WA.room.area.onLeave("poster").subscribe(sn)}const cn="usbdrivePopup";let w;function un(e){var t;try{(t=w==null?void 0:w.close)==null||t.call(w)}catch{}w=WA.ui.openPopup(cn,e,[])}function ln(){var e;try{(e=w==null?void 0:w.close)==null||e.call(w)}catch{}w=void 0}function pn(){WA.room.area.onEnter("usbdrive").subscribe(()=>{un(`💾 You spot a random USB drive on the floor.

💭 You: Should I plug this into a PC and see what's inside?

📢 Narrator: Never plug in unknown USBs. They can hide malware that runs automatically. If you find one in real life, hand it to IT/Security instead of investigating it yourself.`)}),WA.room.area.onLeave("usbdrive").subscribe(ln)}const fn="stickynotePopup";let W;function hn(e){var t;try{(t=W==null?void 0:W.close)==null||t.call(W)}catch{}W=WA.ui.openPopup(fn,e,[])}function dn(){var e;try{(e=W==null?void 0:W.close)==null||e.call(W)}catch{}W=void 0}function gn(){WA.room.area.onEnter("stickynote").subscribe(()=>{hn(`📝 A sticky note is stuck to the monitor: “Email PW: P@ssw0rd123”.

💭 You: Wah… someone actually wrote their password here.

📢 Narrator: Don’t write passwords on paper or share them. Use a password manager, create unique passphrases, and always enable MFA (multi-factor authentication).`)}),WA.room.area.onLeave("stickynote").subscribe(dn)}const yn="instructions_safeinternetpracticesPopup";let P;function mn(e){var t;try{(t=P==null?void 0:P.close)==null||t.call(P)}catch{}P=WA.ui.openPopup(yn,e,[])}function bn(){var e;try{(e=P==null?void 0:P.close)==null||e.call(P)}catch{}P=void 0}function An(){WA.room.area.onEnter("instructions_safeinternetpractices").subscribe(()=>{mn(`🛡️ Welcome to the Safe Internet Practices office!

• Explore the room and look for hidden clues (poster, USB drive, sticky note).
• Read your character’s thoughts and the narrator’s tips.
• Learn to: think before you click, protect passwords, and avoid risky devices.

When you’re done, proceed to the exit to continue your mission.`)}),WA.room.area.onLeave("instructions_safeinternetpractices").subscribe(bn)}const h={poster:!1,usbdrive:!1,stickynote:!1,AmeliaZone:!1},vn="to-hall",wn="hall.tmj#from-canteen";function Wn(){WA.onInit().then(()=>{console.log("[OfficeProgress] ready"),["poster","usbdrive","stickynote"].forEach(e=>{WA.room.area.onEnter(e).subscribe(()=>{console.log(`[OfficeProgress] ENTER ${e}`),h[e]||(h[e]=!0,Ue())})}),WA.room.area.onEnter("AmeliaZone").subscribe(()=>{console.log("[OfficeProgress] ENTER AmeliaZone"),h.AmeliaZone||(h.AmeliaZone=!0,Ue())}),WA.room.area.onEnter(vn).subscribe(()=>{console.log("[OfficeProgress] ENTER EXIT, allDone =",je()),je()?WA.nav.goToRoom(wn):WA.ui.openPopup("safeinternet_gate_popup",`🚧 Hold up!

You still need to complete:
• ${Pn().join(`
• `)}

Find all 3 clues and talk to Amelia before leaving.`,[{label:"OK",className:"primary",callback:e=>e.close()}])})})}function je(){return h.poster&&h.usbdrive&&h.stickynote&&h.AmeliaZone}function Pn(){const e=[];return h.poster||e.push("Old Security Poster"),h.usbdrive||e.push("USB Drive"),h.stickynote||e.push("Sticky Note"),h.AmeliaZone||e.push("Talk to Amelia (NPC)"),e}function Ue(){const e=[h.poster?"✅ Poster":"⬜ Poster",h.usbdrive?"✅ USB":"⬜ USB",h.stickynote?"✅ Sticky":"⬜ Sticky Note",h.AmeliaZone?"✅ Amelia":"⬜ Amelia"].join("   ");WA.ui.displayActionMessage({message:`Progress: ${e}`,callback:()=>{}})}let D;function kn(){WA.onInit().then(()=>{console.log("[WA] Malware instructions ready"),WA.room.area.onEnter("malware_instructions").subscribe(()=>{Sn()}),WA.room.area.onLeave("malware_instructions").subscribe(()=>{ge()})})}function Sn(){ge(),D=WA.ui.openPopup("malware_instructionsPopup","🧑‍💻 Congratulations on clearing the first room! But we have a long way to go before we’re ready to really protect Murdoch... In this room, you’ll learn more about Malware and the best ways to protect against it. To begin, go through the slides by pressing SPACE.",[{label:"Got it!",className:"primary",callback:()=>ge()}])}function ge(){var e;if(D){try{(e=D.close)==null||e.call(D)}catch{}D=void 0}}console.log("Script started");WA.onInit().then(async()=>{console.log("Scripting API ready"),await It(),Rt(),_t(),xt(),Ot();const e=await En();console.log("[Router] mapId =",e||"(unknown)"),e==="garden"?(console.log("[Router] Initializing GARDEN features…"),Zt(),$t(),nn(),an(),pn(),gn(),An(),Wn()):e==="library"?(console.log("[Router] Initializing LIBRARY (Phishing) features…"),Vt(),Yt(),Kt(),qt(),zt(),Xt()):e==="canteen"?(console.log("[Router] Initializing CANTEEN (Malware) features…"),kn()):console.warn("[Router] Unknown map; only common features started. Set a Tiled Map Property `mapId` (string) to enable map-specific inits.")});async function En(){var e,t,n;try{const r=decodeURIComponent(window.location.href).match(/\/([^\/?#]+)\.tmj/i);if(r!=null&&r[1])return r[1].toLowerCase()}catch{}try{const o=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),r=((o==null?void 0:o.url)??(o==null?void 0:o.name)??"").toString();if(r){const a=(r.split("/").pop()||r).toLowerCase();return a.endsWith(".tmj")?a.replace(/\.tmj$/,""):a}const i=o==null?void 0:o.properties,s=(n=i==null?void 0:i.find(a=>(a==null?void 0:a.name)==="mapId"))==null?void 0:n.value;if(typeof s=="string"&&s.trim())return s.trim().toLowerCase()}catch{}return""}
//# sourceMappingURL=main-9a4d9f2f.js.map
