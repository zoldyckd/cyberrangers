class G{constructor(t){this.properties=t??[]}get(t){const n=this.properties.filter(o=>o.name===t).map(o=>o.value);if(n.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(n.length!==0)return n[0]}getString(t){return this.getByType(t,"string")}getNumber(t){return this.getByType(t,"number")}getBoolean(t){return this.getByType(t,"boolean")}getByType(t,n){const o=this.get(t);if(o!==void 0){if(n!=="json"&&typeof o!==n)throw new Error('Expected property "'+t+'" to have type "'+n+'"');return o}}mustGetString(t){return this.mustGetByType(t,"string")}mustGetNumber(t){return this.mustGetByType(t,"number")}mustGetBoolean(t){return this.mustGetByType(t,"boolean")}mustGetByType(t,n){const o=this.get(t);if(o===void 0)throw new Error('Property "'+t+'" is missing');if(n!=="json"&&typeof o!==n)throw new Error('Expected property "'+t+'" to have type "'+n+'"');return o}getType(t){const n=this.properties.filter(o=>o.name===t).map(o=>o.type);if(n.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(n.length!==0)return n[0]}}const Be="https://unpkg.com/@workadventure/scripting-api-extra@1.9.10/dist";class He{constructor(t){this.name=t.name,this.x=t.x,this.y=t.y,this.properties=new G(t.properties)}get isReadable(){const t=this.properties.getString("readableBy");return t?WA.player.tags.includes(t):!0}get isWritable(){const t=this.properties.getString("writableBy");return t?WA.player.tags.includes(t):!0}}function fe(e){const t=e?"#"+e.join():"";WA.nav.openCoWebSite(Be+"/configuration.html"+t,!0)}async function Ye(e,t){const n=await WA.room.getTiledMap(),o=new Map;return Ie(n.layers,o,e,t),o}function Ie(e,t,n,o){for(const r of e)if(r.type==="objectgroup"){for(const i of r.objects)if(i.type==="variable"||i.class==="variable"){if(n&&r.name!==n||o&&!o.includes(i.name))continue;t.set(i.name,new He(i))}}else r.type==="group"&&Ie(r.layers,t,n,o)}let te;async function K(){return te===void 0&&(te=Qe()),te}async function Qe(){return Ke(await WA.room.getTiledMap())}function Ke(e){const t=new Map;return Ne(e.layers,"",t),t}function Ne(e,t,n){for(const o of e)o.type==="group"?Ne(o.layers,t+o.name+"/",n):(o.name=t+o.name,n.set(o.name,o))}async function xe(){const e=await K(),t=[];for(const n of e.values())if(n.type==="objectgroup")for(const o of n.objects)(o.type==="area"||o.class==="area")&&t.push(o);return t}function qe(e){let t=1/0,n=1/0,o=0,r=0;const i=e.data;if(typeof i=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let s=0;s<e.height;s++)for(let a=0;a<e.width;a++)i[a+s*e.width]!==0&&(t=Math.min(t,a),r=Math.max(r,a),n=Math.min(n,s),o=Math.max(o,s));return{top:n,left:t,right:r+1,bottom:o+1}}function Oe(e){let t=1/0,n=1/0,o=0,r=0;for(const i of e){const s=qe(i);s.left<t&&(t=s.left),s.top<n&&(n=s.top),s.right>r&&(r=s.right),s.bottom>o&&(o=s.bottom)}return{top:n,left:t,right:r,bottom:o}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var Fe=Object.prototype.toString,D=Array.isArray||function(t){return Fe.call(t)==="[object Array]"};function le(e){return typeof e=="function"}function Xe(e){return D(e)?"array":typeof e}function ne(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function de(e,t){return e!=null&&typeof e=="object"&&t in e}function Ze(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var ze=RegExp.prototype.test;function Je(e,t){return ze.call(e,t)}var $e=/\S/;function et(e){return!Je($e,e)}var tt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function nt(e){return String(e).replace(/[&<>"'`=\/]/g,function(n){return tt[n]})}var ot=/\s*/,rt=/\s+/,ge=/\s*=/,it=/\s*\}/,st=/#|\^|\/|>|\{|&|=|!/;function at(e,t){if(!e)return[];var n=!1,o=[],r=[],i=[],s=!1,a=!1,c="",l=0;function h(){if(s&&!a)for(;i.length;)delete r[i.pop()];else i=[];s=!1,a=!1}var m,k,F;function V(M){if(typeof M=="string"&&(M=M.split(rt,2)),!D(M)||M.length!==2)throw new Error("Invalid tags: "+M);m=new RegExp(ne(M[0])+"\\s*"),k=new RegExp("\\s*"+ne(M[1])),F=new RegExp("\\s*"+ne("}"+M[1]))}V(t||y.tags);for(var p=new q(e),E,u,b,H,X,C;!p.eos();){if(E=p.pos,b=p.scanUntil(m),b)for(var ee=0,Ve=b.length;ee<Ve;++ee)H=b.charAt(ee),et(H)?(i.push(r.length),c+=H):(a=!0,n=!0,c+=" "),r.push(["text",H,E,E+1]),E+=1,H===`
`&&(h(),c="",l=0,n=!1);if(!p.scan(m))break;if(s=!0,u=p.scan(st)||"name",p.scan(ot),u==="="?(b=p.scanUntil(ge),p.scan(ge),p.scanUntil(k)):u==="{"?(b=p.scanUntil(F),p.scan(it),p.scanUntil(k),u="&"):b=p.scanUntil(k),!p.scan(k))throw new Error("Unclosed tag at "+p.pos);if(u==">"?X=[u,b,E,p.pos,c,l,n]:X=[u,b,E,p.pos],l++,r.push(X),u==="#"||u==="^")o.push(X);else if(u==="/"){if(C=o.pop(),!C)throw new Error('Unopened section "'+b+'" at '+E);if(C[1]!==b)throw new Error('Unclosed section "'+C[1]+'" at '+E)}else u==="name"||u==="{"||u==="&"?a=!0:u==="="&&V(b)}if(h(),C=o.pop(),C)throw new Error('Unclosed section "'+C[1]+'" at '+p.pos);return ut(ct(r))}function ct(e){for(var t=[],n,o,r=0,i=e.length;r<i;++r)n=e[r],n&&(n[0]==="text"&&o&&o[0]==="text"?(o[1]+=n[1],o[3]=n[3]):(t.push(n),o=n));return t}function ut(e){for(var t=[],n=t,o=[],r,i,s=0,a=e.length;s<a;++s)switch(r=e[s],r[0]){case"#":case"^":n.push(r),o.push(r),n=r[4]=[];break;case"/":i=o.pop(),i[5]=r[2],n=o.length>0?o[o.length-1][4]:t;break;default:n.push(r)}return t}function q(e){this.string=e,this.tail=e,this.pos=0}q.prototype.eos=function(){return this.tail===""};q.prototype.scan=function(t){var n=this.tail.match(t);if(!n||n.index!==0)return"";var o=n[0];return this.tail=this.tail.substring(o.length),this.pos+=o.length,o};q.prototype.scanUntil=function(t){var n=this.tail.search(t),o;switch(n){case-1:o=this.tail,this.tail="";break;case 0:o="";break;default:o=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=o.length,o};function U(e,t){this.view=e,this.cache={".":this.view},this.parent=t}U.prototype.push=function(t){return new U(t,this)};U.prototype.lookup=function(t){var n=this.cache,o;if(n.hasOwnProperty(t))o=n[t];else{for(var r=this,i,s,a,c=!1;r;){if(t.indexOf(".")>0)for(i=r.view,s=t.split("."),a=0;i!=null&&a<s.length;)a===s.length-1&&(c=de(i,s[a])||Ze(i,s[a])),i=i[s[a++]];else i=r.view[t],c=de(r.view,t);if(c){o=i;break}r=r.parent}n[t]=o}return le(o)&&(o=o.call(this.view)),o};function g(){this.templateCache={_cache:{},set:function(t,n){this._cache[t]=n},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}g.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};g.prototype.parse=function(t,n){var o=this.templateCache,r=t+":"+(n||y.tags).join(":"),i=typeof o<"u",s=i?o.get(r):void 0;return s==null&&(s=at(t,n),i&&o.set(r,s)),s};g.prototype.render=function(t,n,o,r){var i=this.getConfigTags(r),s=this.parse(t,i),a=n instanceof U?n:new U(n,void 0);return this.renderTokens(s,a,o,t,r)};g.prototype.renderTokens=function(t,n,o,r,i){for(var s="",a,c,l,h=0,m=t.length;h<m;++h)l=void 0,a=t[h],c=a[0],c==="#"?l=this.renderSection(a,n,o,r,i):c==="^"?l=this.renderInverted(a,n,o,r,i):c===">"?l=this.renderPartial(a,n,o,i):c==="&"?l=this.unescapedValue(a,n):c==="name"?l=this.escapedValue(a,n,i):c==="text"&&(l=this.rawValue(a)),l!==void 0&&(s+=l);return s};g.prototype.renderSection=function(t,n,o,r,i){var s=this,a="",c=n.lookup(t[1]);function l(k){return s.render(k,n,o,i)}if(c){if(D(c))for(var h=0,m=c.length;h<m;++h)a+=this.renderTokens(t[4],n.push(c[h]),o,r,i);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")a+=this.renderTokens(t[4],n.push(c),o,r,i);else if(le(c)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(n.view,r.slice(t[3],t[5]),l),c!=null&&(a+=c)}else a+=this.renderTokens(t[4],n,o,r,i);return a}};g.prototype.renderInverted=function(t,n,o,r,i){var s=n.lookup(t[1]);if(!s||D(s)&&s.length===0)return this.renderTokens(t[4],n,o,r,i)};g.prototype.indentPartial=function(t,n,o){for(var r=n.replace(/[^ \t]/g,""),i=t.split(`
`),s=0;s<i.length;s++)i[s].length&&(s>0||!o)&&(i[s]=r+i[s]);return i.join(`
`)};g.prototype.renderPartial=function(t,n,o,r){if(o){var i=this.getConfigTags(r),s=le(o)?o(t[1]):o[t[1]];if(s!=null){var a=t[6],c=t[5],l=t[4],h=s;c==0&&l&&(h=this.indentPartial(s,l,a));var m=this.parse(h,i);return this.renderTokens(m,n,o,h,r)}}};g.prototype.unescapedValue=function(t,n){var o=n.lookup(t[1]);if(o!=null)return o};g.prototype.escapedValue=function(t,n,o){var r=this.getConfigEscape(o)||y.escape,i=n.lookup(t[1]);if(i!=null)return typeof i=="number"&&r===y.escape?String(i):r(i)};g.prototype.rawValue=function(t){return t[1]};g.prototype.getConfigTags=function(t){return D(t)?t:t&&typeof t=="object"?t.tags:void 0};g.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!D(t))return t.escape};var y={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){Q.templateCache=e},get templateCache(){return Q.templateCache}},Q=new g;y.clearCache=function(){return Q.clearCache()};y.parse=function(t,n){return Q.parse(t,n)};y.render=function(t,n,o,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Xe(t)+'" was given as the first argument for mustache#render(template, view, partials)');return Q.render(t,n,o,r)};y.escape=nt;y.Scanner=q;y.Context=U;y.Writer=g;class je{constructor(t,n){this.template=t,this.state=n,this.ast=y.parse(t)}getValue(){return this.value===void 0&&(this.value=y.render(this.template,this.state)),this.value}onChange(t){const n=[];for(const o of this.getUsedVariables().values())n.push(this.state.onVariableChange(o).subscribe(()=>{const r=y.render(this.template,this.state);r!==this.value&&(this.value=r,t(this.value))}));return{unsubscribe:()=>{for(const o of n)o.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const t=new Set;return this.recursiveGetUsedVariables(this.ast,t),t}recursiveGetUsedVariables(t,n){for(const o of t){const r=o[0],i=o[1],s=o[4];["name","&","#","^"].includes(r)&&n.add(i),s!==void 0&&typeof s!="string"&&this.recursiveGetUsedVariables(s,n)}}}async function lt(){var e;const t=await xe();for(const n of t){const o=(e=n.properties)!==null&&e!==void 0?e:[];for(const r of o){if(r.type==="int"||r.type==="bool"||r.type==="object"||typeof r.value!="string")continue;const i=new je(r.value,WA.state);if(i.isPureString())continue;const s=i.getValue();await ye(n.name,r.name,s),i.onChange(async a=>{await ye(n.name,r.name,a)})}}}async function pt(){var e;const t=await K();for(const[n,o]of t.entries())if(o.type!=="objectgroup"){const r=(e=o.properties)!==null&&e!==void 0?e:[];for(const i of r){if(i.type==="int"||i.type==="bool"||i.type==="object"||typeof i.value!="string")continue;const s=new je(i.value,WA.state);if(s.isPureString())continue;const a=s.getValue();me(n,i.name,a),s.onChange(c=>{me(n,i.name,c)})}}}async function ye(e,t,n){console.log(e),(await WA.room.area.get(e)).setProperty(t,n)}function me(e,t,n){WA.room.setProperty(e,t,n),t==="visible"&&(n?WA.room.showLayer(e):WA.room.hideLayer(e))}const ht="https://admin.workadventu.re/html";let ce,pe=0,he=0;function be(e){if(WA.state[e.name]){let t=e.properties.mustGetString("openLayer");for(const n of t.split(`
`))WA.room.showLayer(n);t=e.properties.mustGetString("closeLayer");for(const n of t.split(`
`))WA.room.hideLayer(n)}else{let t=e.properties.mustGetString("openLayer");for(const n of t.split(`
`))WA.room.hideLayer(n);t=e.properties.mustGetString("closeLayer");for(const n of t.split(`
`))WA.room.showLayer(n)}}function ft(e){const t=e.properties.getString("openSound"),n=e.properties.getNumber("soundRadius");let o=1;if(n){const r=Ue(e.properties.mustGetString("openLayer").split(`
`));if(r>n)return;o=1-r/n}t&&WA.sound.loadSound(t).play({volume:o})}function dt(e){const t=e.properties.getString("closeSound"),n=e.properties.getNumber("soundRadius");let o=1;if(n){const r=Ue(e.properties.mustGetString("closeLayer").split(`
`));if(r>n)return;o=1-r/n}t&&WA.sound.loadSound(t).play({volume:o})}function Ge(e){return e.map(t=>ce.get(t)).filter(t=>(t==null?void 0:t.type)==="tilelayer")}function Ue(e){const t=Ge(e),n=Oe(t),o=((n.right-n.left)/2+n.left)*32,r=((n.bottom-n.top)/2+n.top)*32;return Math.sqrt(Math.pow(pe-o,2)+Math.pow(he-r,2))}function gt(e){WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]?ft(e):dt(e),be(e)}),be(e)}function Ae(e,t,n,o){const r=e.name;let i,s,a=!1;const c=n.getString("tag");let l=!0;c&&!WA.player.tags.includes(c)&&(l=!1);const h=!!c;function m(){var u;i&&i.remove(),i=WA.ui.displayActionMessage({message:(u=n.getString("closeTriggerMessage"))!==null&&u!==void 0?u:"Press SPACE to close the door",callback:()=>{WA.state[t.name]=!1,k()}})}function k(){var u;i&&i.remove(),i=WA.ui.displayActionMessage({message:(u=n.getString("openTriggerMessage"))!==null&&u!==void 0?u:"Press SPACE to open the door",callback:()=>{WA.state[t.name]=!0,m()}})}function F(){let u;if(e.type==="tilelayer")u=Oe(Ge(t.properties.mustGetString("closeLayer").split(`
`)));else{if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)throw new Error(`Doorstep zone "${e.name}" is missing x, y, width or height`);u={top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}s=WA.room.website.create({name:"doorKeypad"+r,url:o+"/keypad.html#"+encodeURIComponent(r),position:{x:u.right*32,y:u.top*32,width:32*3,height:32*4},allowApi:!0})}function V(){s&&(WA.room.website.delete(s.name),s=void 0)}function p(){if(a=!0,n.getBoolean("autoOpen")&&l){WA.state[t.name]=!0;return}if(!WA.state[t.name]&&(h&&!l||!h)&&(n.getString("code")||n.getString("codeVariable"))){F();return}l&&(WA.state[t.name]?m():k())}function E(){a=!1,n.getBoolean("autoClose")&&(WA.state[t.name]=!1),i&&i.remove(),V()}e.type==="tilelayer"?(WA.room.onEnterLayer(r).subscribe(p),WA.room.onLeaveLayer(r).subscribe(E)):(WA.room.area.onEnter(r).subscribe(p),WA.room.area.onLeave(r).subscribe(E)),WA.state.onVariableChange(t.name).subscribe(()=>{a&&(!n.getBoolean("autoClose")&&WA.state[t.name]===!0&&m(),s&&WA.state[t.name]===!0&&V(),!n.getBoolean("autoOpen")&&WA.state[t.name]===!1&&k())})}function yt(e){const t=e.properties.mustGetString("bellSound"),n=e.properties.getNumber("soundRadius");let o=1;if(n){const r=Math.sqrt(Math.pow(e.x-pe,2)+Math.pow(e.y-he,2));if(r>n)return;o=1-r/n}WA.sound.loadSound(t).play({volume:o})}function mt(e){WA.state[e.name]===void 0&&(WA.state[e.name]=0),WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]&&yt(e)})}function ve(e,t,n){let o;const r=t.getString("bellPopup");if(n.type==="tilelayer"){const i=n.name;WA.room.onEnterLayer(i).subscribe(()=>{var s;r?o=WA.ui.openPopup(r,"",[{label:(s=t.getString("bellButtonText"))!==null&&s!==void 0?s:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.onLeaveLayer(i).subscribe(()=>{o&&(o.close(),o=void 0)})}else{const i=n.name;WA.room.area.onEnter(i).subscribe(()=>{var s;r?o=WA.ui.openPopup(r,"",[{label:(s=t.getString("bellButtonText"))!==null&&s!==void 0?s:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.area.onLeave(i).subscribe(()=>{o&&(o.close(),o=void 0)})}}async function bt(e){e=e??ht;const t=await Ye();ce=await K();for(const n of t.values())n.properties.get("door")&&gt(n),n.properties.get("bell")&&mt(n);for(const n of ce.values()){const o=new G(n.properties),r=o.getString("doorVariable");if(r&&n.type==="tilelayer"){const s=t.get(r);if(s===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of layer "'+n.name+'"');Ae(n,s,o,e)}const i=o.getString("bellVariable");i&&n.type==="tilelayer"&&ve(i,o,n)}for(const n of await xe()){const o=new G(n.properties),r=o.getString("doorVariable");if(r){const s=t.get(r);if(s===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of object "'+n.name+'"');Ae(n,s,o,e)}const i=o.getString("bellVariable");i&&ve(i,o,n)}WA.player.onPlayerMove(n=>{pe=n.x,he=n.y})}function At(e,t){const n=e.getString("bindVariable");if(n){const o=e.get("enterValue"),r=e.get("leaveValue"),i=e.getString("triggerMessage"),s=e.getString("tag");vt(n,t,o,r,i,s)}}let Z;function vt(e,t,n,o,r,i){i&&!WA.player.tags.includes(i)||(n!==void 0&&WA.room.onEnterLayer(t).subscribe(()=>{r?Z=WA.ui.displayActionMessage({type:"message",message:r,callback:()=>{WA.state[e]=n}}):WA.state[e]=n}),o!==void 0&&WA.room.onLeaveLayer(t).subscribe(()=>{WA.state[e]=o,Z&&(Z.remove().catch(s=>{console.error(s)}),Z=void 0)}))}async function Wt(){const e=await K();for(const t of e.values()){const n=new G(t.properties);At(n,t.name)}}let We;async function wt(e){const t=await WA.room.getTiledMap();e=e??Be,We=await K();const n=t.layers.find(o=>o.name==="configuration");if(n){const r=new G(n.properties).getString("tag");(!r||WA.player.tags.includes(r))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(e+"/configuration.html",!0)});for(const i of We.values()){const s=new G(i.properties),a=s.getString("openConfig");a&&i.type==="tilelayer"&&Pt(a.split(","),i.name,s)}}}function Pt(e,t,n){let o;const r=n.getString("openConfigAdminTag");let i=!0;r&&!WA.player.tags.includes(r)&&(i=!1);function s(){var c;o&&o.remove(),o=WA.ui.displayActionMessage({message:(c=n.getString("openConfigTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE or touch here to configure",callback:()=>fe(e)})}function a(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(t).subscribe(()=>{const c=n.getString("openConfigTrigger");i&&(c&&c==="onaction"?s():fe(e))}),WA.room.onLeaveLayer(t).subscribe(()=>{o&&o.remove(),a()})}function St(){return WA.onInit().then(()=>{bt().catch(e=>console.error(e)),Wt().catch(e=>console.error(e)),wt().catch(e=>console.error(e)),pt().catch(e=>console.error(e)),lt().catch(e=>console.error(e))}).catch(e=>console.error(e))}let B;function kt(){WA.room.area.onEnter("clock").subscribe(()=>{const e=new Date,t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");B&&B.close(),B=WA.ui.openPopup("clockPopup",`It's ${t}:${n}`,[])}),WA.room.area.onLeave("clock").subscribe(()=>{B&&(B.close(),B=void 0)})}let z;function Et(){const e=()=>{z&&(z.close(),z=void 0)};WA.room.area.onEnter("board").subscribe(()=>{e();const t="The bulletin board hums with strange energy. Five portals shimmer before you—choose your path: 💜 Malware — malicious code that corrupts, spies, and destroys • 🔵 Phishing/Quishing — fake messages or QR Codes that trick you into giving secrets • 🔴 Identity Theft — criminals using your identity • 🟡 xxxxxxxxxxxx • 💚 Password Security — strong, unique passwords and MFA to protect your accounts.";z=WA.ui.openPopup("boardPopup",t,[])}),WA.room.area.onLeave("board").subscribe(e)}let x;function oe(){var e;if(x){try{(e=x.close)==null||e.call(x)}catch{}x=void 0}}function Mt(){var e,t;try{const n=(t=(e=WA.room.object)==null?void 0:e.get)==null?void 0:t.call(e,"MarvieZone");if(n&&n.properties){const o=n.properties;if(Array.isArray(o)){const r=o.find(i=>i.name==="marvieMessage"||i.name==="marviePopup");if(r!=null&&r.value)return String(r.value)}else if(o.marvieMessage)return String(o.marvieMessage)}}catch{}return["👋 Hi — I'm Marvie.","","Welcome to the Room of Malware.","Do you think you can find the 3 easter eggs around the map?","Tip: Check the walls, the chairs or the floor for suspicious objects."].join(`
`)}function Ct(){console.log("[Marvie] init"),WA.room.area.onEnter("MarvieZone").subscribe(()=>{oe();const e=Mt();x=WA.ui.openPopup("marviePopup",e,[{label:"Got it",callback:()=>oe()}])}),WA.room.area.onLeave("MarvieZone").subscribe(()=>{oe()})}let L;const we="phishing_QRcode",Lt="phishing_QRcodePopup";function Rt(){WA.onInit().then(()=>{WA.room.area.onEnter(we).subscribe(()=>{re(),L=WA.ui.openPopup(Lt,`📷 You spot a poster in the library: “Free Wi-Fi for Students – Scan to connect.”

Scanning unknown QR codes can lead to fake login pages.

What would you do? Press SPACE to help!`,[{label:"Got it",callback:()=>re()}])}),WA.room.area.onLeave(we).subscribe(()=>{re()})})}function re(){var e;try{L&&((e=L.close)==null||e.call(L),L=void 0)}catch{L=void 0}}let R;const Pe="phishing_MurdochEmail",Tt="phishing_MurdochEmailPopup";function _t(){WA.onInit().then(()=>{WA.room.area.onEnter(Pe).subscribe(()=>{ie(),R=WA.ui.openPopup(Tt,`📧 You received an email: “Your university fees are overdue. Click here to pay immediately.”

⚠️ This looks suspicious... What would you do? Press SPACE to help!`,[{label:"Got it",callback:()=>ie()}])}),WA.room.area.onLeave(Pe).subscribe(()=>{ie()})})}function ie(){var e;try{R&&((e=R.close)==null||e.call(R),R=void 0)}catch{R=void 0}}let T;const Se="phishing_SMSphishing",Bt="phishing_SMSphishingPopup";function It(){WA.onInit().then(()=>{WA.room.area.onEnter(Se).subscribe(()=>{se(),T=WA.ui.openPopup(Bt,`📱 You received an SMS: “URGENT: Your bank account has been locked. Verify now to avoid service interruption.”

⚠️ Messages like this try to rush you. What would you do? Press SPACE to help!`,[{label:"Got it",callback:()=>se()}])}),WA.room.area.onLeave(Se).subscribe(()=>{se()})})}function se(){var e;try{T&&((e=T.close)==null||e.call(T),T=void 0)}catch{T=void 0}}const f={phishing_SMSphishing:!1,phishing_MurdochEmail:!1,phishing_QRcode:!1,BrockZone:!1},Nt="to-canteen",xt="canteen.tmj#from-library";function Ot(){WA.onInit().then(()=>{console.log("[PhishingLibraryProgress] ready"),["phishing_SMSphishing","phishing_MurdochEmail","phishing_QRcode"].forEach(e=>{WA.room.area.onEnter(e).subscribe(()=>{f[e]||(f[e]=!0,ke())})}),WA.room.area.onEnter("BrockZone").subscribe(()=>{f.BrockZone||(f.BrockZone=!0,ke())}),WA.room.area.onEnter(Nt).subscribe(()=>{jt()?WA.nav.goToRoom(xt):WA.ui.openPopup("phishing_gate_popup",`🚧 Hold up!

You still need to complete:
• ${Gt().join(`
• `)}

Find all 3 phishing easter eggs and talk to Brock before leaving.`,[{label:"OK",className:"primary",callback:e=>e.close()}])})})}function jt(){return f.phishing_SMSphishing&&f.phishing_MurdochEmail&&f.phishing_QRcode&&f.BrockZone}function Gt(){const e=[];return f.phishing_SMSphishing||e.push("SMS Phishing Easter Egg"),f.phishing_MurdochEmail||e.push("Murdoch Email Easter Egg"),f.phishing_QRcode||e.push("QR Code Easter Egg"),f.BrockZone||e.push("Talk to Brock (NPC)"),e}function ke(){const e=[f.phishing_SMSphishing?"✅ SMS":"⬜ SMS",f.phishing_MurdochEmail?"✅ MurdochEmail":"⬜ MurdochEmail",f.phishing_QRcode?"✅ QRcode":"⬜ QRcode",f.BrockZone?"✅ Brock":"⬜ Brock"].join("   ");WA.ui.displayActionMessage({message:`Progress: ${e}`,callback:()=>{}})}let O;function Ut(){WA.onInit().then(()=>{console.log("[WA] Phishing sign instructions ready"),WA.room.area.onEnter("phishing_instructions").subscribe(()=>{Dt()}),WA.room.area.onLeave("phishing_instructions").subscribe(()=>{ue()})})}function Dt(){ue(),O=WA.ui.openPopup("phishing_instructionsPopup","🧑‍💻 Go through the PPT to prepare yourself for when you explore the room!",[{label:"Got it!",className:"primary",callback:()=>ue()}])}function ue(){var e;O&&((e=O.close)==null||e.call(O),O=void 0)}let A,v;function ae(){var e,t;try{(e=A==null?void 0:A.close)==null||e.call(A)}catch{}A=void 0;try{(t=v==null?void 0:v.unsubscribe)==null||t.call(v)}catch{}v=void 0}function Ee(){var e,t;try{(e=A==null?void 0:A.close)==null||e.call(A)}catch{}A=WA.ui.openPopup("phishing_librarySpawnPopup","📌 Please visit the signboard.",[{label:"OK",callback:ae}]);try{(t=v==null?void 0:v.unsubscribe)==null||t.call(v)}catch{}v=WA.room.area.onLeave("from-garden").subscribe(ae),setTimeout(()=>{ae()},5e3)}function Vt(){WA.onInit().then(()=>{WA.room.area.onEnter("from-garden").subscribe(Ee),setTimeout(()=>{WA.player.getPosition().then(()=>Ee())},250)})}let J;function Ht(){const e="phishing_BrockPopup",t=()=>{J&&(J.close(),J=void 0)};WA.room.area.onEnter("phishing_Brock").subscribe(()=>{t();const n="🧑‍🏫 Brock: Hey there! Before you move on, have you checked out all the phishing clues? Make sure you’ve seen the email, QR code, and SMS examples — they’ll help you spot scams in the future!";J=WA.ui.openPopup(e,n,[{label:"Got it!",callback:()=>t()}])}),WA.room.area.onLeave("phishing_Brock").subscribe(t)}let _,I,N,Me=!1;const Ce="billboard",Yt="billboardPopup";function Y(){var e;try{(e=_==null?void 0:_.close)==null||e.call(_)}catch{}_=void 0}function Qt(){Me||(Me=!0,WA.onInit().then(()=>{var e,t,n,o,r,i;try{(e=I==null?void 0:I.unsubscribe)==null||e.call(I)}catch{}try{(t=N==null?void 0:N.unsubscribe)==null||t.call(N)}catch{}I=WA.room.area.onEnter(Ce).subscribe(()=>{console.log("[billboard] enter"),Y(),_=WA.ui.openPopup(Yt,`📜 The community billboard

➡️ Move towards the ladder on the right and begin your adventure!`,[{label:"Close",className:"primary",callback:()=>Y()}])}),N=WA.room.area.onLeave(Ce).subscribe(()=>{console.log("[billboard] leave"),Y()}),(i=(o=(n=WA.room).onLeaveLayer)==null?void 0:(r=o.call(n,"**")).subscribe)==null||i.call(r,()=>Y()),window.addEventListener("blur",Y)}))}let j;function Kt(){WA.onInit().then(()=>{setTimeout(qt,50)})}function qt(){Le(),j=WA.ui.openPopup("spawnIntroPopup","👋 Welcome! Use the Arrow Keys or WASD to move. Explore the map and look for the wooden signage for guidance. Tip: Walk close to objects (signs, boards, NPCs) to interact with them.",[{label:"Got it",className:"primary",callback:e=>{var t;try{(t=e.close)==null||t.call(e)}catch{}Le()}}])}function Le(){var e;if(j){try{(e=j.close)==null||e.call(j)}catch{}j=void 0}}let $;function Ft(){WA.onInit().then(()=>{console.log("[WA] Instructions ready"),Re(),WA.room.area.onEnter("instructions").subscribe(()=>{Re()}),WA.room.area.onLeave("instructions").subscribe(()=>{De()})})}function Re(){De(),$=WA.ui.openPopup("instructionsPopup","👋 Welcome Ranger! Use the Arrow Keys or WASD to move around. Walk close to objects such as signs, boards, or NPCs to interact with them. Sometimes you will need to press SPACE to open a dialogue or a side panel with more details. Explore the garden and see what you can discover! REMEMBER! Check the signboard for more info.",[{label:"Let’s go!",className:"primary",callback:e=>e.close()}])}function De(){$&&($.close(),$=void 0)}const Xt="posterPopup";let W;function Zt(e){var t;try{(t=W==null?void 0:W.close)==null||t.call(W)}catch{}W=WA.ui.openPopup(Xt,e,[])}function zt(){var e;try{(e=W==null?void 0:W.close)==null||e.call(W)}catch{}W=void 0}function Jt(){WA.room.area.onEnter("poster").subscribe(()=>{Zt(`🪧 You notice a faded poster: "Think Before You Click! Your Cyber Kingdom Depends On It."

💭 You: (to yourself) 'Think before you click.' That's a good motto.

📢 Narrator: Always pause before clicking unknown links. Your vigilance protects your cyber kingdom!`)}),WA.room.area.onLeave("poster").subscribe(zt)}const $t="usbdrivePopup";let w;function en(e){var t;try{(t=w==null?void 0:w.close)==null||t.call(w)}catch{}w=WA.ui.openPopup($t,e,[])}function tn(){var e;try{(e=w==null?void 0:w.close)==null||e.call(w)}catch{}w=void 0}function nn(){WA.room.area.onEnter("usbdrive").subscribe(()=>{en(`💾 You spot a random USB drive on the floor.

💭 You: Should I plug this into a PC and see what's inside?

📢 Narrator: Never plug in unknown USBs. They can hide malware that runs automatically. If you find one in real life, hand it to IT/Security instead of investigating it yourself.`)}),WA.room.area.onLeave("usbdrive").subscribe(tn)}const on="stickynotePopup";let P;function rn(e){var t;try{(t=P==null?void 0:P.close)==null||t.call(P)}catch{}P=WA.ui.openPopup(on,e,[])}function sn(){var e;try{(e=P==null?void 0:P.close)==null||e.call(P)}catch{}P=void 0}function an(){WA.room.area.onEnter("stickynote").subscribe(()=>{rn(`📝 A sticky note is stuck to the monitor: “Email PW: P@ssw0rd123”.

💭 You: Wah… someone actually wrote their password here.

📢 Narrator: Don’t write passwords on paper or share them. Use a password manager, create unique passphrases, and always enable MFA (multi-factor authentication).`)}),WA.room.area.onLeave("stickynote").subscribe(sn)}const cn="instructions_safeinternetpracticesPopup";let S;function un(e){var t;try{(t=S==null?void 0:S.close)==null||t.call(S)}catch{}S=WA.ui.openPopup(cn,e,[])}function ln(){var e;try{(e=S==null?void 0:S.close)==null||e.call(S)}catch{}S=void 0}function pn(){WA.room.area.onEnter("instructions_safeinternetpractices").subscribe(()=>{un(`🛡️ Welcome to the Safe Internet Practices office!

• Explore the room and look for hidden clues (poster, USB drive, sticky note).
• Read your character’s thoughts and the narrator’s tips.
• Learn to: think before you click, protect passwords, and avoid risky devices.

When you’re done, proceed to the exit to continue your mission.`)}),WA.room.area.onLeave("instructions_safeinternetpractices").subscribe(ln)}const d={poster:!1,usbdrive:!1,stickynote:!1,AmeliaZone:!1},hn="to-hall",fn="hall.tmj#from-canteen";function dn(){WA.onInit().then(()=>{console.log("[OfficeProgress] ready"),["poster","usbdrive","stickynote"].forEach(e=>{WA.room.area.onEnter(e).subscribe(()=>{console.log(`[OfficeProgress] ENTER ${e}`),d[e]||(d[e]=!0,_e())})}),WA.room.area.onEnter("AmeliaZone").subscribe(()=>{console.log("[OfficeProgress] ENTER AmeliaZone"),d.AmeliaZone||(d.AmeliaZone=!0,_e())}),WA.room.area.onEnter(hn).subscribe(()=>{console.log("[OfficeProgress] ENTER EXIT, allDone =",Te()),Te()?WA.nav.goToRoom(fn):WA.ui.openPopup("safeinternet_gate_popup",`🚧 Hold up!

You still need to complete:
• ${gn().join(`
• `)}

Find all 3 clues and talk to Amelia before leaving.`,[{label:"OK",className:"primary",callback:e=>e.close()}])})})}function Te(){return d.poster&&d.usbdrive&&d.stickynote&&d.AmeliaZone}function gn(){const e=[];return d.poster||e.push("Old Security Poster"),d.usbdrive||e.push("USB Drive"),d.stickynote||e.push("Sticky Note"),d.AmeliaZone||e.push("Talk to Amelia (NPC)"),e}function _e(){const e=[d.poster?"✅ Poster":"⬜ Poster",d.usbdrive?"✅ USB":"⬜ USB",d.stickynote?"✅ Sticky":"⬜ Sticky Note",d.AmeliaZone?"✅ Amelia":"⬜ Amelia"].join("   ");WA.ui.displayActionMessage({message:`Progress: ${e}`,callback:()=>{}})}console.log("Script started");WA.onInit().then(async()=>{console.log("Scripting API ready"),await St(),kt(),Et(),Ct();const e=(await yn()).toLowerCase();console.log("[Router] Detected mapId:",e);const t=e.includes("garden"),n=e.includes("library"),o=e.includes("canteen");t?(console.log("[Router] Init: garden"),Qt(),Kt(),Ft(),Jt(),nn(),an(),pn(),dn()):n?(console.log("[Router] Init: library (phishing)"),Rt(),_t(),It(),Ot(),Ut(),Vt(),Ht()):o?console.log("[Router] Init: canteen"):console.warn("[Router] Unknown map; only common features initialized.")});async function yn(){var e,t;try{const o=decodeURIComponent(window.location.pathname+window.location.hash).match(/\/([^\/?#]+\.tmj)/i);if(o&&o[1])return o[1]}catch{}try{const n=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),o=((n==null?void 0:n.url)??(n==null?void 0:n.name)??"").toString();if(o)return o.split("/").pop()||o}catch{}return""}
//# sourceMappingURL=main-c3c6e81f.js.map
