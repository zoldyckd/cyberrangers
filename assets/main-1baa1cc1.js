class z{constructor(t){this.properties=t??[]}get(t){const o=this.properties.filter(n=>n.name===t).map(n=>n.value);if(o.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(o.length!==0)return o[0]}getString(t){return this.getByType(t,"string")}getNumber(t){return this.getByType(t,"number")}getBoolean(t){return this.getByType(t,"boolean")}getByType(t,o){const n=this.get(t);if(n!==void 0){if(o!=="json"&&typeof n!==o)throw new Error('Expected property "'+t+'" to have type "'+o+'"');return n}}mustGetString(t){return this.mustGetByType(t,"string")}mustGetNumber(t){return this.mustGetByType(t,"number")}mustGetBoolean(t){return this.mustGetByType(t,"boolean")}mustGetByType(t,o){const n=this.get(t);if(n===void 0)throw new Error('Property "'+t+'" is missing');if(o!=="json"&&typeof n!==o)throw new Error('Expected property "'+t+'" to have type "'+o+'"');return n}getType(t){const o=this.properties.filter(n=>n.name===t).map(n=>n.type);if(o.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(o.length!==0)return o[0]}}const nt="https://unpkg.com/@workadventure/scripting-api-extra@1.9.10/dist";class ht{constructor(t){this.name=t.name,this.x=t.x,this.y=t.y,this.properties=new z(t.properties)}get isReadable(){const t=this.properties.getString("readableBy");return t?WA.player.tags.includes(t):!0}get isWritable(){const t=this.properties.getString("writableBy");return t?WA.player.tags.includes(t):!0}}function Te(e){const t=e?"#"+e.join():"";WA.nav.openCoWebSite(nt+"/configuration.html"+t,!0)}async function dt(e,t){const o=await WA.room.getTiledMap(),n=new Map;return rt(o.layers,n,e,t),n}function rt(e,t,o,n){for(const r of e)if(r.type==="objectgroup"){for(const i of r.objects)if(i.type==="variable"||i.class==="variable"){if(o&&r.name!==o||n&&!n.includes(i.name))continue;t.set(i.name,new ht(i))}}else r.type==="group"&&rt(r.layers,t,o,n)}let ue;async function oe(){return ue===void 0&&(ue=gt()),ue}async function gt(){return yt(await WA.room.getTiledMap())}function yt(e){const t=new Map;return it(e.layers,"",t),t}function it(e,t,o){for(const n of e)n.type==="group"?it(n.layers,t+n.name+"/",o):(n.name=t+n.name,o.set(n.name,n))}async function st(){const e=await oe(),t=[];for(const o of e.values())if(o.type==="objectgroup")for(const n of o.objects)(n.type==="area"||n.class==="area")&&t.push(n);return t}function mt(e){let t=1/0,o=1/0,n=0,r=0;const i=e.data;if(typeof i=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let s=0;s<e.height;s++)for(let a=0;a<e.width;a++)i[a+s*e.width]!==0&&(t=Math.min(t,a),r=Math.max(r,a),o=Math.min(o,s),n=Math.max(n,s));return{top:o,left:t,right:r+1,bottom:n+1}}function at(e){let t=1/0,o=1/0,n=0,r=0;for(const i of e){const s=mt(i);s.left<t&&(t=s.left),s.top<o&&(o=s.top),s.right>r&&(r=s.right),s.bottom>n&&(n=s.bottom)}return{top:o,left:t,right:r,bottom:n}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var bt=Object.prototype.toString,J=Array.isArray||function(t){return bt.call(t)==="[object Array]"};function Ee(e){return typeof e=="function"}function At(e){return J(e)?"array":typeof e}function pe(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Ie(e,t){return e!=null&&typeof e=="object"&&t in e}function vt(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var wt=RegExp.prototype.test;function Wt(e,t){return wt.call(e,t)}var Pt=/\S/;function kt(e){return!Wt(Pt,e)}var St={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Et(e){return String(e).replace(/[&<>"'`=\/]/g,function(o){return St[o]})}var Ct=/\s*/,Mt=/\s+/,_e=/\s*=/,Lt=/\s*\}/,Tt=/#|\^|\/|>|\{|&|=|!/;function It(e,t){if(!e)return[];var o=!1,n=[],r=[],i=[],s=!1,a=!1,c="",u=0;function f(){if(s&&!a)for(;i.length;)delete r[i.pop()];else i=[];s=!1,a=!1}var y,k,re;function $(E){if(typeof E=="string"&&(E=E.split(Mt,2)),!J(E)||E.length!==2)throw new Error("Invalid tags: "+E);y=new RegExp(pe(E[0])+"\\s*"),k=new RegExp("\\s*"+pe(E[1])),re=new RegExp("\\s*"+pe("}"+E[1]))}$(t||g.tags);for(var p=new ne(e),S,l,m,Z,ie,C;!p.eos();){if(S=p.pos,m=p.scanUntil(y),m)for(var le=0,ft=m.length;le<ft;++le)Z=m.charAt(le),kt(Z)?(i.push(r.length),c+=Z):(a=!0,o=!0,c+=" "),r.push(["text",Z,S,S+1]),S+=1,Z===`
`&&(f(),c="",u=0,o=!1);if(!p.scan(y))break;if(s=!0,l=p.scan(Tt)||"name",p.scan(Ct),l==="="?(m=p.scanUntil(_e),p.scan(_e),p.scanUntil(k)):l==="{"?(m=p.scanUntil(re),p.scan(Lt),p.scanUntil(k),l="&"):m=p.scanUntil(k),!p.scan(k))throw new Error("Unclosed tag at "+p.pos);if(l==">"?ie=[l,m,S,p.pos,c,u,o]:ie=[l,m,S,p.pos],u++,r.push(ie),l==="#"||l==="^")n.push(ie);else if(l==="/"){if(C=n.pop(),!C)throw new Error('Unopened section "'+m+'" at '+S);if(C[1]!==m)throw new Error('Unclosed section "'+C[1]+'" at '+S)}else l==="name"||l==="{"||l==="&"?a=!0:l==="="&&$(m)}if(f(),C=n.pop(),C)throw new Error('Unclosed section "'+C[1]+'" at '+p.pos);return Rt(_t(r))}function _t(e){for(var t=[],o,n,r=0,i=e.length;r<i;++r)o=e[r],o&&(o[0]==="text"&&n&&n[0]==="text"?(n[1]+=o[1],n[3]=o[3]):(t.push(o),n=o));return t}function Rt(e){for(var t=[],o=t,n=[],r,i,s=0,a=e.length;s<a;++s)switch(r=e[s],r[0]){case"#":case"^":o.push(r),n.push(r),o=r[4]=[];break;case"/":i=n.pop(),i[5]=r[2],o=n.length>0?n[n.length-1][4]:t;break;default:o.push(r)}return t}function ne(e){this.string=e,this.tail=e,this.pos=0}ne.prototype.eos=function(){return this.tail===""};ne.prototype.scan=function(t){var o=this.tail.match(t);if(!o||o.index!==0)return"";var n=o[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};ne.prototype.scanUntil=function(t){var o=this.tail.search(t),n;switch(o){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,o),this.tail=this.tail.substring(o)}return this.pos+=n.length,n};function X(e,t){this.view=e,this.cache={".":this.view},this.parent=t}X.prototype.push=function(t){return new X(t,this)};X.prototype.lookup=function(t){var o=this.cache,n;if(o.hasOwnProperty(t))n=o[t];else{for(var r=this,i,s,a,c=!1;r;){if(t.indexOf(".")>0)for(i=r.view,s=t.split("."),a=0;i!=null&&a<s.length;)a===s.length-1&&(c=Ie(i,s[a])||vt(i,s[a])),i=i[s[a++]];else i=r.view[t],c=Ie(r.view,t);if(c){n=i;break}r=r.parent}o[t]=n}return Ee(n)&&(n=n.call(this.view)),n};function d(){this.templateCache={_cache:{},set:function(t,o){this._cache[t]=o},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}d.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};d.prototype.parse=function(t,o){var n=this.templateCache,r=t+":"+(o||g.tags).join(":"),i=typeof n<"u",s=i?n.get(r):void 0;return s==null&&(s=It(t,o),i&&n.set(r,s)),s};d.prototype.render=function(t,o,n,r){var i=this.getConfigTags(r),s=this.parse(t,i),a=o instanceof X?o:new X(o,void 0);return this.renderTokens(s,a,n,t,r)};d.prototype.renderTokens=function(t,o,n,r,i){for(var s="",a,c,u,f=0,y=t.length;f<y;++f)u=void 0,a=t[f],c=a[0],c==="#"?u=this.renderSection(a,o,n,r,i):c==="^"?u=this.renderInverted(a,o,n,r,i):c===">"?u=this.renderPartial(a,o,n,i):c==="&"?u=this.unescapedValue(a,o):c==="name"?u=this.escapedValue(a,o,i):c==="text"&&(u=this.rawValue(a)),u!==void 0&&(s+=u);return s};d.prototype.renderSection=function(t,o,n,r,i){var s=this,a="",c=o.lookup(t[1]);function u(k){return s.render(k,o,n,i)}if(c){if(J(c))for(var f=0,y=c.length;f<y;++f)a+=this.renderTokens(t[4],o.push(c[f]),n,r,i);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")a+=this.renderTokens(t[4],o.push(c),n,r,i);else if(Ee(c)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(o.view,r.slice(t[3],t[5]),u),c!=null&&(a+=c)}else a+=this.renderTokens(t[4],o,n,r,i);return a}};d.prototype.renderInverted=function(t,o,n,r,i){var s=o.lookup(t[1]);if(!s||J(s)&&s.length===0)return this.renderTokens(t[4],o,n,r,i)};d.prototype.indentPartial=function(t,o,n){for(var r=o.replace(/[^ \t]/g,""),i=t.split(`
`),s=0;s<i.length;s++)i[s].length&&(s>0||!n)&&(i[s]=r+i[s]);return i.join(`
`)};d.prototype.renderPartial=function(t,o,n,r){if(n){var i=this.getConfigTags(r),s=Ee(n)?n(t[1]):n[t[1]];if(s!=null){var a=t[6],c=t[5],u=t[4],f=s;c==0&&u&&(f=this.indentPartial(s,u,a));var y=this.parse(f,i);return this.renderTokens(y,o,n,f,r)}}};d.prototype.unescapedValue=function(t,o){var n=o.lookup(t[1]);if(n!=null)return n};d.prototype.escapedValue=function(t,o,n){var r=this.getConfigEscape(n)||g.escape,i=o.lookup(t[1]);if(i!=null)return typeof i=="number"&&r===g.escape?String(i):r(i)};d.prototype.rawValue=function(t){return t[1]};d.prototype.getConfigTags=function(t){return J(t)?t:t&&typeof t=="object"?t.tags:void 0};d.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!J(t))return t.escape};var g={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){te.templateCache=e},get templateCache(){return te.templateCache}},te=new d;g.clearCache=function(){return te.clearCache()};g.parse=function(t,o){return te.parse(t,o)};g.render=function(t,o,n,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+At(t)+'" was given as the first argument for mustache#render(template, view, partials)');return te.render(t,o,n,r)};g.escape=Et;g.Scanner=ne;g.Context=X;g.Writer=d;class ct{constructor(t,o){this.template=t,this.state=o,this.ast=g.parse(t)}getValue(){return this.value===void 0&&(this.value=g.render(this.template,this.state)),this.value}onChange(t){const o=[];for(const n of this.getUsedVariables().values())o.push(this.state.onVariableChange(n).subscribe(()=>{const r=g.render(this.template,this.state);r!==this.value&&(this.value=r,t(this.value))}));return{unsubscribe:()=>{for(const n of o)n.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const t=new Set;return this.recursiveGetUsedVariables(this.ast,t),t}recursiveGetUsedVariables(t,o){for(const n of t){const r=n[0],i=n[1],s=n[4];["name","&","#","^"].includes(r)&&o.add(i),s!==void 0&&typeof s!="string"&&this.recursiveGetUsedVariables(s,o)}}}async function Nt(){var e;const t=await st();for(const o of t){const n=(e=o.properties)!==null&&e!==void 0?e:[];for(const r of n){if(r.type==="int"||r.type==="bool"||r.type==="object"||typeof r.value!="string")continue;const i=new ct(r.value,WA.state);if(i.isPureString())continue;const s=i.getValue();await Re(o.name,r.name,s),i.onChange(async a=>{await Re(o.name,r.name,a)})}}}async function Gt(){var e;const t=await oe();for(const[o,n]of t.entries())if(n.type!=="objectgroup"){const r=(e=n.properties)!==null&&e!==void 0?e:[];for(const i of r){if(i.type==="int"||i.type==="bool"||i.type==="object"||typeof i.value!="string")continue;const s=new ct(i.value,WA.state);if(s.isPureString())continue;const a=s.getValue();Ne(o,i.name,a),s.onChange(c=>{Ne(o,i.name,c)})}}}async function Re(e,t,o){console.log(e),(await WA.room.area.get(e)).setProperty(t,o)}function Ne(e,t,o){WA.room.setProperty(e,t,o),t==="visible"&&(o?WA.room.showLayer(e):WA.room.hideLayer(e))}const Ot="https://admin.workadventu.re/html";let ve,Ce=0,Me=0;function Ge(e){if(WA.state[e.name]){let t=e.properties.mustGetString("openLayer");for(const o of t.split(`
`))WA.room.showLayer(o);t=e.properties.mustGetString("closeLayer");for(const o of t.split(`
`))WA.room.hideLayer(o)}else{let t=e.properties.mustGetString("openLayer");for(const o of t.split(`
`))WA.room.hideLayer(o);t=e.properties.mustGetString("closeLayer");for(const o of t.split(`
`))WA.room.showLayer(o)}}function jt(e){const t=e.properties.getString("openSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=ut(e.properties.mustGetString("openLayer").split(`
`));if(r>o)return;n=1-r/o}t&&WA.sound.loadSound(t).play({volume:n})}function xt(e){const t=e.properties.getString("closeSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=ut(e.properties.mustGetString("closeLayer").split(`
`));if(r>o)return;n=1-r/o}t&&WA.sound.loadSound(t).play({volume:n})}function lt(e){return e.map(t=>ve.get(t)).filter(t=>(t==null?void 0:t.type)==="tilelayer")}function ut(e){const t=lt(e),o=at(t),n=((o.right-o.left)/2+o.left)*32,r=((o.bottom-o.top)/2+o.top)*32;return Math.sqrt(Math.pow(Ce-n,2)+Math.pow(Me-r,2))}function Bt(e){WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]?jt(e):xt(e),Ge(e)}),Ge(e)}function Oe(e,t,o,n){const r=e.name;let i,s,a=!1;const c=o.getString("tag");let u=!0;c&&!WA.player.tags.includes(c)&&(u=!1);const f=!!c;function y(){var l;i&&i.remove(),i=WA.ui.displayActionMessage({message:(l=o.getString("closeTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to close the door",callback:()=>{WA.state[t.name]=!1,k()}})}function k(){var l;i&&i.remove(),i=WA.ui.displayActionMessage({message:(l=o.getString("openTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to open the door",callback:()=>{WA.state[t.name]=!0,y()}})}function re(){let l;if(e.type==="tilelayer")l=at(lt(t.properties.mustGetString("closeLayer").split(`
`)));else{if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)throw new Error(`Doorstep zone "${e.name}" is missing x, y, width or height`);l={top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}s=WA.room.website.create({name:"doorKeypad"+r,url:n+"/keypad.html#"+encodeURIComponent(r),position:{x:l.right*32,y:l.top*32,width:32*3,height:32*4},allowApi:!0})}function $(){s&&(WA.room.website.delete(s.name),s=void 0)}function p(){if(a=!0,o.getBoolean("autoOpen")&&u){WA.state[t.name]=!0;return}if(!WA.state[t.name]&&(f&&!u||!f)&&(o.getString("code")||o.getString("codeVariable"))){re();return}u&&(WA.state[t.name]?y():k())}function S(){a=!1,o.getBoolean("autoClose")&&(WA.state[t.name]=!1),i&&i.remove(),$()}e.type==="tilelayer"?(WA.room.onEnterLayer(r).subscribe(p),WA.room.onLeaveLayer(r).subscribe(S)):(WA.room.area.onEnter(r).subscribe(p),WA.room.area.onLeave(r).subscribe(S)),WA.state.onVariableChange(t.name).subscribe(()=>{a&&(!o.getBoolean("autoClose")&&WA.state[t.name]===!0&&y(),s&&WA.state[t.name]===!0&&$(),!o.getBoolean("autoOpen")&&WA.state[t.name]===!1&&k())})}function Ut(e){const t=e.properties.mustGetString("bellSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=Math.sqrt(Math.pow(e.x-Ce,2)+Math.pow(e.y-Me,2));if(r>o)return;n=1-r/o}WA.sound.loadSound(t).play({volume:n})}function Dt(e){WA.state[e.name]===void 0&&(WA.state[e.name]=0),WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]&&Ut(e)})}function je(e,t,o){let n;const r=t.getString("bellPopup");if(o.type==="tilelayer"){const i=o.name;WA.room.onEnterLayer(i).subscribe(()=>{var s;r?n=WA.ui.openPopup(r,"",[{label:(s=t.getString("bellButtonText"))!==null&&s!==void 0?s:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.onLeaveLayer(i).subscribe(()=>{n&&(n.close(),n=void 0)})}else{const i=o.name;WA.room.area.onEnter(i).subscribe(()=>{var s;r?n=WA.ui.openPopup(r,"",[{label:(s=t.getString("bellButtonText"))!==null&&s!==void 0?s:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.area.onLeave(i).subscribe(()=>{n&&(n.close(),n=void 0)})}}async function Vt(e){e=e??Ot;const t=await dt();ve=await oe();for(const o of t.values())o.properties.get("door")&&Bt(o),o.properties.get("bell")&&Dt(o);for(const o of ve.values()){const n=new z(o.properties),r=n.getString("doorVariable");if(r&&o.type==="tilelayer"){const s=t.get(r);if(s===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of layer "'+o.name+'"');Oe(o,s,n,e)}const i=n.getString("bellVariable");i&&o.type==="tilelayer"&&je(i,n,o)}for(const o of await st()){const n=new z(o.properties),r=n.getString("doorVariable");if(r){const s=t.get(r);if(s===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of object "'+o.name+'"');Oe(o,s,n,e)}const i=n.getString("bellVariable");i&&je(i,n,o)}WA.player.onPlayerMove(o=>{Ce=o.x,Me=o.y})}function Ht(e,t){const o=e.getString("bindVariable");if(o){const n=e.get("enterValue"),r=e.get("leaveValue"),i=e.getString("triggerMessage"),s=e.getString("tag");Yt(o,t,n,r,i,s)}}let se;function Yt(e,t,o,n,r,i){i&&!WA.player.tags.includes(i)||(o!==void 0&&WA.room.onEnterLayer(t).subscribe(()=>{r?se=WA.ui.displayActionMessage({type:"message",message:r,callback:()=>{WA.state[e]=o}}):WA.state[e]=o}),n!==void 0&&WA.room.onLeaveLayer(t).subscribe(()=>{WA.state[e]=n,se&&(se.remove().catch(s=>{console.error(s)}),se=void 0)}))}async function Ft(){const e=await oe();for(const t of e.values()){const o=new z(t.properties);Ht(o,t.name)}}let xe;async function Qt(e){const t=await WA.room.getTiledMap();e=e??nt,xe=await oe();const o=t.layers.find(n=>n.name==="configuration");if(o){const r=new z(o.properties).getString("tag");(!r||WA.player.tags.includes(r))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(e+"/configuration.html",!0)});for(const i of xe.values()){const s=new z(i.properties),a=s.getString("openConfig");a&&i.type==="tilelayer"&&Kt(a.split(","),i.name,s)}}}function Kt(e,t,o){let n;const r=o.getString("openConfigAdminTag");let i=!0;r&&!WA.player.tags.includes(r)&&(i=!1);function s(){var c;n&&n.remove(),n=WA.ui.displayActionMessage({message:(c=o.getString("openConfigTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE or touch here to configure",callback:()=>Te(e)})}function a(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(t).subscribe(()=>{const c=o.getString("openConfigTrigger");i&&(c&&c==="onaction"?s():Te(e))}),WA.room.onLeaveLayer(t).subscribe(()=>{n&&n.remove(),a()})}function qt(){return WA.onInit().then(()=>{Vt().catch(e=>console.error(e)),Ft().catch(e=>console.error(e)),Qt().catch(e=>console.error(e)),Gt().catch(e=>console.error(e)),Nt().catch(e=>console.error(e))}).catch(e=>console.error(e))}let x;function zt(){WA.room.area.onEnter("clock").subscribe(()=>{const e=new Date,t=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");x&&x.close(),x=WA.ui.openPopup("clockPopup",`It's ${t}:${o}`,[])}),WA.room.area.onLeave("clock").subscribe(()=>{x&&(x.close(),x=void 0)})}let ae;function Xt(){const e=()=>{ae&&(ae.close(),ae=void 0)};WA.room.area.onEnter("board").subscribe(()=>{e();const t="The bulletin board hums with strange energy. Five portals shimmer before youâ€”choose your path: ðŸ’œ Malware â€” malicious code that corrupts, spies, and destroys â€¢ ðŸ”µ Phishing/Quishing â€” fake messages or QR Codes that trick you into giving secrets â€¢ ðŸ”´ Identity Theft â€” criminals using your identity â€¢ ðŸŸ¡ xxxxxxxxxxxx â€¢ ðŸ’š Password Security â€” strong, unique passwords and MFA to protect your accounts.";ae=WA.ui.openPopup("boardPopup",t,[])}),WA.room.area.onLeave("board").subscribe(e)}let H;function fe(){var e;if(H){try{(e=H.close)==null||e.call(H)}catch{}H=void 0}}function Jt(){var e,t;try{const o=(t=(e=WA.room.object)==null?void 0:e.get)==null?void 0:t.call(e,"MarvieZone");if(o&&o.properties){const n=o.properties;if(Array.isArray(n)){const r=n.find(i=>i.name==="marvieMessage"||i.name==="marviePopup");if(r!=null&&r.value)return String(r.value)}else if(n.marvieMessage)return String(n.marvieMessage)}}catch{}return["ðŸ‘‹ Hi â€” I'm Marvie.","","Welcome to the Room of Malware.","Do you think you can find the 3 easter eggs around the map?","Tip: Check the walls, the chairs or the floor for suspicious objects."].join(`
`)}function $t(){console.log("[Marvie] init"),WA.room.area.onEnter("MarvieZone").subscribe(()=>{fe();const e=Jt();H=WA.ui.openPopup("marviePopup",e,[{label:"Got it",callback:()=>fe()}])}),WA.room.area.onLeave("MarvieZone").subscribe(()=>{fe()})}const Zt={library:{tasks:[{key:"phishing_SMSphishing",label:"SMS",area:"phishing_SMSphishing"},{key:"phishing_MurdochEmail",label:"MurdochEmail",area:"phishing_MurdochEmail"},{key:"phishing_QRcode",label:"QRcode",area:"phishing_QRcode"},{key:"phishing_instructions",label:"PPT Slides",area:"phishing_instructions"}],exitGate:{area:"to-canteen",nextRoom:"canteen.tmj#from-library",warnAnchorId:"phishing_gate_popup"}}},eo={canteen:{tasks:[{key:"malware_instructions",label:"Slides",area:"malware_instructions"},{key:"malware_discord",label:"Discord",area:"malware_discord"},{key:"malware_usbdrive",label:"USB",area:"malware_usbdrive"},{key:"malware_trojan",label:"Trojan",area:"malware_trojan"}],exitGate:{area:"to-classroom",nextRoom:"classroom.tmj#from-canteen",warnAnchorId:"malware_gate_popup"}}},to={...Zt,...eo},pt="cr:goals:",Le=e=>`${pt}${e}`;function oo(e,t){try{localStorage.setItem(Le(e),JSON.stringify(t))}catch{}}function no(e){try{const t=localStorage.getItem(Le(e));return t?JSON.parse(t):null}catch{return null}}function ro(e){try{const t=[];for(let o=0;o<localStorage.length;o++){const n=localStorage.key(o);n&&n.startsWith(pt)&&!n.endsWith(e)&&t.push(n)}t.forEach(o=>localStorage.removeItem(o))}catch{}}let j={},q=[],Be=0,M,he=0,Y=!1,Ue="";function io(){WA.onInit().then(async()=>{const e=await ao()||"";if(!e){console.log("[ProgressChecker] No mapId resolved.");return}if(Ue===e)return;Ue=e;const t=to[e];if(de(),ro(e),!t){console.log("[ProgressChecker] No config for map:",e);return}console.log("[ProgressChecker] Init for map:",e),q=t.tasks;const o=no(e);if(j={...Object.fromEntries(q.map(r=>[r.key,!1])),...o??{}},window.addEventListener("beforeunload",()=>de(),{passive:!0}),q.forEach(r=>{try{WA.room.area.onEnter(r.area).subscribe(()=>{Y||j[r.key]||(j[r.key]=!0,oo(e,j),Ve(),De()&&WA.ui.displayActionMessage({message:"âœ… All tasks done! You may proceed to the exit.",callback:()=>{}}))})}catch(i){console.warn(`[ProgressChecker] area '${r.area}' not found on this map`,i)}}),t.exitGate){const{area:r,nextRoom:i,warnAnchorId:s}=t.exitGate;WA.room.area.onEnter(r).subscribe(()=>{if(Y)return;if(De()){Y=!0,de();try{WA.controls.disablePlayerControls()}catch{}try{localStorage.removeItem(Le(e))}catch{}setTimeout(()=>WA.nav.goToRoom(i),40);return}const a=Date.now();if(a-he<500)return;he=a;const c=so();if(s)try{ce(),M=WA.ui.openPopup(s,`ðŸš§ Hold up!

You still need to complete:
â€¢ ${c.join(`
â€¢ `)}

Find all tasks in this room before leaving.`,[{label:"Close",className:"primary",callback:()=>ce()}]);return}catch{}WA.ui.displayActionMessage({message:`ðŸš§ Hold up! Missing: ${c.join(", ")}`,callback:()=>{}})}),WA.room.area.onLeave(r).subscribe(()=>{ce(),Y||(he=0)})}setTimeout(()=>{Y||Ve()},300)})}function De(){return q.every(e=>j[e.key])}function so(){return q.filter(e=>!j[e.key]).map(e=>e.label)}function Ve(){if(Y)return;const e=Date.now();if(e-Be<150)return;Be=e;const t=q.map(o=>j[o.key]?`âœ… ${o.label}`:`â¬œ ${o.label}`).join("   ");WA.ui.displayActionMessage({message:`Progress:  ${t}`,callback:()=>{}})}function ce(){var e;try{(e=M==null?void 0:M.close)==null||e.call(M)}catch{}M=void 0}function de(){ce()}async function ao(){var e,t,o;try{const n=decodeURIComponent(location.href).match(/\/([^\/?#]+)\.tmj/i);if(n!=null&&n[1])return n[1].toLowerCase()}catch{}try{const n=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),r=n==null?void 0:n.properties,i=(o=r==null?void 0:r.find(s=>(s==null?void 0:s.name)==="mapId"))==null?void 0:o.value;if(typeof i=="string"&&i.trim())return i.trim().toLowerCase()}catch{}return""}let L;const He="phishing_QRcode",co="phishing_QRcodePopup";function lo(){WA.onInit().then(()=>{WA.room.area.onEnter(He).subscribe(()=>{ge(),L=WA.ui.openPopup(co,"ðŸ— You spot a poster in the library:â€œFREE NUGGETS FOR LIFE â€“ Scan Me!â€ Your friend insists it looks real, but scanning random QR codes can lead to fake websites or data theft. What would you do? Press SPACE to help!",[{label:"Got it",callback:()=>ge()}])}),WA.room.area.onLeave(He).subscribe(()=>{ge()})})}function ge(){var e;try{L&&((e=L.close)==null||e.call(L),L=void 0)}catch{L=void 0}}let T;const Ye="phishing_MurdochEmail",uo="phishing_MurdochEmailPopup";function po(){WA.onInit().then(()=>{WA.room.area.onEnter(Ye).subscribe(()=>{ye(),T=WA.ui.openPopup(uo,`ðŸ“§ You received an email: â€œYour university fees are overdue. Click here to pay immediately.â€

âš ï¸ This looks suspicious... What would you do? Press SPACE to help!`,[{label:"Got it",callback:()=>ye()}])}),WA.room.area.onLeave(Ye).subscribe(()=>{ye()})})}function ye(){var e;try{T&&((e=T.close)==null||e.call(T),T=void 0)}catch{T=void 0}}let I;const Fe="phishing_SMSphishing",fo="phishing_SMSphishingPopup";function ho(){WA.onInit().then(()=>{WA.room.area.onEnter(Fe).subscribe(()=>{me(),I=WA.ui.openPopup(fo,"ðŸ”— You received a message: â€œYour Murdoch account needs verification! Click here: https://tinyurl.com/murdoch-reset. Shortened links can hide where they actually lead. Always check the real destination before clicking! What would you do? Press SPACE to help!",[{label:"Got it",callback:()=>me()}])}),WA.room.area.onLeave(Fe).subscribe(()=>{me()})})}function me(){var e;try{I&&((e=I.close)==null||e.call(I),I=void 0)}catch{I=void 0}}let F;function go(){WA.onInit().then(()=>{console.log("[WA] Phishing sign instructions ready"),WA.room.area.onEnter("phishing_instructions").subscribe(()=>{yo()}),WA.room.area.onLeave("phishing_instructions").subscribe(()=>{we()})})}function yo(){we(),F=WA.ui.openPopup("phishing_instructionsPopup","ðŸ§‘â€ðŸ’» Quick! We saw one of the hackers going through this room! They are using phishing emails and dodgy QR codes to endanger students on campus! Before you chase after him, you should read these slides to learn how you can defend against Phishing.  ",[{label:"Got it!",className:"primary",callback:()=>we()}])}function we(){var e;F&&((e=F.close)==null||e.call(F),F=void 0)}let b,A;function be(){var e,t;try{(e=b==null?void 0:b.close)==null||e.call(b)}catch{}b=void 0;try{(t=A==null?void 0:A.unsubscribe)==null||t.call(A)}catch{}A=void 0}function Qe(){var e,t;try{(e=b==null?void 0:b.close)==null||e.call(b)}catch{}b=WA.ui.openPopup("phishing_librarySpawnPopup","ðŸ“Œ Please proceed and talk to Professor Byte.",[{label:"OK",callback:be}]);try{(t=A==null?void 0:A.unsubscribe)==null||t.call(A)}catch{}A=WA.room.area.onLeave("from-garden").subscribe(be),setTimeout(()=>{be()},5e3)}function mo(){WA.onInit().then(()=>{WA.room.area.onEnter("from-garden").subscribe(Qe),setTimeout(()=>{WA.player.getPosition().then(()=>Qe())},250)})}let _,B,U,Ke=!1;const qe="billboard",bo="billboardPopup";function ee(){var e;try{(e=_==null?void 0:_.close)==null||e.call(_)}catch{}_=void 0}function Ao(){Ke||(Ke=!0,WA.onInit().then(()=>{var e,t,o,n,r,i;try{(e=B==null?void 0:B.unsubscribe)==null||e.call(B)}catch{}try{(t=U==null?void 0:U.unsubscribe)==null||t.call(U)}catch{}B=WA.room.area.onEnter(qe).subscribe(()=>{console.log("[billboard] enter"),ee(),_=WA.ui.openPopup(bo,`ðŸ“œ The community billboard

âž¡ï¸ Move towards the ladder on the right and begin your adventure!`,[{label:"Close",className:"primary",callback:()=>ee()}])}),U=WA.room.area.onLeave(qe).subscribe(()=>{console.log("[billboard] leave"),ee()}),(i=(n=(o=WA.room).onLeaveLayer)==null?void 0:(r=n.call(o,"**")).subscribe)==null||i.call(r,()=>ee()),window.addEventListener("blur",ee)}))}let Q;function vo(){WA.onInit().then(()=>{setTimeout(wo,50)})}function wo(){ze(),Q=WA.ui.openPopup("spawnIntroPopup","ðŸ‘‹ Welcome! Use the Arrow Keys or WASD to move. Explore the map and look for Professor Byte for guidance. Tip: Walk close to objects (signs, boards, NPCs) to interact with them.",[{label:"Got it",className:"primary",callback:e=>{var t;try{(t=e.close)==null||t.call(e)}catch{}ze()}}])}function ze(){var e;if(Q){try{(e=Q.close)==null||e.call(Q)}catch{}Q=void 0}}let R,D,V,Xe=!1;const Je="instructions",Wo="instructionsPopup";function Po(){Xe||(Xe=!0,WA.onInit().then(()=>{var e,t;try{(e=D==null?void 0:D.unsubscribe)==null||e.call(D)}catch{}try{(t=V==null?void 0:V.unsubscribe)==null||t.call(V)}catch{}D=WA.room.area.onEnter(Je).subscribe(()=>{Ae(),R=WA.ui.openPopup(Wo,"ðŸ« Thank the heavens you're here! Brave student, Murdoch University is under a Cyber Attack! We need your help to protect the school against evildoers who wish us harm. Please proceed through the school and learn about how you can help us!",[{label:"Close",className:"primary",callback:()=>Ae()}])}),V=WA.room.area.onLeave(Je).subscribe(()=>{Ae()})}))}function Ae(){var e;try{(e=R==null?void 0:R.close)==null||e.call(R)}catch{}R=void 0}const ko="posterPopup";let v;function So(e){var t;try{(t=v==null?void 0:v.close)==null||t.call(v)}catch{}v=WA.ui.openPopup(ko,e,[])}function Eo(){var e;try{(e=v==null?void 0:v.close)==null||e.call(v)}catch{}v=void 0}function Co(){WA.room.area.onEnter("poster").subscribe(()=>{So(`ðŸª§ You notice a faded poster: "Think Before You Click! Your Cyber Kingdom Depends On It."

ðŸ’­ You: (to yourself) 'Think before you click.' That's a good motto.

ðŸ“¢ Narrator: Always pause before clicking unknown links. Your vigilance protects your cyber kingdom!`)}),WA.room.area.onLeave("poster").subscribe(Eo)}const Mo="usbdrivePopup";let w;function Lo(e){var t;try{(t=w==null?void 0:w.close)==null||t.call(w)}catch{}w=WA.ui.openPopup(Mo,e,[])}function To(){var e;try{(e=w==null?void 0:w.close)==null||e.call(w)}catch{}w=void 0}function Io(){WA.room.area.onEnter("usbdrive").subscribe(()=>{Lo(`ðŸ’¾ You spot a random USB drive on the floor.

ðŸ’­ You: Should I plug this into a PC and see what's inside?

ðŸ“¢ Narrator: Never plug in unknown USBs. They can hide malware that runs automatically. If you find one in real life, hand it to IT/Security instead of investigating it yourself.`)}),WA.room.area.onLeave("usbdrive").subscribe(To)}const _o="stickynotePopup";let W;function Ro(e){var t;try{(t=W==null?void 0:W.close)==null||t.call(W)}catch{}W=WA.ui.openPopup(_o,e,[])}function No(){var e;try{(e=W==null?void 0:W.close)==null||e.call(W)}catch{}W=void 0}function Go(){WA.room.area.onEnter("stickynote").subscribe(()=>{Ro(`ðŸ“ A sticky note is stuck to the monitor: â€œEmail PW: P@ssw0rd123â€.

ðŸ’­ You: Wahâ€¦ someone actually wrote their password here.

ðŸ“¢ Narrator: Donâ€™t write passwords on paper or share them. Use a password manager, create unique passphrases, and always enable MFA (multi-factor authentication).`)}),WA.room.area.onLeave("stickynote").subscribe(No)}const Oo="instructions_safeinternetpracticesPopup";let P;function jo(e){var t;try{(t=P==null?void 0:P.close)==null||t.call(P)}catch{}P=WA.ui.openPopup(Oo,e,[])}function xo(){var e;try{(e=P==null?void 0:P.close)==null||e.call(P)}catch{}P=void 0}function Bo(){WA.room.area.onEnter("instructions_safeinternetpractices").subscribe(()=>{jo(`ðŸ›¡ï¸ Welcome to the Safe Internet Practices office!

â€¢ Explore the room and look for hidden clues (poster, USB drive, sticky note).
â€¢ Read your characterâ€™s thoughts and the narratorâ€™s tips.
â€¢ Learn to: think before you click, protect passwords, and avoid risky devices.

When youâ€™re done, proceed to the exit to continue your mission.`)}),WA.room.area.onLeave("instructions_safeinternetpractices").subscribe(xo)}const h={poster:!1,usbdrive:!1,stickynote:!1,AmeliaZone:!1},Uo="to-hall",Do="hall.tmj#from-canteen";function Vo(){WA.onInit().then(()=>{console.log("[OfficeProgress] ready"),["poster","usbdrive","stickynote"].forEach(e=>{WA.room.area.onEnter(e).subscribe(()=>{console.log(`[OfficeProgress] ENTER ${e}`),h[e]||(h[e]=!0,Ze())})}),WA.room.area.onEnter("AmeliaZone").subscribe(()=>{console.log("[OfficeProgress] ENTER AmeliaZone"),h.AmeliaZone||(h.AmeliaZone=!0,Ze())}),WA.room.area.onEnter(Uo).subscribe(()=>{console.log("[OfficeProgress] ENTER EXIT, allDone =",$e()),$e()?WA.nav.goToRoom(Do):WA.ui.openPopup("safeinternet_gate_popup",`ðŸš§ Hold up!

You still need to complete:
â€¢ ${Ho().join(`
â€¢ `)}

Find all 3 clues and talk to Amelia before leaving.`,[{label:"OK",className:"primary",callback:e=>e.close()}])})})}function $e(){return h.poster&&h.usbdrive&&h.stickynote&&h.AmeliaZone}function Ho(){const e=[];return h.poster||e.push("Old Security Poster"),h.usbdrive||e.push("USB Drive"),h.stickynote||e.push("Sticky Note"),h.AmeliaZone||e.push("Talk to Amelia (NPC)"),e}function Ze(){const e=[h.poster?"âœ… Poster":"â¬œ Poster",h.usbdrive?"âœ… USB":"â¬œ USB",h.stickynote?"âœ… Sticky":"â¬œ Sticky Note",h.AmeliaZone?"âœ… Amelia":"â¬œ Amelia"].join("   ");WA.ui.displayActionMessage({message:`Progress: ${e}`,callback:()=>{}})}let K;function Yo(){WA.onInit().then(()=>{console.log("[WA] Malware instructions ready"),WA.room.area.onEnter("malware_instructions").subscribe(()=>{Fo()}),WA.room.area.onLeave("malware_instructions").subscribe(()=>{We()})})}function Fo(){We(),K=WA.ui.openPopup("malware_instructionsPopup","ðŸ§‘â€ðŸ’» Congratulations on clearing the first room! But we have a long way to go before weâ€™re ready to really protect Murdoch... In this room, youâ€™ll learn more about Malware and the best ways to protect against it. To begin, go through the slides by pressing SPACE.",[{label:"Got it!",className:"primary",callback:()=>We()}])}function We(){var e;if(K){try{(e=K.close)==null||e.call(K)}catch{}K=void 0}}let N;const et="malware_discord",Qo="malware_discordPopup";function Ko(){WA.onInit().then(()=>{console.log("[WA] Malware Discord popup ready"),WA.room.area.onEnter(et).subscribe(()=>{qo()}),WA.room.area.onLeave(et).subscribe(()=>{Pe()})})}function qo(){Pe(),N=WA.ui.openPopup(Qo,`ðŸ’¬ Friend sent a file

Your friend DMs you on Discord about a program that â€œunlocks Discord Nitro Premium for lifeâ€ and says itâ€™s safe because they used it.

What would you do? Press SPACE to help!`,[{label:"Got it!",className:"primary",callback:()=>Pe()}])}function Pe(){var e;try{(e=N==null?void 0:N.close)==null||e.call(N)}catch{}N=void 0}let G;const tt="malware_usbdrive",zo="malware_usbdrivePopup";function Xo(){WA.onInit().then(()=>{console.log("[WA] Malware USB Drive popup ready"),WA.room.area.onEnter(tt).subscribe(()=>{Jo()}),WA.room.area.onLeave(tt).subscribe(()=>{ke()})})}function Jo(){ke(),G=WA.ui.openPopup(zo,`ðŸ’¾ Found USB

You spot a USB drive on the canteen floor. It looks unopened and youâ€™re curious about whatâ€™s inside.

What would you do? Press SPACE to help!`,[{label:"Got it!",className:"primary",callback:()=>ke()}])}function ke(){var e;try{(e=G==null?void 0:G.close)==null||e.call(G)}catch{}G=void 0}let O;const ot="malware_trojan",$o="malware_trojanPopup";function Zo(){WA.onInit().then(()=>{console.log("[WA] Malware Trojan popup ready"),WA.room.area.onEnter(ot).subscribe(()=>{en()}),WA.room.area.onLeave(ot).subscribe(()=>{Se()})})}function en(){Se(),O=WA.ui.openPopup($o,`ðŸ›¡ï¸ Malware Detection

A system alert appears: â€œWindows Defender Virus Protection found an unwanted app (type: Trojan).â€

What would you do? Press SPACE to help!`,[{label:"Got it!",className:"primary",callback:()=>Se()}])}function Se(){var e;try{(e=O==null?void 0:O.close)==null||e.call(O)}catch{}O=void 0}console.log("Script started");WA.onInit().then(async()=>{console.log("Scripting API ready"),await qt(),zt(),Xt(),$t(),io();const e=await tn();console.log("[Router] mapId =",e||"(unknown)"),e==="garden"?(console.log("[Router] Initializing GARDEN featuresâ€¦"),Ao(),vo(),Po(),Co(),Io(),Go(),Bo(),Vo()):e==="library"?(console.log("[Router] Initializing LIBRARY (Phishing) featuresâ€¦"),lo(),po(),ho(),go(),mo()):e==="canteen"?(console.log("[Router] Initializing CANTEEN (Malware) featuresâ€¦"),Yo(),Ko(),Xo(),Zo()):console.warn("[Router] Unknown map; only common features started. Set a Tiled Map Property `mapId` (string) to enable map-specific inits.")});async function tn(){var e,t,o;try{const r=decodeURIComponent(window.location.href).match(/\/([^\/?#]+)\.tmj/i);if(r!=null&&r[1])return r[1].toLowerCase()}catch{}try{const n=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),r=((n==null?void 0:n.url)??(n==null?void 0:n.name)??"").toString();if(r){const a=(r.split("/").pop()||r).toLowerCase();return a.endsWith(".tmj")?a.replace(/\.tmj$/,""):a}const i=n==null?void 0:n.properties,s=(o=i==null?void 0:i.find(a=>(a==null?void 0:a.name)==="mapId"))==null?void 0:o.value;if(typeof s=="string"&&s.trim())return s.trim().toLowerCase()}catch{}return""}
//# sourceMappingURL=main-1baa1cc1.js.map
