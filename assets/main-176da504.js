class ne{constructor(t){this.properties=t??[]}get(t){const o=this.properties.filter(n=>n.name===t).map(n=>n.value);if(o.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(o.length!==0)return o[0]}getString(t){return this.getByType(t,"string")}getNumber(t){return this.getByType(t,"number")}getBoolean(t){return this.getByType(t,"boolean")}getByType(t,o){const n=this.get(t);if(n!==void 0){if(o!=="json"&&typeof n!==o)throw new Error('Expected property "'+t+'" to have type "'+o+'"');return n}}mustGetString(t){return this.mustGetByType(t,"string")}mustGetNumber(t){return this.mustGetByType(t,"number")}mustGetBoolean(t){return this.mustGetByType(t,"boolean")}mustGetByType(t,o){const n=this.get(t);if(n===void 0)throw new Error('Property "'+t+'" is missing');if(o!=="json"&&typeof n!==o)throw new Error('Expected property "'+t+'" to have type "'+o+'"');return n}getType(t){const o=this.properties.filter(n=>n.name===t).map(n=>n.type);if(o.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(o.length!==0)return o[0]}}const At="https://unpkg.com/@workadventure/scripting-api-extra@1.9.10/dist";class _t{constructor(t){this.name=t.name,this.x=t.x,this.y=t.y,this.properties=new ne(t.properties)}get isReadable(){const t=this.properties.getString("readableBy");return t?WA.player.tags.includes(t):!0}get isWritable(){const t=this.properties.getString("writableBy");return t?WA.player.tags.includes(t):!0}}function Qe(e){const t=e?"#"+e.join():"";WA.nav.openCoWebSite(At+"/configuration.html"+t,!0)}async function It(e,t){const o=await WA.room.getTiledMap(),n=new Map;return wt(o.layers,n,e,t),n}function wt(e,t,o,n){for(const r of e)if(r.type==="objectgroup"){for(const s of r.objects)if(s.type==="variable"||s.class==="variable"){if(o&&r.name!==o||n&&!n.includes(s.name))continue;t.set(s.name,new _t(s))}}else r.type==="group"&&wt(r.layers,t,o,n)}let be;async function ue(){return be===void 0&&(be=Lt()),be}async function Lt(){return Tt(await WA.room.getTiledMap())}function Tt(e){const t=new Map;return Wt(e.layers,"",t),t}function Wt(e,t,o){for(const n of e)n.type==="group"?Wt(n.layers,t+n.name+"/",o):(n.name=t+n.name,o.set(n.name,n))}async function vt(){const e=await ue(),t=[];for(const o of e.values())if(o.type==="objectgroup")for(const n of o.objects)(n.type==="area"||n.class==="area")&&t.push(n);return t}function Nt(e){let t=1/0,o=1/0,n=0,r=0;const s=e.data;if(typeof s=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let a=0;a<e.height;a++)for(let i=0;i<e.width;i++)s[i+a*e.width]!==0&&(t=Math.min(t,i),r=Math.max(r,i),o=Math.min(o,a),n=Math.max(n,a));return{top:o,left:t,right:r+1,bottom:n+1}}function Pt(e){let t=1/0,o=1/0,n=0,r=0;for(const s of e){const a=Nt(s);a.left<t&&(t=a.left),a.top<o&&(o=a.top),a.right>r&&(r=a.right),a.bottom>n&&(n=a.bottom)}return{top:o,left:t,right:r,bottom:n}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var xt=Object.prototype.toString,se=Array.isArray||function(t){return xt.call(t)==="[object Array]"};function Ye(e){return typeof e=="function"}function Gt(e){return se(e)?"array":typeof e}function Ae(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function qe(e,t){return e!=null&&typeof e=="object"&&t in e}function Ot(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var Rt=RegExp.prototype.test;function jt(e,t){return Rt.call(e,t)}var Bt=/\S/;function Ut(e){return!jt(Bt,e)}var Dt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Yt(e){return String(e).replace(/[&<>"'`=\/]/g,function(o){return Dt[o]})}var Ht=/\s*/,Ft=/\s+/,ze=/\s*=/,Vt=/\s*\}/,Qt=/#|\^|\/|>|\{|&|=|!/;function qt(e,t){if(!e)return[];var o=!1,n=[],r=[],s=[],a=!1,i=!1,c="",u=0;function f(){if(a&&!i)for(;s.length;)delete r[s.pop()];else s=[];a=!1,i=!1}var g,S,fe;function ae(E){if(typeof E=="string"&&(E=E.split(Ft,2)),!se(E)||E.length!==2)throw new Error("Invalid tags: "+E);g=new RegExp(Ae(E[0])+"\\s*"),S=new RegExp("\\s*"+Ae(E[1])),fe=new RegExp("\\s*"+Ae("}"+E[1]))}ae(t||y.tags);for(var p=new pe(e),k,l,m,ie,de,C;!p.eos();){if(k=p.pos,m=p.scanUntil(g),m)for(var me=0,Mt=m.length;me<Mt;++me)ie=m.charAt(me),Ut(ie)?(s.push(r.length),c+=ie):(i=!0,o=!0,c+=" "),r.push(["text",ie,k,k+1]),k+=1,ie===`
`&&(f(),c="",u=0,o=!1);if(!p.scan(g))break;if(a=!0,l=p.scan(Qt)||"name",p.scan(Ht),l==="="?(m=p.scanUntil(ze),p.scan(ze),p.scanUntil(S)):l==="{"?(m=p.scanUntil(fe),p.scan(Vt),p.scanUntil(S),l="&"):m=p.scanUntil(S),!p.scan(S))throw new Error("Unclosed tag at "+p.pos);if(l==">"?de=[l,m,k,p.pos,c,u,o]:de=[l,m,k,p.pos],u++,r.push(de),l==="#"||l==="^")n.push(de);else if(l==="/"){if(C=n.pop(),!C)throw new Error('Unopened section "'+m+'" at '+k);if(C[1]!==m)throw new Error('Unclosed section "'+C[1]+'" at '+k)}else l==="name"||l==="{"||l==="&"?i=!0:l==="="&&ae(m)}if(f(),C=n.pop(),C)throw new Error('Unclosed section "'+C[1]+'" at '+p.pos);return Kt(zt(r))}function zt(e){for(var t=[],o,n,r=0,s=e.length;r<s;++r)o=e[r],o&&(o[0]==="text"&&n&&n[0]==="text"?(n[1]+=o[1],n[3]=o[3]):(t.push(o),n=o));return t}function Kt(e){for(var t=[],o=t,n=[],r,s,a=0,i=e.length;a<i;++a)switch(r=e[a],r[0]){case"#":case"^":o.push(r),n.push(r),o=r[4]=[];break;case"/":s=n.pop(),s[5]=r[2],o=n.length>0?n[n.length-1][4]:t;break;default:o.push(r)}return t}function pe(e){this.string=e,this.tail=e,this.pos=0}pe.prototype.eos=function(){return this.tail===""};pe.prototype.scan=function(t){var o=this.tail.match(t);if(!o||o.index!==0)return"";var n=o[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};pe.prototype.scanUntil=function(t){var o=this.tail.search(t),n;switch(o){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,o),this.tail=this.tail.substring(o)}return this.pos+=n.length,n};function re(e,t){this.view=e,this.cache={".":this.view},this.parent=t}re.prototype.push=function(t){return new re(t,this)};re.prototype.lookup=function(t){var o=this.cache,n;if(o.hasOwnProperty(t))n=o[t];else{for(var r=this,s,a,i,c=!1;r;){if(t.indexOf(".")>0)for(s=r.view,a=t.split("."),i=0;s!=null&&i<a.length;)i===a.length-1&&(c=qe(s,a[i])||Ot(s,a[i])),s=s[a[i++]];else s=r.view[t],c=qe(r.view,t);if(c){n=s;break}r=r.parent}o[t]=n}return Ye(n)&&(n=n.call(this.view)),n};function h(){this.templateCache={_cache:{},set:function(t,o){this._cache[t]=o},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}h.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};h.prototype.parse=function(t,o){var n=this.templateCache,r=t+":"+(o||y.tags).join(":"),s=typeof n<"u",a=s?n.get(r):void 0;return a==null&&(a=qt(t,o),s&&n.set(r,a)),a};h.prototype.render=function(t,o,n,r){var s=this.getConfigTags(r),a=this.parse(t,s),i=o instanceof re?o:new re(o,void 0);return this.renderTokens(a,i,n,t,r)};h.prototype.renderTokens=function(t,o,n,r,s){for(var a="",i,c,u,f=0,g=t.length;f<g;++f)u=void 0,i=t[f],c=i[0],c==="#"?u=this.renderSection(i,o,n,r,s):c==="^"?u=this.renderInverted(i,o,n,r,s):c===">"?u=this.renderPartial(i,o,n,s):c==="&"?u=this.unescapedValue(i,o):c==="name"?u=this.escapedValue(i,o,s):c==="text"&&(u=this.rawValue(i)),u!==void 0&&(a+=u);return a};h.prototype.renderSection=function(t,o,n,r,s){var a=this,i="",c=o.lookup(t[1]);function u(S){return a.render(S,o,n,s)}if(c){if(se(c))for(var f=0,g=c.length;f<g;++f)i+=this.renderTokens(t[4],o.push(c[f]),n,r,s);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")i+=this.renderTokens(t[4],o.push(c),n,r,s);else if(Ye(c)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(o.view,r.slice(t[3],t[5]),u),c!=null&&(i+=c)}else i+=this.renderTokens(t[4],o,n,r,s);return i}};h.prototype.renderInverted=function(t,o,n,r,s){var a=o.lookup(t[1]);if(!a||se(a)&&a.length===0)return this.renderTokens(t[4],o,n,r,s)};h.prototype.indentPartial=function(t,o,n){for(var r=o.replace(/[^ \t]/g,""),s=t.split(`
`),a=0;a<s.length;a++)s[a].length&&(a>0||!n)&&(s[a]=r+s[a]);return s.join(`
`)};h.prototype.renderPartial=function(t,o,n,r){if(n){var s=this.getConfigTags(r),a=Ye(n)?n(t[1]):n[t[1]];if(a!=null){var i=t[6],c=t[5],u=t[4],f=a;c==0&&u&&(f=this.indentPartial(a,u,i));var g=this.parse(f,s);return this.renderTokens(g,o,n,f,r)}}};h.prototype.unescapedValue=function(t,o){var n=o.lookup(t[1]);if(n!=null)return n};h.prototype.escapedValue=function(t,o,n){var r=this.getConfigEscape(n)||y.escape,s=o.lookup(t[1]);if(s!=null)return typeof s=="number"&&r===y.escape?String(s):r(s)};h.prototype.rawValue=function(t){return t[1]};h.prototype.getConfigTags=function(t){return se(t)?t:t&&typeof t=="object"?t.tags:void 0};h.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!se(t))return t.escape};var y={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){le.templateCache=e},get templateCache(){return le.templateCache}},le=new h;y.clearCache=function(){return le.clearCache()};y.parse=function(t,o){return le.parse(t,o)};y.render=function(t,o,n,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Gt(t)+'" was given as the first argument for mustache#render(template, view, partials)');return le.render(t,o,n,r)};y.escape=Yt;y.Scanner=pe;y.Context=re;y.Writer=h;class St{constructor(t,o){this.template=t,this.state=o,this.ast=y.parse(t)}getValue(){return this.value===void 0&&(this.value=y.render(this.template,this.state)),this.value}onChange(t){const o=[];for(const n of this.getUsedVariables().values())o.push(this.state.onVariableChange(n).subscribe(()=>{const r=y.render(this.template,this.state);r!==this.value&&(this.value=r,t(this.value))}));return{unsubscribe:()=>{for(const n of o)n.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const t=new Set;return this.recursiveGetUsedVariables(this.ast,t),t}recursiveGetUsedVariables(t,o){for(const n of t){const r=n[0],s=n[1],a=n[4];["name","&","#","^"].includes(r)&&o.add(s),a!==void 0&&typeof a!="string"&&this.recursiveGetUsedVariables(a,o)}}}async function Xt(){var e;const t=await vt();for(const o of t){const n=(e=o.properties)!==null&&e!==void 0?e:[];for(const r of n){if(r.type==="int"||r.type==="bool"||r.type==="object"||typeof r.value!="string")continue;const s=new St(r.value,WA.state);if(s.isPureString())continue;const a=s.getValue();await Ke(o.name,r.name,a),s.onChange(async i=>{await Ke(o.name,r.name,i)})}}}async function Jt(){var e;const t=await ue();for(const[o,n]of t.entries())if(n.type!=="objectgroup"){const r=(e=n.properties)!==null&&e!==void 0?e:[];for(const s of r){if(s.type==="int"||s.type==="bool"||s.type==="object"||typeof s.value!="string")continue;const a=new St(s.value,WA.state);if(a.isPureString())continue;const i=a.getValue();Xe(o,s.name,i),a.onChange(c=>{Xe(o,s.name,c)})}}}async function Ke(e,t,o){console.log(e),(await WA.room.area.get(e)).setProperty(t,o)}function Xe(e,t,o){WA.room.setProperty(e,t,o),t==="visible"&&(o?WA.room.showLayer(e):WA.room.hideLayer(e))}const $t="https://admin.workadventu.re/html";let Me,He=0,Fe=0;function Je(e){if(WA.state[e.name]){let t=e.properties.mustGetString("openLayer");for(const o of t.split(`
`))WA.room.showLayer(o);t=e.properties.mustGetString("closeLayer");for(const o of t.split(`
`))WA.room.hideLayer(o)}else{let t=e.properties.mustGetString("openLayer");for(const o of t.split(`
`))WA.room.hideLayer(o);t=e.properties.mustGetString("closeLayer");for(const o of t.split(`
`))WA.room.showLayer(o)}}function Zt(e){const t=e.properties.getString("openSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=Et(e.properties.mustGetString("openLayer").split(`
`));if(r>o)return;n=1-r/o}t&&WA.sound.loadSound(t).play({volume:n})}function eo(e){const t=e.properties.getString("closeSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=Et(e.properties.mustGetString("closeLayer").split(`
`));if(r>o)return;n=1-r/o}t&&WA.sound.loadSound(t).play({volume:n})}function kt(e){return e.map(t=>Me.get(t)).filter(t=>(t==null?void 0:t.type)==="tilelayer")}function Et(e){const t=kt(e),o=Pt(t),n=((o.right-o.left)/2+o.left)*32,r=((o.bottom-o.top)/2+o.top)*32;return Math.sqrt(Math.pow(He-n,2)+Math.pow(Fe-r,2))}function to(e){WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]?Zt(e):eo(e),Je(e)}),Je(e)}function $e(e,t,o,n){const r=e.name;let s,a,i=!1;const c=o.getString("tag");let u=!0;c&&!WA.player.tags.includes(c)&&(u=!1);const f=!!c;function g(){var l;s&&s.remove(),s=WA.ui.displayActionMessage({message:(l=o.getString("closeTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to close the door",callback:()=>{WA.state[t.name]=!1,S()}})}function S(){var l;s&&s.remove(),s=WA.ui.displayActionMessage({message:(l=o.getString("openTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to open the door",callback:()=>{WA.state[t.name]=!0,g()}})}function fe(){let l;if(e.type==="tilelayer")l=Pt(kt(t.properties.mustGetString("closeLayer").split(`
`)));else{if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)throw new Error(`Doorstep zone "${e.name}" is missing x, y, width or height`);l={top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}a=WA.room.website.create({name:"doorKeypad"+r,url:n+"/keypad.html#"+encodeURIComponent(r),position:{x:l.right*32,y:l.top*32,width:32*3,height:32*4},allowApi:!0})}function ae(){a&&(WA.room.website.delete(a.name),a=void 0)}function p(){if(i=!0,o.getBoolean("autoOpen")&&u){WA.state[t.name]=!0;return}if(!WA.state[t.name]&&(f&&!u||!f)&&(o.getString("code")||o.getString("codeVariable"))){fe();return}u&&(WA.state[t.name]?g():S())}function k(){i=!1,o.getBoolean("autoClose")&&(WA.state[t.name]=!1),s&&s.remove(),ae()}e.type==="tilelayer"?(WA.room.onEnterLayer(r).subscribe(p),WA.room.onLeaveLayer(r).subscribe(k)):(WA.room.area.onEnter(r).subscribe(p),WA.room.area.onLeave(r).subscribe(k)),WA.state.onVariableChange(t.name).subscribe(()=>{i&&(!o.getBoolean("autoClose")&&WA.state[t.name]===!0&&g(),a&&WA.state[t.name]===!0&&ae(),!o.getBoolean("autoOpen")&&WA.state[t.name]===!1&&S())})}function oo(e){const t=e.properties.mustGetString("bellSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=Math.sqrt(Math.pow(e.x-He,2)+Math.pow(e.y-Fe,2));if(r>o)return;n=1-r/o}WA.sound.loadSound(t).play({volume:n})}function no(e){WA.state[e.name]===void 0&&(WA.state[e.name]=0),WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]&&oo(e)})}function Ze(e,t,o){let n;const r=t.getString("bellPopup");if(o.type==="tilelayer"){const s=o.name;WA.room.onEnterLayer(s).subscribe(()=>{var a;r?n=WA.ui.openPopup(r,"",[{label:(a=t.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.onLeaveLayer(s).subscribe(()=>{n&&(n.close(),n=void 0)})}else{const s=o.name;WA.room.area.onEnter(s).subscribe(()=>{var a;r?n=WA.ui.openPopup(r,"",[{label:(a=t.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.area.onLeave(s).subscribe(()=>{n&&(n.close(),n=void 0)})}}async function ro(e){e=e??$t;const t=await It();Me=await ue();for(const o of t.values())o.properties.get("door")&&to(o),o.properties.get("bell")&&no(o);for(const o of Me.values()){const n=new ne(o.properties),r=n.getString("doorVariable");if(r&&o.type==="tilelayer"){const a=t.get(r);if(a===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of layer "'+o.name+'"');$e(o,a,n,e)}const s=n.getString("bellVariable");s&&o.type==="tilelayer"&&Ze(s,n,o)}for(const o of await vt()){const n=new ne(o.properties),r=n.getString("doorVariable");if(r){const a=t.get(r);if(a===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of object "'+o.name+'"');$e(o,a,n,e)}const s=n.getString("bellVariable");s&&Ze(s,n,o)}WA.player.onPlayerMove(o=>{He=o.x,Fe=o.y})}function so(e,t){const o=e.getString("bindVariable");if(o){const n=e.get("enterValue"),r=e.get("leaveValue"),s=e.getString("triggerMessage"),a=e.getString("tag");ao(o,t,n,r,s,a)}}let he;function ao(e,t,o,n,r,s){s&&!WA.player.tags.includes(s)||(o!==void 0&&WA.room.onEnterLayer(t).subscribe(()=>{r?he=WA.ui.displayActionMessage({type:"message",message:r,callback:()=>{WA.state[e]=o}}):WA.state[e]=o}),n!==void 0&&WA.room.onLeaveLayer(t).subscribe(()=>{WA.state[e]=n,he&&(he.remove().catch(a=>{console.error(a)}),he=void 0)}))}async function io(){const e=await ue();for(const t of e.values()){const o=new ne(t.properties);so(o,t.name)}}let et;async function co(e){const t=await WA.room.getTiledMap();e=e??At,et=await ue();const o=t.layers.find(n=>n.name==="configuration");if(o){const r=new ne(o.properties).getString("tag");(!r||WA.player.tags.includes(r))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(e+"/configuration.html",!0)});for(const s of et.values()){const a=new ne(s.properties),i=a.getString("openConfig");i&&s.type==="tilelayer"&&lo(i.split(","),s.name,a)}}}function lo(e,t,o){let n;const r=o.getString("openConfigAdminTag");let s=!0;r&&!WA.player.tags.includes(r)&&(s=!1);function a(){var c;n&&n.remove(),n=WA.ui.displayActionMessage({message:(c=o.getString("openConfigTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE or touch here to configure",callback:()=>Qe(e)})}function i(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(t).subscribe(()=>{const c=o.getString("openConfigTrigger");s&&(c&&c==="onaction"?a():Qe(e))}),WA.room.onLeaveLayer(t).subscribe(()=>{n&&n.remove(),i()})}function uo(){return WA.onInit().then(()=>{ro().catch(e=>console.error(e)),io().catch(e=>console.error(e)),co().catch(e=>console.error(e)),Jt().catch(e=>console.error(e)),Xt().catch(e=>console.error(e))}).catch(e=>console.error(e))}let Y;function po(){WA.room.area.onEnter("clock").subscribe(()=>{const e=new Date,t=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");Y&&Y.close(),Y=WA.ui.openPopup("clockPopup",`It's ${t}:${o}`,[])}),WA.room.area.onLeave("clock").subscribe(()=>{Y&&(Y.close(),Y=void 0)})}let ye;function fo(){const e=()=>{ye&&(ye.close(),ye=void 0)};WA.room.area.onEnter("board").subscribe(()=>{e();const t="The bulletin board hums with strange energy. Five portals shimmer before you—choose your path: 💜 Malware — malicious code that corrupts, spies, and destroys • 🔵 Phishing/Quishing — fake messages or QR Codes that trick you into giving secrets • 🔴 Identity Theft — criminals using your identity • 🟡 xxxxxxxxxxxx • 💚 Password Security — strong, unique passwords and MFA to protect your accounts.";ye=WA.ui.openPopup("boardPopup",t,[])}),WA.room.area.onLeave("board").subscribe(e)}let q;function we(){var e;if(q){try{(e=q.close)==null||e.call(q)}catch{}q=void 0}}function ho(){var e,t;try{const o=(t=(e=WA.room.object)==null?void 0:e.get)==null?void 0:t.call(e,"MarvieZone");if(o&&o.properties){const n=o.properties;if(Array.isArray(n)){const r=n.find(s=>s.name==="marvieMessage"||s.name==="marviePopup");if(r!=null&&r.value)return String(r.value)}else if(n.marvieMessage)return String(n.marvieMessage)}}catch{}return["👋 Hi — I'm Marvie.","","Welcome to the Room of Malware.","Do you think you can find the 3 easter eggs around the map?","Tip: Check the walls, the chairs or the floor for suspicious objects."].join(`
`)}function yo(){console.log("[Marvie] init"),WA.room.area.onEnter("MarvieZone").subscribe(()=>{we();const e=ho();q=WA.ui.openPopup("marviePopup",e,[{label:"Got it",callback:()=>we()}])}),WA.room.area.onLeave("MarvieZone").subscribe(()=>{we()})}const go={library:{tasks:[{key:"phishing_SMSphishing",label:"SMS",area:"phishing_SMSphishing"},{key:"phishing_MurdochEmail",label:"MurdochEmail",area:"phishing_MurdochEmail"},{key:"phishing_QRcode",label:"QRcode",area:"phishing_QRcode"},{key:"phishing_instructions",label:"PPT Slides",area:"phishing_instructions"}],exitGate:{area:"to-canteen",nextRoom:"canteen.tmj#from-library",warnAnchorId:"phishing_gate_popup"}}},mo={canteen:{tasks:[{key:"malware_instructions",label:"Slides",area:"malware_instructions"},{key:"malware_discord",label:"Discord",area:"malware_discord"},{key:"malware_usbdrive",label:"USB",area:"malware_usbdrive"},{key:"malware_trojan",label:"Trojan",area:"malware_trojan"}],exitGate:{area:"to-classroom",nextRoom:"classroom.tmj#from-canteen",warnAnchorId:"malware_gate_popup"}}},bo={classroom:{tasks:[{key:"passwordsecurity_instructions",label:"Slides",area:"passwordsecurity_instructions"},{key:"passwordsecurity_lmsaccount",label:"LMS Account",area:"passwordsecurity_lmsaccount"},{key:"passwordsecurity_lmspasswordexpired",label:"Password Expired",area:"passwordsecurity_lmspasswordexpired"},{key:"passwordsecurity_unlockedpc",label:"Unlocked PC",area:"passwordsecurity_unlockedpc"}],exitGate:{area:"to-hall",nextRoom:"hall.tmj#from-classroom",warnAnchorId:"passwordsecurity_gate_popup"}}},Ao={...go,...mo,...bo},Ct="cr:goals:",Ve=e=>`${Ct}${e}`;function wo(e,t){try{localStorage.setItem(Ve(e),JSON.stringify(t))}catch{}}function Wo(e){try{const t=localStorage.getItem(Ve(e));return t?JSON.parse(t):null}catch{return null}}function vo(e){try{const t=[];for(let o=0;o<localStorage.length;o++){const n=localStorage.key(o);n&&n.startsWith(Ct)&&!n.endsWith(e)&&t.push(n)}t.forEach(o=>localStorage.removeItem(o))}catch{}}let D={},oe=[],tt=0,M,We=0,z=!1,ot="";function Po(){WA.onInit().then(async()=>{const e=await ko()||"";if(!e){console.log("[ProgressChecker] No mapId resolved.");return}if(ot===e)return;ot=e;const t=Ao[e];if(ve(),vo(e),!t){console.log("[ProgressChecker] No config for map:",e);return}console.log("[ProgressChecker] Init for map:",e),oe=t.tasks;const o=Wo(e);if(D={...Object.fromEntries(oe.map(r=>[r.key,!1])),...o??{}},window.addEventListener("beforeunload",()=>ve(),{passive:!0}),oe.forEach(r=>{try{WA.room.area.onEnter(r.area).subscribe(()=>{z||D[r.key]||(D[r.key]=!0,wo(e,D),rt(),nt()&&WA.ui.displayActionMessage({message:"✅ All tasks done! You may proceed to the exit.",callback:()=>{}}))})}catch(s){console.warn(`[ProgressChecker] area '${r.area}' not found on this map`,s)}}),t.exitGate){const{area:r,nextRoom:s,warnAnchorId:a}=t.exitGate;WA.room.area.onEnter(r).subscribe(()=>{if(z)return;if(nt()){z=!0,ve();try{WA.controls.disablePlayerControls()}catch{}try{localStorage.removeItem(Ve(e))}catch{}setTimeout(()=>WA.nav.goToRoom(s),40);return}const i=Date.now();if(i-We<500)return;We=i;const c=So();if(a)try{ge(),M=WA.ui.openPopup(a,`🚧 Hold up!

You still need to complete:
• ${c.join(`
• `)}

Find all tasks in this room before leaving.`,[{label:"Close",className:"primary",callback:()=>ge()}]);return}catch{}WA.ui.displayActionMessage({message:`🚧 Hold up! Missing: ${c.join(", ")}`,callback:()=>{}})}),WA.room.area.onLeave(r).subscribe(()=>{ge(),z||(We=0)})}setTimeout(()=>{z||rt()},300)})}function nt(){return oe.every(e=>D[e.key])}function So(){return oe.filter(e=>!D[e.key]).map(e=>e.label)}function rt(){if(z)return;const e=Date.now();if(e-tt<150)return;tt=e;const t=oe.map(o=>D[o.key]?`✅ ${o.label}`:`⬜ ${o.label}`).join("   ");WA.ui.displayActionMessage({message:`Progress:  ${t}`,callback:()=>{}})}function ge(){var e;try{(e=M==null?void 0:M.close)==null||e.call(M)}catch{}M=void 0}function ve(){ge()}async function ko(){var e,t,o;try{const n=decodeURIComponent(location.href).match(/\/([^\/?#]+)\.tmj/i);if(n!=null&&n[1])return n[1].toLowerCase()}catch{}try{const n=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),r=n==null?void 0:n.properties,s=(o=r==null?void 0:r.find(a=>(a==null?void 0:a.name)==="mapId"))==null?void 0:o.value;if(typeof s=="string"&&s.trim())return s.trim().toLowerCase()}catch{}return""}let _;const st="phishing_QRcode",Eo="phishing_QRcodePopup";function Co(){WA.onInit().then(()=>{WA.room.area.onEnter(st).subscribe(()=>{Pe(),_=WA.ui.openPopup(Eo,"🍗 You spot a poster in the library:“FREE NUGGETS FOR LIFE – Scan Me!” Your friend insists it looks real, but scanning random QR codes can lead to fake websites or data theft. What would you do? Press SPACE to help!",[{label:"Got it",callback:()=>Pe()}])}),WA.room.area.onLeave(st).subscribe(()=>{Pe()})})}function Pe(){var e;try{_&&((e=_.close)==null||e.call(_),_=void 0)}catch{_=void 0}}let I;const at="phishing_MurdochEmail",Mo="phishing_MurdochEmailPopup";function _o(){WA.onInit().then(()=>{WA.room.area.onEnter(at).subscribe(()=>{Se(),I=WA.ui.openPopup(Mo,`📧 You received an email: “Your university fees are overdue. Click here to pay immediately.”

⚠️ This looks suspicious... What would you do? Press SPACE to help!`,[{label:"Got it",callback:()=>Se()}])}),WA.room.area.onLeave(at).subscribe(()=>{Se()})})}function Se(){var e;try{I&&((e=I.close)==null||e.call(I),I=void 0)}catch{I=void 0}}let L;const it="phishing_SMSphishing",Io="phishing_SMSphishingPopup";function Lo(){WA.onInit().then(()=>{WA.room.area.onEnter(it).subscribe(()=>{ke(),L=WA.ui.openPopup(Io,"🔗 You received a message: “Your Murdoch account needs verification! Click here: https://tinyurl.com/murdoch-reset. Shortened links can hide where they actually lead. Always check the real destination before clicking! What would you do? Press SPACE to help!",[{label:"Got it",callback:()=>ke()}])}),WA.room.area.onLeave(it).subscribe(()=>{ke()})})}function ke(){var e;try{L&&((e=L.close)==null||e.call(L),L=void 0)}catch{L=void 0}}let K;function To(){WA.onInit().then(()=>{console.log("[WA] Phishing sign instructions ready"),WA.room.area.onEnter("phishing_instructions").subscribe(()=>{No()}),WA.room.area.onLeave("phishing_instructions").subscribe(()=>{_e()})})}function No(){_e(),K=WA.ui.openPopup("phishing_instructionsPopup","🧑‍💻 Quick! We saw one of the hackers going through this room! They are using phishing emails and dodgy QR codes to endanger students on campus! Before you chase after him, you should read these slides to learn how you can defend against Phishing.  ",[{label:"Got it!",className:"primary",callback:()=>_e()}])}function _e(){var e;K&&((e=K.close)==null||e.call(K),K=void 0)}let b,A;function Ee(){var e,t;try{(e=b==null?void 0:b.close)==null||e.call(b)}catch{}b=void 0;try{(t=A==null?void 0:A.unsubscribe)==null||t.call(A)}catch{}A=void 0}function ct(){var e,t;try{(e=b==null?void 0:b.close)==null||e.call(b)}catch{}b=WA.ui.openPopup("phishing_librarySpawnPopup","📌 Please proceed and talk to Professor Byte.",[{label:"OK",callback:Ee}]);try{(t=A==null?void 0:A.unsubscribe)==null||t.call(A)}catch{}A=WA.room.area.onLeave("from-garden").subscribe(Ee),setTimeout(()=>{Ee()},5e3)}function xo(){WA.onInit().then(()=>{WA.room.area.onEnter("from-garden").subscribe(ct),setTimeout(()=>{WA.player.getPosition().then(()=>ct())},250)})}let T,H,F,lt=!1;const ut="billboard",Go="billboardPopup";function ce(){var e;try{(e=T==null?void 0:T.close)==null||e.call(T)}catch{}T=void 0}function Oo(){lt||(lt=!0,WA.onInit().then(()=>{var e,t,o,n,r,s;try{(e=H==null?void 0:H.unsubscribe)==null||e.call(H)}catch{}try{(t=F==null?void 0:F.unsubscribe)==null||t.call(F)}catch{}H=WA.room.area.onEnter(ut).subscribe(()=>{console.log("[billboard] enter"),ce(),T=WA.ui.openPopup(Go,`📜 The community billboard

➡️ Move towards the ladder on the right and begin your adventure!`,[{label:"Close",className:"primary",callback:()=>ce()}])}),F=WA.room.area.onLeave(ut).subscribe(()=>{console.log("[billboard] leave"),ce()}),(s=(n=(o=WA.room).onLeaveLayer)==null?void 0:(r=n.call(o,"**")).subscribe)==null||s.call(r,()=>ce()),window.addEventListener("blur",ce)}))}let X;function Ro(){WA.onInit().then(()=>{setTimeout(jo,50)})}function jo(){pt(),X=WA.ui.openPopup("spawnIntroPopup","👋 Welcome! Use the Arrow Keys or WASD to move. Explore the map and look for Professor Byte for guidance. Tip: Walk close to objects (signs, boards, NPCs) to interact with them.",[{label:"Got it",className:"primary",callback:e=>{var t;try{(t=e.close)==null||t.call(e)}catch{}pt()}}])}function pt(){var e;if(X){try{(e=X.close)==null||e.call(X)}catch{}X=void 0}}let N,V,Q,ft=!1;const dt="instructions",Bo="instructionsPopup";function Uo(){ft||(ft=!0,WA.onInit().then(()=>{var e,t;try{(e=V==null?void 0:V.unsubscribe)==null||e.call(V)}catch{}try{(t=Q==null?void 0:Q.unsubscribe)==null||t.call(Q)}catch{}V=WA.room.area.onEnter(dt).subscribe(()=>{Ce(),N=WA.ui.openPopup(Bo,"🏫 Thank the heavens you're here! Brave student, Murdoch University is under a Cyber Attack! We need your help to protect the school against evildoers who wish us harm. Please proceed through the school and learn about how you can help us!",[{label:"Close",className:"primary",callback:()=>Ce()}])}),Q=WA.room.area.onLeave(dt).subscribe(()=>{Ce()})}))}function Ce(){var e;try{(e=N==null?void 0:N.close)==null||e.call(N)}catch{}N=void 0}const Do="posterPopup";let w;function Yo(e){var t;try{(t=w==null?void 0:w.close)==null||t.call(w)}catch{}w=WA.ui.openPopup(Do,e,[])}function Ho(){var e;try{(e=w==null?void 0:w.close)==null||e.call(w)}catch{}w=void 0}function Fo(){WA.room.area.onEnter("poster").subscribe(()=>{Yo(`🪧 You notice a faded poster: "Think Before You Click! Your Cyber Kingdom Depends On It."

💭 You: (to yourself) 'Think before you click.' That's a good motto.

📢 Narrator: Always pause before clicking unknown links. Your vigilance protects your cyber kingdom!`)}),WA.room.area.onLeave("poster").subscribe(Ho)}const Vo="usbdrivePopup";let W;function Qo(e){var t;try{(t=W==null?void 0:W.close)==null||t.call(W)}catch{}W=WA.ui.openPopup(Vo,e,[])}function qo(){var e;try{(e=W==null?void 0:W.close)==null||e.call(W)}catch{}W=void 0}function zo(){WA.room.area.onEnter("usbdrive").subscribe(()=>{Qo(`💾 You spot a random USB drive on the floor.

💭 You: Should I plug this into a PC and see what's inside?

📢 Narrator: Never plug in unknown USBs. They can hide malware that runs automatically. If you find one in real life, hand it to IT/Security instead of investigating it yourself.`)}),WA.room.area.onLeave("usbdrive").subscribe(qo)}const Ko="stickynotePopup";let v;function Xo(e){var t;try{(t=v==null?void 0:v.close)==null||t.call(v)}catch{}v=WA.ui.openPopup(Ko,e,[])}function Jo(){var e;try{(e=v==null?void 0:v.close)==null||e.call(v)}catch{}v=void 0}function $o(){WA.room.area.onEnter("stickynote").subscribe(()=>{Xo(`📝 A sticky note is stuck to the monitor: “Email PW: P@ssw0rd123”.

💭 You: Wah… someone actually wrote their password here.

📢 Narrator: Don’t write passwords on paper or share them. Use a password manager, create unique passphrases, and always enable MFA (multi-factor authentication).`)}),WA.room.area.onLeave("stickynote").subscribe(Jo)}const Zo="instructions_safeinternetpracticesPopup";let P;function en(e){var t;try{(t=P==null?void 0:P.close)==null||t.call(P)}catch{}P=WA.ui.openPopup(Zo,e,[])}function tn(){var e;try{(e=P==null?void 0:P.close)==null||e.call(P)}catch{}P=void 0}function on(){WA.room.area.onEnter("instructions_safeinternetpractices").subscribe(()=>{en(`🛡️ Welcome to the Safe Internet Practices office!

• Explore the room and look for hidden clues (poster, USB drive, sticky note).
• Read your character’s thoughts and the narrator’s tips.
• Learn to: think before you click, protect passwords, and avoid risky devices.

When you’re done, proceed to the exit to continue your mission.`)}),WA.room.area.onLeave("instructions_safeinternetpractices").subscribe(tn)}const d={poster:!1,usbdrive:!1,stickynote:!1,AmeliaZone:!1},nn="to-hall",rn="hall.tmj#from-canteen";function sn(){WA.onInit().then(()=>{console.log("[OfficeProgress] ready"),["poster","usbdrive","stickynote"].forEach(e=>{WA.room.area.onEnter(e).subscribe(()=>{console.log(`[OfficeProgress] ENTER ${e}`),d[e]||(d[e]=!0,yt())})}),WA.room.area.onEnter("AmeliaZone").subscribe(()=>{console.log("[OfficeProgress] ENTER AmeliaZone"),d.AmeliaZone||(d.AmeliaZone=!0,yt())}),WA.room.area.onEnter(nn).subscribe(()=>{console.log("[OfficeProgress] ENTER EXIT, allDone =",ht()),ht()?WA.nav.goToRoom(rn):WA.ui.openPopup("safeinternet_gate_popup",`🚧 Hold up!

You still need to complete:
• ${an().join(`
• `)}

Find all 3 clues and talk to Amelia before leaving.`,[{label:"OK",className:"primary",callback:e=>e.close()}])})})}function ht(){return d.poster&&d.usbdrive&&d.stickynote&&d.AmeliaZone}function an(){const e=[];return d.poster||e.push("Old Security Poster"),d.usbdrive||e.push("USB Drive"),d.stickynote||e.push("Sticky Note"),d.AmeliaZone||e.push("Talk to Amelia (NPC)"),e}function yt(){const e=[d.poster?"✅ Poster":"⬜ Poster",d.usbdrive?"✅ USB":"⬜ USB",d.stickynote?"✅ Sticky":"⬜ Sticky Note",d.AmeliaZone?"✅ Amelia":"⬜ Amelia"].join("   ");WA.ui.displayActionMessage({message:`Progress: ${e}`,callback:()=>{}})}let J;function cn(){WA.onInit().then(()=>{console.log("[WA] Malware instructions ready"),WA.room.area.onEnter("malware_instructions").subscribe(()=>{ln()}),WA.room.area.onLeave("malware_instructions").subscribe(()=>{Ie()})})}function ln(){Ie(),J=WA.ui.openPopup("malware_instructionsPopup","🧑‍💻 Congratulations on clearing the first room! But we have a long way to go before we’re ready to really protect Murdoch... In this room, you’ll learn more about Malware and the best ways to protect against it. To begin, go through the slides by pressing SPACE.",[{label:"Got it!",className:"primary",callback:()=>Ie()}])}function Ie(){var e;if(J){try{(e=J.close)==null||e.call(J)}catch{}J=void 0}}let x;const gt="malware_discord",un="malware_discordPopup";function pn(){WA.onInit().then(()=>{console.log("[WA] Malware Discord popup ready"),WA.room.area.onEnter(gt).subscribe(()=>{fn()}),WA.room.area.onLeave(gt).subscribe(()=>{Le()})})}function fn(){Le(),x=WA.ui.openPopup(un,`💬 Friend sent a file

Your friend DMs you on Discord about a program that “unlocks Discord Nitro Premium for life” and says it’s safe because they used it.

What would you do? Press SPACE to help!`,[{label:"Got it!",className:"primary",callback:()=>Le()}])}function Le(){var e;try{(e=x==null?void 0:x.close)==null||e.call(x)}catch{}x=void 0}let G;const mt="malware_usbdrive",dn="malware_usbdrivePopup";function hn(){WA.onInit().then(()=>{console.log("[WA] Malware USB Drive popup ready"),WA.room.area.onEnter(mt).subscribe(()=>{yn()}),WA.room.area.onLeave(mt).subscribe(()=>{Te()})})}function yn(){Te(),G=WA.ui.openPopup(dn,`💾 Found USB

You spot a USB drive on the canteen floor. It looks unopened and you’re curious about what’s inside.

What would you do? Press SPACE to help!`,[{label:"Got it!",className:"primary",callback:()=>Te()}])}function Te(){var e;try{(e=G==null?void 0:G.close)==null||e.call(G)}catch{}G=void 0}let O;const bt="malware_trojan",gn="malware_trojanPopup";function mn(){WA.onInit().then(()=>{console.log("[WA] Malware Trojan popup ready"),WA.room.area.onEnter(bt).subscribe(()=>{bn()}),WA.room.area.onLeave(bt).subscribe(()=>{Ne()})})}function bn(){Ne(),O=WA.ui.openPopup(gn,`🛡️ Malware Detection

A system alert appears: “Windows Defender Virus Protection found an unwanted app (type: Trojan).”

What would you do? Press SPACE to help!`,[{label:"Got it!",className:"primary",callback:()=>Ne()}])}function Ne(){var e;try{(e=O==null?void 0:O.close)==null||e.call(O)}catch{}O=void 0}let $;function An(){WA.onInit().then(()=>{console.log("[WA] Password Security instructions ready"),WA.room.area.onEnter("passwordsecurity_instructions").subscribe(()=>{wn()}),WA.room.area.onLeave("passwordsecurity_instructions").subscribe(()=>{xe()})})}function wn(){xe(),$=WA.ui.openPopup("passwordsecurity_instructionsPopup","🧑‍🏫 Thank goodness you’re here! The hackers are after our passwords, and we need your help to secure them! ➡️ To begin, go through the slides to learn more about Passsword Security by pressing SPACE. Afterwards, help us defend the school!",[{label:"Got it!",className:"primary",callback:()=>xe()}])}function xe(){var e;if($){try{(e=$.close)==null||e.call($)}catch{}$=void 0}}let Z;function Wn(){WA.onInit().then(()=>{console.log("[WA] Password Security - LMS Account scenario ready"),WA.room.area.onEnter("passwordsecurity_lmsaccount").subscribe(()=>{vn()}),WA.room.area.onLeave("passwordsecurity_lmsaccount").subscribe(()=>{Ge()})})}function vn(){Ge(),Z=WA.ui.openPopup("passwordsecurity_lmsaccountPopup","👩‍💻 Your classmate Joyce says she forgot her LMS login and asks to borrow your account to check the quiz questions. What would you do? Press SPACE to help!",[{label:"Let's decide!",className:"primary",callback:()=>Ge()}])}function Ge(){var e;if(Z){try{(e=Z.close)==null||e.call(Z)}catch{}Z=void 0}}let ee;function Pn(){WA.onInit().then(()=>{console.log("[WA] Password Security - LMS Password Expired scenario ready"),WA.room.area.onEnter("passwordsecurity_lmspasswordexpired").subscribe(()=>{Sn()}),WA.room.area.onLeave("passwordsecurity_lmspasswordexpired").subscribe(()=>{Oe()})})}function Sn(){Oe(),ee=WA.ui.openPopup("passwordsecurity_lmspasswordexpiredPopup","🔑 Your LMS password has just expired! The system is asking you to create a new one. How will you choose your new password? Press SPACE to help!",[{label:"Let's find out!",className:"primary",callback:()=>Oe()}])}function Oe(){var e;if(ee){try{(e=ee.close)==null||e.call(ee)}catch{}ee=void 0}}let te;function kn(){WA.onInit().then(()=>{console.log("[WA] Password Security - Unlocked PC scenario ready"),WA.room.area.onEnter("passwordsecurity_unlockedpc").subscribe(()=>{En()}),WA.room.area.onLeave("passwordsecurity_unlockedpc").subscribe(()=>{Re()})})}function En(){Re(),te=WA.ui.openPopup("passwordsecurity_unlockedpcPopup","💻 You notice an unlocked PC with a teacher’s account signed in — an Excel sheet is open showing login details! What should you do? Press SPACE to help!",[{label:"I'll check!",className:"primary",callback:()=>Re()}])}function Re(){var e;if(te){try{(e=te.close)==null||e.call(te)}catch{}te=void 0}}let R;function Cn(){WA.onInit().then(()=>{console.log("[WA] Safe Internet Practices – Free Wi-Fi ready"),WA.room.area.onEnter("safeinternetpractices_freewifi").subscribe(()=>Mn()),WA.room.area.onLeave("safeinternetpractices_freewifi").subscribe(()=>je())})}function Mn(){je(),R=WA.ui.openPopup("safeinternetpractices_freewifiPopup","📶 In the hall, you spot a wall sign offering **Free Wi-Fi**. Nearby, you see open networks like “HallGuest” and “CampusFree”. How would you get online safely? Press SPACE to help!",[{label:"Got it",className:"primary",callback:()=>je()}])}function je(){var e;try{(e=R==null?void 0:R.close)==null||e.call(R)}catch{}R=void 0}let j;function _n(){WA.onInit().then(()=>{console.log("[WA] Safe Internet Practices – File Uploads ready"),WA.room.area.onEnter("safeinternetpractices_fileuploads").subscribe(()=>In()),WA.room.area.onLeave("safeinternetpractices_fileuploads").subscribe(()=>Be())})}function In(){Be(),j=WA.ui.openPopup("safeinternetpractices_fileuploadsPopup","💬 Hey! Can you help me edit this PDF file? I found some free online tools that lets you upload and edit PDFs easily! What would you do? Press SPACE to help!",[{label:"Let’s see!",className:"primary",callback:()=>Be()}])}function Be(){var e;try{(e=j==null?void 0:j.close)==null||e.call(j)}catch{}j=void 0}let B;function Ln(){WA.onInit().then(()=>{console.log("[WA] Safe Internet Practices – Outdated Software ready"),WA.room.area.onEnter("safeinternetpractices_outdatedsoftware").subscribe(()=>Tn()),WA.room.area.onLeave("safeinternetpractices_outdatedsoftware").subscribe(()=>Ue())})}function Tn(){Ue(),B=WA.ui.openPopup("safeinternetpractices_outdatedsoftwarePopup","🧑‍💻 You saw a laptop on the floor, you picked it up and open your browser to check your bank account, but a message appears saying your browser needs an update. What will you do? Press SPACE to help!",[{label:"Let’s decide!",className:"primary",callback:()=>Ue()}])}function Ue(){var e;try{(e=B==null?void 0:B.close)==null||e.call(B)}catch{}B=void 0}let U;function Nn(){WA.onInit().then(()=>{console.log("[WA] Safe Internet Practices instructions ready"),WA.room.area.onEnter("safeinternetpractices_instructions").subscribe(()=>xn()),WA.room.area.onLeave("safeinternetpractices_instructions").subscribe(()=>De())})}function xn(){De(),U=WA.ui.openPopup("safeinternetpractices_instructionsPopup","🏫 You’ve made it through 3 of the topics, well done! But there’s more we need to learn before we’re truly ready to defeat the malicious actors. Please press SPACE to talk to me before you explore the room!",[{label:"Got it!",className:"primary",callback:()=>De()}])}function De(){var e;try{(e=U==null?void 0:U.close)==null||e.call(U)}catch{}U=void 0}console.log("Script started");WA.onInit().then(async()=>{console.log("Scripting API ready"),await uo(),po(),fo(),yo(),Po();const e=await Gn();console.log("[Router] mapId =",e||"(unknown)"),e==="garden"?(console.log("[Router] Initializing GARDEN features…"),Oo(),Ro(),Uo(),Fo(),zo(),$o(),on(),sn()):e==="library"?(console.log("[Router] Initializing LIBRARY (Phishing) features…"),Co(),_o(),Lo(),To(),xo()):e==="canteen"?(console.log("[Router] Initializing CANTEEN (Malware) features…"),cn(),pn(),hn(),mn()):e==="classroom"?(console.log("[Router] Initializing CLASSROOM (Password Security) features…"),An(),Wn(),Pn(),kn()):e==="hall"?(console.log("[Router] Initializing HALL (Safe Internet Practices) features…"),Cn(),_n(),Ln(),Nn()):console.warn("[Router] Unknown map; only common features started. Set a Tiled Map Property `mapId` (string) to enable map-specific inits.")});async function Gn(){var e,t,o;try{const r=decodeURIComponent(window.location.href).match(/\/([^\/?#]+)\.tmj/i);if(r!=null&&r[1])return r[1].toLowerCase()}catch{}try{const n=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),r=((n==null?void 0:n.url)??(n==null?void 0:n.name)??"").toString();if(r){const i=(r.split("/").pop()||r).toLowerCase();return i.endsWith(".tmj")?i.replace(/\.tmj$/,""):i}const s=n==null?void 0:n.properties,a=(o=s==null?void 0:s.find(i=>(i==null?void 0:i.name)==="mapId"))==null?void 0:o.value;if(typeof a=="string"&&a.trim())return a.trim().toLowerCase()}catch{}return""}
//# sourceMappingURL=main-176da504.js.map
