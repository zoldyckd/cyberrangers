class Z{constructor(t){this.properties=t??[]}get(t){const o=this.properties.filter(n=>n.name===t).map(n=>n.value);if(o.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(o.length!==0)return o[0]}getString(t){return this.getByType(t,"string")}getNumber(t){return this.getByType(t,"number")}getBoolean(t){return this.getByType(t,"boolean")}getByType(t,o){const n=this.get(t);if(n!==void 0){if(o!=="json"&&typeof n!==o)throw new Error('Expected property "'+t+'" to have type "'+o+'"');return n}}mustGetString(t){return this.mustGetByType(t,"string")}mustGetNumber(t){return this.mustGetByType(t,"number")}mustGetBoolean(t){return this.mustGetByType(t,"boolean")}mustGetByType(t,o){const n=this.get(t);if(n===void 0)throw new Error('Property "'+t+'" is missing');if(o!=="json"&&typeof n!==o)throw new Error('Expected property "'+t+'" to have type "'+o+'"');return n}getType(t){const o=this.properties.filter(n=>n.name===t).map(n=>n.type);if(o.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(o.length!==0)return o[0]}}const pt="https://unpkg.com/@workadventure/scripting-api-extra@1.9.10/dist";class vt{constructor(t){this.name=t.name,this.x=t.x,this.y=t.y,this.properties=new Z(t.properties)}get isReadable(){const t=this.properties.getString("readableBy");return t?WA.player.tags.includes(t):!0}get isWritable(){const t=this.properties.getString("writableBy");return t?WA.player.tags.includes(t):!0}}function je(e){const t=e?"#"+e.join():"";WA.nav.openCoWebSite(pt+"/configuration.html"+t,!0)}async function Wt(e,t){const o=await WA.room.getTiledMap(),n=new Map;return ht(o.layers,n,e,t),n}function ht(e,t,o,n){for(const r of e)if(r.type==="objectgroup"){for(const s of r.objects)if(s.type==="variable"||s.class==="variable"){if(o&&r.name!==o||n&&!n.includes(s.name))continue;t.set(s.name,new vt(s))}}else r.type==="group"&&ht(r.layers,t,o,n)}let fe;async function ae(){return fe===void 0&&(fe=Pt()),fe}async function Pt(){return kt(await WA.room.getTiledMap())}function kt(e){const t=new Map;return dt(e.layers,"",t),t}function dt(e,t,o){for(const n of e)n.type==="group"?dt(n.layers,t+n.name+"/",o):(n.name=t+n.name,o.set(n.name,n))}async function ft(){const e=await ae(),t=[];for(const o of e.values())if(o.type==="objectgroup")for(const n of o.objects)(n.type==="area"||n.class==="area")&&t.push(n);return t}function St(e){let t=1/0,o=1/0,n=0,r=0;const s=e.data;if(typeof s=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let a=0;a<e.height;a++)for(let i=0;i<e.width;i++)s[i+a*e.width]!==0&&(t=Math.min(t,i),r=Math.max(r,i),o=Math.min(o,a),n=Math.max(n,a));return{top:o,left:t,right:r+1,bottom:n+1}}function yt(e){let t=1/0,o=1/0,n=0,r=0;for(const s of e){const a=St(s);a.left<t&&(t=a.left),a.top<o&&(o=a.top),a.right>r&&(r=a.right),a.bottom>n&&(n=a.bottom)}return{top:o,left:t,right:r,bottom:n}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var Et=Object.prototype.toString,te=Array.isArray||function(t){return Et.call(t)==="[object Array]"};function Ne(e){return typeof e=="function"}function Ct(e){return te(e)?"array":typeof e}function ye(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Be(e,t){return e!=null&&typeof e=="object"&&t in e}function Mt(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var Lt=RegExp.prototype.test;function _t(e,t){return Lt.call(e,t)}var It=/\S/;function Tt(e){return!_t(It,e)}var Rt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Nt(e){return String(e).replace(/[&<>"'`=\/]/g,function(o){return Rt[o]})}var xt=/\s*/,Ot=/\s+/,Ue=/\s*=/,Gt=/\s*\}/,jt=/#|\^|\/|>|\{|&|=|!/;function Bt(e,t){if(!e)return[];var o=!1,n=[],r=[],s=[],a=!1,i=!1,c="",u=0;function h(){if(a&&!i)for(;s.length;)delete r[s.pop()];else s=[];a=!1,i=!1}var g,k,ce;function oe(E){if(typeof E=="string"&&(E=E.split(Ot,2)),!te(E)||E.length!==2)throw new Error("Invalid tags: "+E);g=new RegExp(ye(E[0])+"\\s*"),k=new RegExp("\\s*"+ye(E[1])),ce=new RegExp("\\s*"+ye("}"+E[1]))}oe(t||y.tags);for(var p=new ie(e),S,l,m,ne,le,C;!p.eos();){if(S=p.pos,m=p.scanUntil(g),m)for(var de=0,wt=m.length;de<wt;++de)ne=m.charAt(de),Tt(ne)?(s.push(r.length),c+=ne):(i=!0,o=!0,c+=" "),r.push(["text",ne,S,S+1]),S+=1,ne===`
`&&(h(),c="",u=0,o=!1);if(!p.scan(g))break;if(a=!0,l=p.scan(jt)||"name",p.scan(xt),l==="="?(m=p.scanUntil(Ue),p.scan(Ue),p.scanUntil(k)):l==="{"?(m=p.scanUntil(ce),p.scan(Gt),p.scanUntil(k),l="&"):m=p.scanUntil(k),!p.scan(k))throw new Error("Unclosed tag at "+p.pos);if(l==">"?le=[l,m,S,p.pos,c,u,o]:le=[l,m,S,p.pos],u++,r.push(le),l==="#"||l==="^")n.push(le);else if(l==="/"){if(C=n.pop(),!C)throw new Error('Unopened section "'+m+'" at '+S);if(C[1]!==m)throw new Error('Unclosed section "'+C[1]+'" at '+S)}else l==="name"||l==="{"||l==="&"?i=!0:l==="="&&oe(m)}if(h(),C=n.pop(),C)throw new Error('Unclosed section "'+C[1]+'" at '+p.pos);return Dt(Ut(r))}function Ut(e){for(var t=[],o,n,r=0,s=e.length;r<s;++r)o=e[r],o&&(o[0]==="text"&&n&&n[0]==="text"?(n[1]+=o[1],n[3]=o[3]):(t.push(o),n=o));return t}function Dt(e){for(var t=[],o=t,n=[],r,s,a=0,i=e.length;a<i;++a)switch(r=e[a],r[0]){case"#":case"^":o.push(r),n.push(r),o=r[4]=[];break;case"/":s=n.pop(),s[5]=r[2],o=n.length>0?n[n.length-1][4]:t;break;default:o.push(r)}return t}function ie(e){this.string=e,this.tail=e,this.pos=0}ie.prototype.eos=function(){return this.tail===""};ie.prototype.scan=function(t){var o=this.tail.match(t);if(!o||o.index!==0)return"";var n=o[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};ie.prototype.scanUntil=function(t){var o=this.tail.search(t),n;switch(o){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,o),this.tail=this.tail.substring(o)}return this.pos+=n.length,n};function ee(e,t){this.view=e,this.cache={".":this.view},this.parent=t}ee.prototype.push=function(t){return new ee(t,this)};ee.prototype.lookup=function(t){var o=this.cache,n;if(o.hasOwnProperty(t))n=o[t];else{for(var r=this,s,a,i,c=!1;r;){if(t.indexOf(".")>0)for(s=r.view,a=t.split("."),i=0;s!=null&&i<a.length;)i===a.length-1&&(c=Be(s,a[i])||Mt(s,a[i])),s=s[a[i++]];else s=r.view[t],c=Be(r.view,t);if(c){n=s;break}r=r.parent}o[t]=n}return Ne(n)&&(n=n.call(this.view)),n};function f(){this.templateCache={_cache:{},set:function(t,o){this._cache[t]=o},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}f.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};f.prototype.parse=function(t,o){var n=this.templateCache,r=t+":"+(o||y.tags).join(":"),s=typeof n<"u",a=s?n.get(r):void 0;return a==null&&(a=Bt(t,o),s&&n.set(r,a)),a};f.prototype.render=function(t,o,n,r){var s=this.getConfigTags(r),a=this.parse(t,s),i=o instanceof ee?o:new ee(o,void 0);return this.renderTokens(a,i,n,t,r)};f.prototype.renderTokens=function(t,o,n,r,s){for(var a="",i,c,u,h=0,g=t.length;h<g;++h)u=void 0,i=t[h],c=i[0],c==="#"?u=this.renderSection(i,o,n,r,s):c==="^"?u=this.renderInverted(i,o,n,r,s):c===">"?u=this.renderPartial(i,o,n,s):c==="&"?u=this.unescapedValue(i,o):c==="name"?u=this.escapedValue(i,o,s):c==="text"&&(u=this.rawValue(i)),u!==void 0&&(a+=u);return a};f.prototype.renderSection=function(t,o,n,r,s){var a=this,i="",c=o.lookup(t[1]);function u(k){return a.render(k,o,n,s)}if(c){if(te(c))for(var h=0,g=c.length;h<g;++h)i+=this.renderTokens(t[4],o.push(c[h]),n,r,s);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")i+=this.renderTokens(t[4],o.push(c),n,r,s);else if(Ne(c)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(o.view,r.slice(t[3],t[5]),u),c!=null&&(i+=c)}else i+=this.renderTokens(t[4],o,n,r,s);return i}};f.prototype.renderInverted=function(t,o,n,r,s){var a=o.lookup(t[1]);if(!a||te(a)&&a.length===0)return this.renderTokens(t[4],o,n,r,s)};f.prototype.indentPartial=function(t,o,n){for(var r=o.replace(/[^ \t]/g,""),s=t.split(`
`),a=0;a<s.length;a++)s[a].length&&(a>0||!n)&&(s[a]=r+s[a]);return s.join(`
`)};f.prototype.renderPartial=function(t,o,n,r){if(n){var s=this.getConfigTags(r),a=Ne(n)?n(t[1]):n[t[1]];if(a!=null){var i=t[6],c=t[5],u=t[4],h=a;c==0&&u&&(h=this.indentPartial(a,u,i));var g=this.parse(h,s);return this.renderTokens(g,o,n,h,r)}}};f.prototype.unescapedValue=function(t,o){var n=o.lookup(t[1]);if(n!=null)return n};f.prototype.escapedValue=function(t,o,n){var r=this.getConfigEscape(n)||y.escape,s=o.lookup(t[1]);if(s!=null)return typeof s=="number"&&r===y.escape?String(s):r(s)};f.prototype.rawValue=function(t){return t[1]};f.prototype.getConfigTags=function(t){return te(t)?t:t&&typeof t=="object"?t.tags:void 0};f.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!te(t))return t.escape};var y={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){se.templateCache=e},get templateCache(){return se.templateCache}},se=new f;y.clearCache=function(){return se.clearCache()};y.parse=function(t,o){return se.parse(t,o)};y.render=function(t,o,n,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Ct(t)+'" was given as the first argument for mustache#render(template, view, partials)');return se.render(t,o,n,r)};y.escape=Nt;y.Scanner=ie;y.Context=ee;y.Writer=f;class gt{constructor(t,o){this.template=t,this.state=o,this.ast=y.parse(t)}getValue(){return this.value===void 0&&(this.value=y.render(this.template,this.state)),this.value}onChange(t){const o=[];for(const n of this.getUsedVariables().values())o.push(this.state.onVariableChange(n).subscribe(()=>{const r=y.render(this.template,this.state);r!==this.value&&(this.value=r,t(this.value))}));return{unsubscribe:()=>{for(const n of o)n.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const t=new Set;return this.recursiveGetUsedVariables(this.ast,t),t}recursiveGetUsedVariables(t,o){for(const n of t){const r=n[0],s=n[1],a=n[4];["name","&","#","^"].includes(r)&&o.add(s),a!==void 0&&typeof a!="string"&&this.recursiveGetUsedVariables(a,o)}}}async function Yt(){var e;const t=await ft();for(const o of t){const n=(e=o.properties)!==null&&e!==void 0?e:[];for(const r of n){if(r.type==="int"||r.type==="bool"||r.type==="object"||typeof r.value!="string")continue;const s=new gt(r.value,WA.state);if(s.isPureString())continue;const a=s.getValue();await De(o.name,r.name,a),s.onChange(async i=>{await De(o.name,r.name,i)})}}}async function Ht(){var e;const t=await ae();for(const[o,n]of t.entries())if(n.type!=="objectgroup"){const r=(e=n.properties)!==null&&e!==void 0?e:[];for(const s of r){if(s.type==="int"||s.type==="bool"||s.type==="object"||typeof s.value!="string")continue;const a=new gt(s.value,WA.state);if(a.isPureString())continue;const i=a.getValue();Ye(o,s.name,i),a.onChange(c=>{Ye(o,s.name,c)})}}}async function De(e,t,o){console.log(e),(await WA.room.area.get(e)).setProperty(t,o)}function Ye(e,t,o){WA.room.setProperty(e,t,o),t==="visible"&&(o?WA.room.showLayer(e):WA.room.hideLayer(e))}const Vt="https://admin.workadventu.re/html";let ke,xe=0,Oe=0;function He(e){if(WA.state[e.name]){let t=e.properties.mustGetString("openLayer");for(const o of t.split(`
`))WA.room.showLayer(o);t=e.properties.mustGetString("closeLayer");for(const o of t.split(`
`))WA.room.hideLayer(o)}else{let t=e.properties.mustGetString("openLayer");for(const o of t.split(`
`))WA.room.hideLayer(o);t=e.properties.mustGetString("closeLayer");for(const o of t.split(`
`))WA.room.showLayer(o)}}function Ft(e){const t=e.properties.getString("openSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=bt(e.properties.mustGetString("openLayer").split(`
`));if(r>o)return;n=1-r/o}t&&WA.sound.loadSound(t).play({volume:n})}function Qt(e){const t=e.properties.getString("closeSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=bt(e.properties.mustGetString("closeLayer").split(`
`));if(r>o)return;n=1-r/o}t&&WA.sound.loadSound(t).play({volume:n})}function mt(e){return e.map(t=>ke.get(t)).filter(t=>(t==null?void 0:t.type)==="tilelayer")}function bt(e){const t=mt(e),o=yt(t),n=((o.right-o.left)/2+o.left)*32,r=((o.bottom-o.top)/2+o.top)*32;return Math.sqrt(Math.pow(xe-n,2)+Math.pow(Oe-r,2))}function qt(e){WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]?Ft(e):Qt(e),He(e)}),He(e)}function Ve(e,t,o,n){const r=e.name;let s,a,i=!1;const c=o.getString("tag");let u=!0;c&&!WA.player.tags.includes(c)&&(u=!1);const h=!!c;function g(){var l;s&&s.remove(),s=WA.ui.displayActionMessage({message:(l=o.getString("closeTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to close the door",callback:()=>{WA.state[t.name]=!1,k()}})}function k(){var l;s&&s.remove(),s=WA.ui.displayActionMessage({message:(l=o.getString("openTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to open the door",callback:()=>{WA.state[t.name]=!0,g()}})}function ce(){let l;if(e.type==="tilelayer")l=yt(mt(t.properties.mustGetString("closeLayer").split(`
`)));else{if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)throw new Error(`Doorstep zone "${e.name}" is missing x, y, width or height`);l={top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}a=WA.room.website.create({name:"doorKeypad"+r,url:n+"/keypad.html#"+encodeURIComponent(r),position:{x:l.right*32,y:l.top*32,width:32*3,height:32*4},allowApi:!0})}function oe(){a&&(WA.room.website.delete(a.name),a=void 0)}function p(){if(i=!0,o.getBoolean("autoOpen")&&u){WA.state[t.name]=!0;return}if(!WA.state[t.name]&&(h&&!u||!h)&&(o.getString("code")||o.getString("codeVariable"))){ce();return}u&&(WA.state[t.name]?g():k())}function S(){i=!1,o.getBoolean("autoClose")&&(WA.state[t.name]=!1),s&&s.remove(),oe()}e.type==="tilelayer"?(WA.room.onEnterLayer(r).subscribe(p),WA.room.onLeaveLayer(r).subscribe(S)):(WA.room.area.onEnter(r).subscribe(p),WA.room.area.onLeave(r).subscribe(S)),WA.state.onVariableChange(t.name).subscribe(()=>{i&&(!o.getBoolean("autoClose")&&WA.state[t.name]===!0&&g(),a&&WA.state[t.name]===!0&&oe(),!o.getBoolean("autoOpen")&&WA.state[t.name]===!1&&k())})}function zt(e){const t=e.properties.mustGetString("bellSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=Math.sqrt(Math.pow(e.x-xe,2)+Math.pow(e.y-Oe,2));if(r>o)return;n=1-r/o}WA.sound.loadSound(t).play({volume:n})}function Kt(e){WA.state[e.name]===void 0&&(WA.state[e.name]=0),WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]&&zt(e)})}function Fe(e,t,o){let n;const r=t.getString("bellPopup");if(o.type==="tilelayer"){const s=o.name;WA.room.onEnterLayer(s).subscribe(()=>{var a;r?n=WA.ui.openPopup(r,"",[{label:(a=t.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.onLeaveLayer(s).subscribe(()=>{n&&(n.close(),n=void 0)})}else{const s=o.name;WA.room.area.onEnter(s).subscribe(()=>{var a;r?n=WA.ui.openPopup(r,"",[{label:(a=t.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.area.onLeave(s).subscribe(()=>{n&&(n.close(),n=void 0)})}}async function Xt(e){e=e??Vt;const t=await Wt();ke=await ae();for(const o of t.values())o.properties.get("door")&&qt(o),o.properties.get("bell")&&Kt(o);for(const o of ke.values()){const n=new Z(o.properties),r=n.getString("doorVariable");if(r&&o.type==="tilelayer"){const a=t.get(r);if(a===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of layer "'+o.name+'"');Ve(o,a,n,e)}const s=n.getString("bellVariable");s&&o.type==="tilelayer"&&Fe(s,n,o)}for(const o of await ft()){const n=new Z(o.properties),r=n.getString("doorVariable");if(r){const a=t.get(r);if(a===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of object "'+o.name+'"');Ve(o,a,n,e)}const s=n.getString("bellVariable");s&&Fe(s,n,o)}WA.player.onPlayerMove(o=>{xe=o.x,Oe=o.y})}function Jt(e,t){const o=e.getString("bindVariable");if(o){const n=e.get("enterValue"),r=e.get("leaveValue"),s=e.getString("triggerMessage"),a=e.getString("tag");$t(o,t,n,r,s,a)}}let ue;function $t(e,t,o,n,r,s){s&&!WA.player.tags.includes(s)||(o!==void 0&&WA.room.onEnterLayer(t).subscribe(()=>{r?ue=WA.ui.displayActionMessage({type:"message",message:r,callback:()=>{WA.state[e]=o}}):WA.state[e]=o}),n!==void 0&&WA.room.onLeaveLayer(t).subscribe(()=>{WA.state[e]=n,ue&&(ue.remove().catch(a=>{console.error(a)}),ue=void 0)}))}async function Zt(){const e=await ae();for(const t of e.values()){const o=new Z(t.properties);Jt(o,t.name)}}let Qe;async function eo(e){const t=await WA.room.getTiledMap();e=e??pt,Qe=await ae();const o=t.layers.find(n=>n.name==="configuration");if(o){const r=new Z(o.properties).getString("tag");(!r||WA.player.tags.includes(r))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(e+"/configuration.html",!0)});for(const s of Qe.values()){const a=new Z(s.properties),i=a.getString("openConfig");i&&s.type==="tilelayer"&&to(i.split(","),s.name,a)}}}function to(e,t,o){let n;const r=o.getString("openConfigAdminTag");let s=!0;r&&!WA.player.tags.includes(r)&&(s=!1);function a(){var c;n&&n.remove(),n=WA.ui.displayActionMessage({message:(c=o.getString("openConfigTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE or touch here to configure",callback:()=>je(e)})}function i(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(t).subscribe(()=>{const c=o.getString("openConfigTrigger");s&&(c&&c==="onaction"?a():je(e))}),WA.room.onLeaveLayer(t).subscribe(()=>{n&&n.remove(),i()})}function oo(){return WA.onInit().then(()=>{Xt().catch(e=>console.error(e)),Zt().catch(e=>console.error(e)),eo().catch(e=>console.error(e)),Ht().catch(e=>console.error(e)),Yt().catch(e=>console.error(e))}).catch(e=>console.error(e))}let j;function no(){WA.room.area.onEnter("clock").subscribe(()=>{const e=new Date,t=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");j&&j.close(),j=WA.ui.openPopup("clockPopup",`It's ${t}:${o}`,[])}),WA.room.area.onLeave("clock").subscribe(()=>{j&&(j.close(),j=void 0)})}let pe;function ro(){const e=()=>{pe&&(pe.close(),pe=void 0)};WA.room.area.onEnter("board").subscribe(()=>{e();const t="The bulletin board hums with strange energy. Five portals shimmer before you—choose your path: 💜 Malware — malicious code that corrupts, spies, and destroys • 🔵 Phishing/Quishing — fake messages or QR Codes that trick you into giving secrets • 🔴 Identity Theft — criminals using your identity • 🟡 xxxxxxxxxxxx • 💚 Password Security — strong, unique passwords and MFA to protect your accounts.";pe=WA.ui.openPopup("boardPopup",t,[])}),WA.room.area.onLeave("board").subscribe(e)}let H;function ge(){var e;if(H){try{(e=H.close)==null||e.call(H)}catch{}H=void 0}}function so(){var e,t;try{const o=(t=(e=WA.room.object)==null?void 0:e.get)==null?void 0:t.call(e,"MarvieZone");if(o&&o.properties){const n=o.properties;if(Array.isArray(n)){const r=n.find(s=>s.name==="marvieMessage"||s.name==="marviePopup");if(r!=null&&r.value)return String(r.value)}else if(n.marvieMessage)return String(n.marvieMessage)}}catch{}return["👋 Hi — I'm Marvie.","","Welcome to the Room of Malware.","Do you think you can find the 3 easter eggs around the map?","Tip: Check the walls, the chairs or the floor for suspicious objects."].join(`
`)}function ao(){console.log("[Marvie] init"),WA.room.area.onEnter("MarvieZone").subscribe(()=>{ge();const e=so();H=WA.ui.openPopup("marviePopup",e,[{label:"Got it",callback:()=>ge()}])}),WA.room.area.onLeave("MarvieZone").subscribe(()=>{ge()})}const io={library:{tasks:[{key:"phishing_SMSphishing",label:"SMS",area:"phishing_SMSphishing"},{key:"phishing_MurdochEmail",label:"MurdochEmail",area:"phishing_MurdochEmail"},{key:"phishing_QRcode",label:"QRcode",area:"phishing_QRcode"},{key:"phishing_instructions",label:"PPT Slides",area:"phishing_instructions"}],exitGate:{area:"to-canteen",nextRoom:"canteen.tmj#from-library",warnAnchorId:"phishing_gate_popup"}}},co={canteen:{tasks:[{key:"malware_instructions",label:"Slides",area:"malware_instructions"},{key:"malware_discord",label:"Discord",area:"malware_discord"},{key:"malware_usbdrive",label:"USB",area:"malware_usbdrive"},{key:"malware_trojan",label:"Trojan",area:"malware_trojan"}],exitGate:{area:"to-classroom",nextRoom:"classroom.tmj#from-canteen",warnAnchorId:"malware_gate_popup"}}},lo={classroom:{tasks:[{key:"passwordsecurity_instructions",label:"Slides",area:"passwordsecurity_instructions"},{key:"passwordsecurity_lmsaccount",label:"LMS Account",area:"passwordsecurity_lmsaccount"},{key:"passwordsecurity_lmspasswordexpired",label:"Password Expired",area:"passwordsecurity_lmspasswordexpired"},{key:"passwordsecurity_unlockedpc",label:"Unlocked PC",area:"passwordsecurity_unlockedpc"}],exitGate:{area:"to-office",nextRoom:"office.tmj#from-classroom",warnAnchorId:"passwordsecurity_gate_popup"}}},uo={...io,...co,...lo},At="cr:goals:",Ge=e=>`${At}${e}`;function po(e,t){try{localStorage.setItem(Ge(e),JSON.stringify(t))}catch{}}function ho(e){try{const t=localStorage.getItem(Ge(e));return t?JSON.parse(t):null}catch{return null}}function fo(e){try{const t=[];for(let o=0;o<localStorage.length;o++){const n=localStorage.key(o);n&&n.startsWith(At)&&!n.endsWith(e)&&t.push(n)}t.forEach(o=>localStorage.removeItem(o))}catch{}}let G={},$=[],qe=0,M,me=0,V=!1,ze="";function yo(){WA.onInit().then(async()=>{const e=await mo()||"";if(!e){console.log("[ProgressChecker] No mapId resolved.");return}if(ze===e)return;ze=e;const t=uo[e];if(be(),fo(e),!t){console.log("[ProgressChecker] No config for map:",e);return}console.log("[ProgressChecker] Init for map:",e),$=t.tasks;const o=ho(e);if(G={...Object.fromEntries($.map(r=>[r.key,!1])),...o??{}},window.addEventListener("beforeunload",()=>be(),{passive:!0}),$.forEach(r=>{try{WA.room.area.onEnter(r.area).subscribe(()=>{V||G[r.key]||(G[r.key]=!0,po(e,G),Xe(),Ke()&&WA.ui.displayActionMessage({message:"✅ All tasks done! You may proceed to the exit.",callback:()=>{}}))})}catch(s){console.warn(`[ProgressChecker] area '${r.area}' not found on this map`,s)}}),t.exitGate){const{area:r,nextRoom:s,warnAnchorId:a}=t.exitGate;WA.room.area.onEnter(r).subscribe(()=>{if(V)return;if(Ke()){V=!0,be();try{WA.controls.disablePlayerControls()}catch{}try{localStorage.removeItem(Ge(e))}catch{}setTimeout(()=>WA.nav.goToRoom(s),40);return}const i=Date.now();if(i-me<500)return;me=i;const c=go();if(a)try{he(),M=WA.ui.openPopup(a,`🚧 Hold up!

You still need to complete:
• ${c.join(`
• `)}

Find all tasks in this room before leaving.`,[{label:"Close",className:"primary",callback:()=>he()}]);return}catch{}WA.ui.displayActionMessage({message:`🚧 Hold up! Missing: ${c.join(", ")}`,callback:()=>{}})}),WA.room.area.onLeave(r).subscribe(()=>{he(),V||(me=0)})}setTimeout(()=>{V||Xe()},300)})}function Ke(){return $.every(e=>G[e.key])}function go(){return $.filter(e=>!G[e.key]).map(e=>e.label)}function Xe(){if(V)return;const e=Date.now();if(e-qe<150)return;qe=e;const t=$.map(o=>G[o.key]?`✅ ${o.label}`:`⬜ ${o.label}`).join("   ");WA.ui.displayActionMessage({message:`Progress:  ${t}`,callback:()=>{}})}function he(){var e;try{(e=M==null?void 0:M.close)==null||e.call(M)}catch{}M=void 0}function be(){he()}async function mo(){var e,t,o;try{const n=decodeURIComponent(location.href).match(/\/([^\/?#]+)\.tmj/i);if(n!=null&&n[1])return n[1].toLowerCase()}catch{}try{const n=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),r=n==null?void 0:n.properties,s=(o=r==null?void 0:r.find(a=>(a==null?void 0:a.name)==="mapId"))==null?void 0:o.value;if(typeof s=="string"&&s.trim())return s.trim().toLowerCase()}catch{}return""}let L;const Je="phishing_QRcode",bo="phishing_QRcodePopup";function Ao(){WA.onInit().then(()=>{WA.room.area.onEnter(Je).subscribe(()=>{Ae(),L=WA.ui.openPopup(bo,"🍗 You spot a poster in the library:“FREE NUGGETS FOR LIFE – Scan Me!” Your friend insists it looks real, but scanning random QR codes can lead to fake websites or data theft. What would you do? Press SPACE to help!",[{label:"Got it",callback:()=>Ae()}])}),WA.room.area.onLeave(Je).subscribe(()=>{Ae()})})}function Ae(){var e;try{L&&((e=L.close)==null||e.call(L),L=void 0)}catch{L=void 0}}let _;const $e="phishing_MurdochEmail",wo="phishing_MurdochEmailPopup";function vo(){WA.onInit().then(()=>{WA.room.area.onEnter($e).subscribe(()=>{we(),_=WA.ui.openPopup(wo,`📧 You received an email: “Your university fees are overdue. Click here to pay immediately.”

⚠️ This looks suspicious... What would you do? Press SPACE to help!`,[{label:"Got it",callback:()=>we()}])}),WA.room.area.onLeave($e).subscribe(()=>{we()})})}function we(){var e;try{_&&((e=_.close)==null||e.call(_),_=void 0)}catch{_=void 0}}let I;const Ze="phishing_SMSphishing",Wo="phishing_SMSphishingPopup";function Po(){WA.onInit().then(()=>{WA.room.area.onEnter(Ze).subscribe(()=>{ve(),I=WA.ui.openPopup(Wo,"🔗 You received a message: “Your Murdoch account needs verification! Click here: https://tinyurl.com/murdoch-reset. Shortened links can hide where they actually lead. Always check the real destination before clicking! What would you do? Press SPACE to help!",[{label:"Got it",callback:()=>ve()}])}),WA.room.area.onLeave(Ze).subscribe(()=>{ve()})})}function ve(){var e;try{I&&((e=I.close)==null||e.call(I),I=void 0)}catch{I=void 0}}let F;function ko(){WA.onInit().then(()=>{console.log("[WA] Phishing sign instructions ready"),WA.room.area.onEnter("phishing_instructions").subscribe(()=>{So()}),WA.room.area.onLeave("phishing_instructions").subscribe(()=>{Se()})})}function So(){Se(),F=WA.ui.openPopup("phishing_instructionsPopup","🧑‍💻 Quick! We saw one of the hackers going through this room! They are using phishing emails and dodgy QR codes to endanger students on campus! Before you chase after him, you should read these slides to learn how you can defend against Phishing.  ",[{label:"Got it!",className:"primary",callback:()=>Se()}])}function Se(){var e;F&&((e=F.close)==null||e.call(F),F=void 0)}let b,A;function We(){var e,t;try{(e=b==null?void 0:b.close)==null||e.call(b)}catch{}b=void 0;try{(t=A==null?void 0:A.unsubscribe)==null||t.call(A)}catch{}A=void 0}function et(){var e,t;try{(e=b==null?void 0:b.close)==null||e.call(b)}catch{}b=WA.ui.openPopup("phishing_librarySpawnPopup","📌 Please proceed and talk to Professor Byte.",[{label:"OK",callback:We}]);try{(t=A==null?void 0:A.unsubscribe)==null||t.call(A)}catch{}A=WA.room.area.onLeave("from-garden").subscribe(We),setTimeout(()=>{We()},5e3)}function Eo(){WA.onInit().then(()=>{WA.room.area.onEnter("from-garden").subscribe(et),setTimeout(()=>{WA.player.getPosition().then(()=>et())},250)})}let T,B,U,tt=!1;const ot="billboard",Co="billboardPopup";function re(){var e;try{(e=T==null?void 0:T.close)==null||e.call(T)}catch{}T=void 0}function Mo(){tt||(tt=!0,WA.onInit().then(()=>{var e,t,o,n,r,s;try{(e=B==null?void 0:B.unsubscribe)==null||e.call(B)}catch{}try{(t=U==null?void 0:U.unsubscribe)==null||t.call(U)}catch{}B=WA.room.area.onEnter(ot).subscribe(()=>{console.log("[billboard] enter"),re(),T=WA.ui.openPopup(Co,`📜 The community billboard

➡️ Move towards the ladder on the right and begin your adventure!`,[{label:"Close",className:"primary",callback:()=>re()}])}),U=WA.room.area.onLeave(ot).subscribe(()=>{console.log("[billboard] leave"),re()}),(s=(n=(o=WA.room).onLeaveLayer)==null?void 0:(r=n.call(o,"**")).subscribe)==null||s.call(r,()=>re()),window.addEventListener("blur",re)}))}let Q;function Lo(){WA.onInit().then(()=>{setTimeout(_o,50)})}function _o(){nt(),Q=WA.ui.openPopup("spawnIntroPopup","👋 Welcome! Use the Arrow Keys or WASD to move. Explore the map and look for Professor Byte for guidance. Tip: Walk close to objects (signs, boards, NPCs) to interact with them.",[{label:"Got it",className:"primary",callback:e=>{var t;try{(t=e.close)==null||t.call(e)}catch{}nt()}}])}function nt(){var e;if(Q){try{(e=Q.close)==null||e.call(Q)}catch{}Q=void 0}}let R,D,Y,rt=!1;const st="instructions",Io="instructionsPopup";function To(){rt||(rt=!0,WA.onInit().then(()=>{var e,t;try{(e=D==null?void 0:D.unsubscribe)==null||e.call(D)}catch{}try{(t=Y==null?void 0:Y.unsubscribe)==null||t.call(Y)}catch{}D=WA.room.area.onEnter(st).subscribe(()=>{Pe(),R=WA.ui.openPopup(Io,"🏫 Thank the heavens you're here! Brave student, Murdoch University is under a Cyber Attack! We need your help to protect the school against evildoers who wish us harm. Please proceed through the school and learn about how you can help us!",[{label:"Close",className:"primary",callback:()=>Pe()}])}),Y=WA.room.area.onLeave(st).subscribe(()=>{Pe()})}))}function Pe(){var e;try{(e=R==null?void 0:R.close)==null||e.call(R)}catch{}R=void 0}const Ro="posterPopup";let w;function No(e){var t;try{(t=w==null?void 0:w.close)==null||t.call(w)}catch{}w=WA.ui.openPopup(Ro,e,[])}function xo(){var e;try{(e=w==null?void 0:w.close)==null||e.call(w)}catch{}w=void 0}function Oo(){WA.room.area.onEnter("poster").subscribe(()=>{No(`🪧 You notice a faded poster: "Think Before You Click! Your Cyber Kingdom Depends On It."

💭 You: (to yourself) 'Think before you click.' That's a good motto.

📢 Narrator: Always pause before clicking unknown links. Your vigilance protects your cyber kingdom!`)}),WA.room.area.onLeave("poster").subscribe(xo)}const Go="usbdrivePopup";let v;function jo(e){var t;try{(t=v==null?void 0:v.close)==null||t.call(v)}catch{}v=WA.ui.openPopup(Go,e,[])}function Bo(){var e;try{(e=v==null?void 0:v.close)==null||e.call(v)}catch{}v=void 0}function Uo(){WA.room.area.onEnter("usbdrive").subscribe(()=>{jo(`💾 You spot a random USB drive on the floor.

💭 You: Should I plug this into a PC and see what's inside?

📢 Narrator: Never plug in unknown USBs. They can hide malware that runs automatically. If you find one in real life, hand it to IT/Security instead of investigating it yourself.`)}),WA.room.area.onLeave("usbdrive").subscribe(Bo)}const Do="stickynotePopup";let W;function Yo(e){var t;try{(t=W==null?void 0:W.close)==null||t.call(W)}catch{}W=WA.ui.openPopup(Do,e,[])}function Ho(){var e;try{(e=W==null?void 0:W.close)==null||e.call(W)}catch{}W=void 0}function Vo(){WA.room.area.onEnter("stickynote").subscribe(()=>{Yo(`📝 A sticky note is stuck to the monitor: “Email PW: P@ssw0rd123”.

💭 You: Wah… someone actually wrote their password here.

📢 Narrator: Don’t write passwords on paper or share them. Use a password manager, create unique passphrases, and always enable MFA (multi-factor authentication).`)}),WA.room.area.onLeave("stickynote").subscribe(Ho)}const Fo="instructions_safeinternetpracticesPopup";let P;function Qo(e){var t;try{(t=P==null?void 0:P.close)==null||t.call(P)}catch{}P=WA.ui.openPopup(Fo,e,[])}function qo(){var e;try{(e=P==null?void 0:P.close)==null||e.call(P)}catch{}P=void 0}function zo(){WA.room.area.onEnter("instructions_safeinternetpractices").subscribe(()=>{Qo(`🛡️ Welcome to the Safe Internet Practices office!

• Explore the room and look for hidden clues (poster, USB drive, sticky note).
• Read your character’s thoughts and the narrator’s tips.
• Learn to: think before you click, protect passwords, and avoid risky devices.

When you’re done, proceed to the exit to continue your mission.`)}),WA.room.area.onLeave("instructions_safeinternetpractices").subscribe(qo)}const d={poster:!1,usbdrive:!1,stickynote:!1,AmeliaZone:!1},Ko="to-hall",Xo="hall.tmj#from-canteen";function Jo(){WA.onInit().then(()=>{console.log("[OfficeProgress] ready"),["poster","usbdrive","stickynote"].forEach(e=>{WA.room.area.onEnter(e).subscribe(()=>{console.log(`[OfficeProgress] ENTER ${e}`),d[e]||(d[e]=!0,it())})}),WA.room.area.onEnter("AmeliaZone").subscribe(()=>{console.log("[OfficeProgress] ENTER AmeliaZone"),d.AmeliaZone||(d.AmeliaZone=!0,it())}),WA.room.area.onEnter(Ko).subscribe(()=>{console.log("[OfficeProgress] ENTER EXIT, allDone =",at()),at()?WA.nav.goToRoom(Xo):WA.ui.openPopup("safeinternet_gate_popup",`🚧 Hold up!

You still need to complete:
• ${$o().join(`
• `)}

Find all 3 clues and talk to Amelia before leaving.`,[{label:"OK",className:"primary",callback:e=>e.close()}])})})}function at(){return d.poster&&d.usbdrive&&d.stickynote&&d.AmeliaZone}function $o(){const e=[];return d.poster||e.push("Old Security Poster"),d.usbdrive||e.push("USB Drive"),d.stickynote||e.push("Sticky Note"),d.AmeliaZone||e.push("Talk to Amelia (NPC)"),e}function it(){const e=[d.poster?"✅ Poster":"⬜ Poster",d.usbdrive?"✅ USB":"⬜ USB",d.stickynote?"✅ Sticky":"⬜ Sticky Note",d.AmeliaZone?"✅ Amelia":"⬜ Amelia"].join("   ");WA.ui.displayActionMessage({message:`Progress: ${e}`,callback:()=>{}})}let q;function Zo(){WA.onInit().then(()=>{console.log("[WA] Malware instructions ready"),WA.room.area.onEnter("malware_instructions").subscribe(()=>{en()}),WA.room.area.onLeave("malware_instructions").subscribe(()=>{Ee()})})}function en(){Ee(),q=WA.ui.openPopup("malware_instructionsPopup","🧑‍💻 Congratulations on clearing the first room! But we have a long way to go before we’re ready to really protect Murdoch... In this room, you’ll learn more about Malware and the best ways to protect against it. To begin, go through the slides by pressing SPACE.",[{label:"Got it!",className:"primary",callback:()=>Ee()}])}function Ee(){var e;if(q){try{(e=q.close)==null||e.call(q)}catch{}q=void 0}}let N;const ct="malware_discord",tn="malware_discordPopup";function on(){WA.onInit().then(()=>{console.log("[WA] Malware Discord popup ready"),WA.room.area.onEnter(ct).subscribe(()=>{nn()}),WA.room.area.onLeave(ct).subscribe(()=>{Ce()})})}function nn(){Ce(),N=WA.ui.openPopup(tn,`💬 Friend sent a file

Your friend DMs you on Discord about a program that “unlocks Discord Nitro Premium for life” and says it’s safe because they used it.

What would you do? Press SPACE to help!`,[{label:"Got it!",className:"primary",callback:()=>Ce()}])}function Ce(){var e;try{(e=N==null?void 0:N.close)==null||e.call(N)}catch{}N=void 0}let x;const lt="malware_usbdrive",rn="malware_usbdrivePopup";function sn(){WA.onInit().then(()=>{console.log("[WA] Malware USB Drive popup ready"),WA.room.area.onEnter(lt).subscribe(()=>{an()}),WA.room.area.onLeave(lt).subscribe(()=>{Me()})})}function an(){Me(),x=WA.ui.openPopup(rn,`💾 Found USB

You spot a USB drive on the canteen floor. It looks unopened and you’re curious about what’s inside.

What would you do? Press SPACE to help!`,[{label:"Got it!",className:"primary",callback:()=>Me()}])}function Me(){var e;try{(e=x==null?void 0:x.close)==null||e.call(x)}catch{}x=void 0}let O;const ut="malware_trojan",cn="malware_trojanPopup";function ln(){WA.onInit().then(()=>{console.log("[WA] Malware Trojan popup ready"),WA.room.area.onEnter(ut).subscribe(()=>{un()}),WA.room.area.onLeave(ut).subscribe(()=>{Le()})})}function un(){Le(),O=WA.ui.openPopup(cn,`🛡️ Malware Detection

A system alert appears: “Windows Defender Virus Protection found an unwanted app (type: Trojan).”

What would you do? Press SPACE to help!`,[{label:"Got it!",className:"primary",callback:()=>Le()}])}function Le(){var e;try{(e=O==null?void 0:O.close)==null||e.call(O)}catch{}O=void 0}let z;function pn(){WA.onInit().then(()=>{console.log("[WA] Password Security instructions ready"),WA.room.area.onEnter("passwordsecurity_instructions").subscribe(()=>{hn()}),WA.room.area.onLeave("passwordsecurity_instructions").subscribe(()=>{_e()})})}function hn(){_e(),z=WA.ui.openPopup("passwordsecurity_instructionsPopup","🧑‍🏫 Thank goodness you’re here! The hackers are after our passwords, and we need your help to secure them! ➡️ To begin, go through the slides to learn more about Passsword Security by pressing SPACE. Afterwards, help us defend the school!",[{label:"Got it!",className:"primary",callback:()=>_e()}])}function _e(){var e;if(z){try{(e=z.close)==null||e.call(z)}catch{}z=void 0}}let K;function dn(){WA.onInit().then(()=>{console.log("[WA] Password Security - LMS Account scenario ready"),WA.room.area.onEnter("passwordsecurity_lmsaccount").subscribe(()=>{fn()}),WA.room.area.onLeave("passwordsecurity_lmsaccount").subscribe(()=>{Ie()})})}function fn(){Ie(),K=WA.ui.openPopup("passwordsecurity_lmsaccountPopup","👩‍💻 Your classmate Joyce says she forgot her LMS login and asks to borrow your account to check the quiz questions. What would you do? Press SPACE to help!",[{label:"Let's decide!",className:"primary",callback:()=>Ie()}])}function Ie(){var e;if(K){try{(e=K.close)==null||e.call(K)}catch{}K=void 0}}let X;function yn(){WA.onInit().then(()=>{console.log("[WA] Password Security - LMS Password Expired scenario ready"),WA.room.area.onEnter("passwordsecurity_lmspasswordexpired").subscribe(()=>{gn()}),WA.room.area.onLeave("passwordsecurity_lmspasswordexpired").subscribe(()=>{Te()})})}function gn(){Te(),X=WA.ui.openPopup("passwordsecurity_lmspasswordexpiredPopup","🔑 Your LMS password has just expired! The system is asking you to create a new one. How will you choose your new password? Press SPACE to help!",[{label:"Let's find out!",className:"primary",callback:()=>Te()}])}function Te(){var e;if(X){try{(e=X.close)==null||e.call(X)}catch{}X=void 0}}let J;function mn(){WA.onInit().then(()=>{console.log("[WA] Password Security - Unlocked PC scenario ready"),WA.room.area.onEnter("passwordsecurity_unlockedpc").subscribe(()=>{bn()}),WA.room.area.onLeave("passwordsecurity_unlockedpc").subscribe(()=>{Re()})})}function bn(){Re(),J=WA.ui.openPopup("passwordsecurity_unlockedpcPopup","💻 You notice an unlocked PC with a teacher’s account signed in — an Excel sheet is open showing login details! What should you do? Press SPACE to help!",[{label:"I'll check!",className:"primary",callback:()=>Re()}])}function Re(){var e;if(J){try{(e=J.close)==null||e.call(J)}catch{}J=void 0}}console.log("Script started");WA.onInit().then(async()=>{console.log("Scripting API ready"),await oo(),no(),ro(),ao(),yo();const e=await An();console.log("[Router] mapId =",e||"(unknown)"),e==="garden"?(console.log("[Router] Initializing GARDEN features…"),Mo(),Lo(),To(),Oo(),Uo(),Vo(),zo(),Jo()):e==="library"?(console.log("[Router] Initializing LIBRARY (Phishing) features…"),Ao(),vo(),Po(),ko(),Eo()):e==="canteen"?(console.log("[Router] Initializing CANTEEN (Malware) features…"),Zo(),on(),sn(),ln()):e==="classroom"?(console.log("[Router] Initializing CLASSROOM (Password Security) features…"),pn(),dn(),yn(),mn()):console.warn("[Router] Unknown map; only common features started. Set a Tiled Map Property `mapId` (string) to enable map-specific inits.")});async function An(){var e,t,o;try{const r=decodeURIComponent(window.location.href).match(/\/([^\/?#]+)\.tmj/i);if(r!=null&&r[1])return r[1].toLowerCase()}catch{}try{const n=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),r=((n==null?void 0:n.url)??(n==null?void 0:n.name)??"").toString();if(r){const i=(r.split("/").pop()||r).toLowerCase();return i.endsWith(".tmj")?i.replace(/\.tmj$/,""):i}const s=n==null?void 0:n.properties,a=(o=s==null?void 0:s.find(i=>(i==null?void 0:i.name)==="mapId"))==null?void 0:o.value;if(typeof a=="string"&&a.trim())return a.trim().toLowerCase()}catch{}return""}
//# sourceMappingURL=main-2099b635.js.map
