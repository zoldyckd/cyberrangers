class F{constructor(t){this.properties=t??[]}get(t){const n=this.properties.filter(o=>o.name===t).map(o=>o.value);if(n.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(n.length!==0)return n[0]}getString(t){return this.getByType(t,"string")}getNumber(t){return this.getByType(t,"number")}getBoolean(t){return this.getByType(t,"boolean")}getByType(t,n){const o=this.get(t);if(o!==void 0){if(n!=="json"&&typeof o!==n)throw new Error('Expected property "'+t+'" to have type "'+n+'"');return o}}mustGetString(t){return this.mustGetByType(t,"string")}mustGetNumber(t){return this.mustGetByType(t,"number")}mustGetBoolean(t){return this.mustGetByType(t,"boolean")}mustGetByType(t,n){const o=this.get(t);if(o===void 0)throw new Error('Property "'+t+'" is missing');if(n!=="json"&&typeof o!==n)throw new Error('Expected property "'+t+'" to have type "'+n+'"');return o}getType(t){const n=this.properties.filter(o=>o.name===t).map(o=>o.type);if(n.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(n.length!==0)return n[0]}}const Je="https://unpkg.com/@workadventure/scripting-api-extra@1.9.10/dist";class st{constructor(t){this.name=t.name,this.x=t.x,this.y=t.y,this.properties=new F(t.properties)}get isReadable(){const t=this.properties.getString("readableBy");return t?WA.player.tags.includes(t):!0}get isWritable(){const t=this.properties.getString("writableBy");return t?WA.player.tags.includes(t):!0}}function Ee(e){const t=e?"#"+e.join():"";WA.nav.openCoWebSite(Je+"/configuration.html"+t,!0)}async function at(e,t){const n=await WA.room.getTiledMap(),o=new Map;return Ze(n.layers,o,e,t),o}function Ze(e,t,n,o){for(const r of e)if(r.type==="objectgroup"){for(const i of r.objects)if(i.type==="variable"||i.class==="variable"){if(n&&r.name!==n||o&&!o.includes(i.name))continue;t.set(i.name,new st(i))}}else r.type==="group"&&Ze(r.layers,t,n,o)}let le;async function $(){return le===void 0&&(le=ct()),le}async function ct(){return lt(await WA.room.getTiledMap())}function lt(e){const t=new Map;return $e(e.layers,"",t),t}function $e(e,t,n){for(const o of e)o.type==="group"?$e(o.layers,t+o.name+"/",n):(o.name=t+o.name,n.set(o.name,o))}async function et(){const e=await $(),t=[];for(const n of e.values())if(n.type==="objectgroup")for(const o of n.objects)(o.type==="area"||o.class==="area")&&t.push(o);return t}function ut(e){let t=1/0,n=1/0,o=0,r=0;const i=e.data;if(typeof i=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let s=0;s<e.height;s++)for(let a=0;a<e.width;a++)i[a+s*e.width]!==0&&(t=Math.min(t,a),r=Math.max(r,a),n=Math.min(n,s),o=Math.max(o,s));return{top:n,left:t,right:r+1,bottom:o+1}}function tt(e){let t=1/0,n=1/0,o=0,r=0;for(const i of e){const s=ut(i);s.left<t&&(t=s.left),s.top<n&&(n=s.top),s.right>r&&(r=s.right),s.bottom>o&&(o=s.bottom)}return{top:n,left:t,right:r,bottom:o}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var pt=Object.prototype.toString,q=Array.isArray||function(t){return pt.call(t)==="[object Array]"};function We(e){return typeof e=="function"}function ft(e){return q(e)?"array":typeof e}function ue(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Ce(e,t){return e!=null&&typeof e=="object"&&t in e}function ht(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var dt=RegExp.prototype.test;function gt(e,t){return dt.call(e,t)}var yt=/\S/;function mt(e){return!gt(yt,e)}var bt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function At(e){return String(e).replace(/[&<>"'`=\/]/g,function(n){return bt[n]})}var vt=/\s*/,wt=/\s+/,Me=/\s*=/,Wt=/\s*\}/,Pt=/#|\^|\/|>|\{|&|=|!/;function kt(e,t){if(!e)return[];var n=!1,o=[],r=[],i=[],s=!1,a=!1,c="",u=0;function f(){if(s&&!a)for(;i.length;)delete r[i.pop()];else i=[];s=!1,a=!1}var y,k,te;function z(E){if(typeof E=="string"&&(E=E.split(wt,2)),!q(E)||E.length!==2)throw new Error("Invalid tags: "+E);y=new RegExp(ue(E[0])+"\\s*"),k=new RegExp("\\s*"+ue(E[1])),te=new RegExp("\\s*"+ue("}"+E[1]))}z(t||g.tags);for(var p=new ee(e),S,l,m,X,ne,C;!p.eos();){if(S=p.pos,m=p.scanUntil(y),m)for(var ce=0,it=m.length;ce<it;++ce)X=m.charAt(ce),mt(X)?(i.push(r.length),c+=X):(a=!0,n=!0,c+=" "),r.push(["text",X,S,S+1]),S+=1,X===`
`&&(f(),c="",u=0,n=!1);if(!p.scan(y))break;if(s=!0,l=p.scan(Pt)||"name",p.scan(vt),l==="="?(m=p.scanUntil(Me),p.scan(Me),p.scanUntil(k)):l==="{"?(m=p.scanUntil(te),p.scan(Wt),p.scanUntil(k),l="&"):m=p.scanUntil(k),!p.scan(k))throw new Error("Unclosed tag at "+p.pos);if(l==">"?ne=[l,m,S,p.pos,c,u,n]:ne=[l,m,S,p.pos],u++,r.push(ne),l==="#"||l==="^")o.push(ne);else if(l==="/"){if(C=o.pop(),!C)throw new Error('Unopened section "'+m+'" at '+S);if(C[1]!==m)throw new Error('Unclosed section "'+C[1]+'" at '+S)}else l==="name"||l==="{"||l==="&"?a=!0:l==="="&&z(m)}if(f(),C=o.pop(),C)throw new Error('Unclosed section "'+C[1]+'" at '+p.pos);return Et(St(r))}function St(e){for(var t=[],n,o,r=0,i=e.length;r<i;++r)n=e[r],n&&(n[0]==="text"&&o&&o[0]==="text"?(o[1]+=n[1],o[3]=n[3]):(t.push(n),o=n));return t}function Et(e){for(var t=[],n=t,o=[],r,i,s=0,a=e.length;s<a;++s)switch(r=e[s],r[0]){case"#":case"^":n.push(r),o.push(r),n=r[4]=[];break;case"/":i=o.pop(),i[5]=r[2],n=o.length>0?o[o.length-1][4]:t;break;default:n.push(r)}return t}function ee(e){this.string=e,this.tail=e,this.pos=0}ee.prototype.eos=function(){return this.tail===""};ee.prototype.scan=function(t){var n=this.tail.match(t);if(!n||n.index!==0)return"";var o=n[0];return this.tail=this.tail.substring(o.length),this.pos+=o.length,o};ee.prototype.scanUntil=function(t){var n=this.tail.search(t),o;switch(n){case-1:o=this.tail,this.tail="";break;case 0:o="";break;default:o=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=o.length,o};function K(e,t){this.view=e,this.cache={".":this.view},this.parent=t}K.prototype.push=function(t){return new K(t,this)};K.prototype.lookup=function(t){var n=this.cache,o;if(n.hasOwnProperty(t))o=n[t];else{for(var r=this,i,s,a,c=!1;r;){if(t.indexOf(".")>0)for(i=r.view,s=t.split("."),a=0;i!=null&&a<s.length;)a===s.length-1&&(c=Ce(i,s[a])||ht(i,s[a])),i=i[s[a++]];else i=r.view[t],c=Ce(r.view,t);if(c){o=i;break}r=r.parent}n[t]=o}return We(o)&&(o=o.call(this.view)),o};function d(){this.templateCache={_cache:{},set:function(t,n){this._cache[t]=n},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}d.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};d.prototype.parse=function(t,n){var o=this.templateCache,r=t+":"+(n||g.tags).join(":"),i=typeof o<"u",s=i?o.get(r):void 0;return s==null&&(s=kt(t,n),i&&o.set(r,s)),s};d.prototype.render=function(t,n,o,r){var i=this.getConfigTags(r),s=this.parse(t,i),a=n instanceof K?n:new K(n,void 0);return this.renderTokens(s,a,o,t,r)};d.prototype.renderTokens=function(t,n,o,r,i){for(var s="",a,c,u,f=0,y=t.length;f<y;++f)u=void 0,a=t[f],c=a[0],c==="#"?u=this.renderSection(a,n,o,r,i):c==="^"?u=this.renderInverted(a,n,o,r,i):c===">"?u=this.renderPartial(a,n,o,i):c==="&"?u=this.unescapedValue(a,n):c==="name"?u=this.escapedValue(a,n,i):c==="text"&&(u=this.rawValue(a)),u!==void 0&&(s+=u);return s};d.prototype.renderSection=function(t,n,o,r,i){var s=this,a="",c=n.lookup(t[1]);function u(k){return s.render(k,n,o,i)}if(c){if(q(c))for(var f=0,y=c.length;f<y;++f)a+=this.renderTokens(t[4],n.push(c[f]),o,r,i);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")a+=this.renderTokens(t[4],n.push(c),o,r,i);else if(We(c)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(n.view,r.slice(t[3],t[5]),u),c!=null&&(a+=c)}else a+=this.renderTokens(t[4],n,o,r,i);return a}};d.prototype.renderInverted=function(t,n,o,r,i){var s=n.lookup(t[1]);if(!s||q(s)&&s.length===0)return this.renderTokens(t[4],n,o,r,i)};d.prototype.indentPartial=function(t,n,o){for(var r=n.replace(/[^ \t]/g,""),i=t.split(`
`),s=0;s<i.length;s++)i[s].length&&(s>0||!o)&&(i[s]=r+i[s]);return i.join(`
`)};d.prototype.renderPartial=function(t,n,o,r){if(o){var i=this.getConfigTags(r),s=We(o)?o(t[1]):o[t[1]];if(s!=null){var a=t[6],c=t[5],u=t[4],f=s;c==0&&u&&(f=this.indentPartial(s,u,a));var y=this.parse(f,i);return this.renderTokens(y,n,o,f,r)}}};d.prototype.unescapedValue=function(t,n){var o=n.lookup(t[1]);if(o!=null)return o};d.prototype.escapedValue=function(t,n,o){var r=this.getConfigEscape(o)||g.escape,i=n.lookup(t[1]);if(i!=null)return typeof i=="number"&&r===g.escape?String(i):r(i)};d.prototype.rawValue=function(t){return t[1]};d.prototype.getConfigTags=function(t){return q(t)?t:t&&typeof t=="object"?t.tags:void 0};d.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!q(t))return t.escape};var g={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){Z.templateCache=e},get templateCache(){return Z.templateCache}},Z=new d;g.clearCache=function(){return Z.clearCache()};g.parse=function(t,n){return Z.parse(t,n)};g.render=function(t,n,o,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+ft(t)+'" was given as the first argument for mustache#render(template, view, partials)');return Z.render(t,n,o,r)};g.escape=At;g.Scanner=ee;g.Context=K;g.Writer=d;class nt{constructor(t,n){this.template=t,this.state=n,this.ast=g.parse(t)}getValue(){return this.value===void 0&&(this.value=g.render(this.template,this.state)),this.value}onChange(t){const n=[];for(const o of this.getUsedVariables().values())n.push(this.state.onVariableChange(o).subscribe(()=>{const r=g.render(this.template,this.state);r!==this.value&&(this.value=r,t(this.value))}));return{unsubscribe:()=>{for(const o of n)o.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const t=new Set;return this.recursiveGetUsedVariables(this.ast,t),t}recursiveGetUsedVariables(t,n){for(const o of t){const r=o[0],i=o[1],s=o[4];["name","&","#","^"].includes(r)&&n.add(i),s!==void 0&&typeof s!="string"&&this.recursiveGetUsedVariables(s,n)}}}async function Ct(){var e;const t=await et();for(const n of t){const o=(e=n.properties)!==null&&e!==void 0?e:[];for(const r of o){if(r.type==="int"||r.type==="bool"||r.type==="object"||typeof r.value!="string")continue;const i=new nt(r.value,WA.state);if(i.isPureString())continue;const s=i.getValue();await Le(n.name,r.name,s),i.onChange(async a=>{await Le(n.name,r.name,a)})}}}async function Mt(){var e;const t=await $();for(const[n,o]of t.entries())if(o.type!=="objectgroup"){const r=(e=o.properties)!==null&&e!==void 0?e:[];for(const i of r){if(i.type==="int"||i.type==="bool"||i.type==="object"||typeof i.value!="string")continue;const s=new nt(i.value,WA.state);if(s.isPureString())continue;const a=s.getValue();Te(n,i.name,a),s.onChange(c=>{Te(n,i.name,c)})}}}async function Le(e,t,n){console.log(e),(await WA.room.area.get(e)).setProperty(t,n)}function Te(e,t,n){WA.room.setProperty(e,t,n),t==="visible"&&(n?WA.room.showLayer(e):WA.room.hideLayer(e))}const Lt="https://admin.workadventu.re/html";let be,Pe=0,ke=0;function Ie(e){if(WA.state[e.name]){let t=e.properties.mustGetString("openLayer");for(const n of t.split(`
`))WA.room.showLayer(n);t=e.properties.mustGetString("closeLayer");for(const n of t.split(`
`))WA.room.hideLayer(n)}else{let t=e.properties.mustGetString("openLayer");for(const n of t.split(`
`))WA.room.hideLayer(n);t=e.properties.mustGetString("closeLayer");for(const n of t.split(`
`))WA.room.showLayer(n)}}function Tt(e){const t=e.properties.getString("openSound"),n=e.properties.getNumber("soundRadius");let o=1;if(n){const r=rt(e.properties.mustGetString("openLayer").split(`
`));if(r>n)return;o=1-r/n}t&&WA.sound.loadSound(t).play({volume:o})}function It(e){const t=e.properties.getString("closeSound"),n=e.properties.getNumber("soundRadius");let o=1;if(n){const r=rt(e.properties.mustGetString("closeLayer").split(`
`));if(r>n)return;o=1-r/n}t&&WA.sound.loadSound(t).play({volume:o})}function ot(e){return e.map(t=>be.get(t)).filter(t=>(t==null?void 0:t.type)==="tilelayer")}function rt(e){const t=ot(e),n=tt(t),o=((n.right-n.left)/2+n.left)*32,r=((n.bottom-n.top)/2+n.top)*32;return Math.sqrt(Math.pow(Pe-o,2)+Math.pow(ke-r,2))}function Rt(e){WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]?Tt(e):It(e),Ie(e)}),Ie(e)}function Re(e,t,n,o){const r=e.name;let i,s,a=!1;const c=n.getString("tag");let u=!0;c&&!WA.player.tags.includes(c)&&(u=!1);const f=!!c;function y(){var l;i&&i.remove(),i=WA.ui.displayActionMessage({message:(l=n.getString("closeTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to close the door",callback:()=>{WA.state[t.name]=!1,k()}})}function k(){var l;i&&i.remove(),i=WA.ui.displayActionMessage({message:(l=n.getString("openTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to open the door",callback:()=>{WA.state[t.name]=!0,y()}})}function te(){let l;if(e.type==="tilelayer")l=tt(ot(t.properties.mustGetString("closeLayer").split(`
`)));else{if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)throw new Error(`Doorstep zone "${e.name}" is missing x, y, width or height`);l={top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}s=WA.room.website.create({name:"doorKeypad"+r,url:o+"/keypad.html#"+encodeURIComponent(r),position:{x:l.right*32,y:l.top*32,width:32*3,height:32*4},allowApi:!0})}function z(){s&&(WA.room.website.delete(s.name),s=void 0)}function p(){if(a=!0,n.getBoolean("autoOpen")&&u){WA.state[t.name]=!0;return}if(!WA.state[t.name]&&(f&&!u||!f)&&(n.getString("code")||n.getString("codeVariable"))){te();return}u&&(WA.state[t.name]?y():k())}function S(){a=!1,n.getBoolean("autoClose")&&(WA.state[t.name]=!1),i&&i.remove(),z()}e.type==="tilelayer"?(WA.room.onEnterLayer(r).subscribe(p),WA.room.onLeaveLayer(r).subscribe(S)):(WA.room.area.onEnter(r).subscribe(p),WA.room.area.onLeave(r).subscribe(S)),WA.state.onVariableChange(t.name).subscribe(()=>{a&&(!n.getBoolean("autoClose")&&WA.state[t.name]===!0&&y(),s&&WA.state[t.name]===!0&&z(),!n.getBoolean("autoOpen")&&WA.state[t.name]===!1&&k())})}function _t(e){const t=e.properties.mustGetString("bellSound"),n=e.properties.getNumber("soundRadius");let o=1;if(n){const r=Math.sqrt(Math.pow(e.x-Pe,2)+Math.pow(e.y-ke,2));if(r>n)return;o=1-r/n}WA.sound.loadSound(t).play({volume:o})}function Bt(e){WA.state[e.name]===void 0&&(WA.state[e.name]=0),WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]&&_t(e)})}function _e(e,t,n){let o;const r=t.getString("bellPopup");if(n.type==="tilelayer"){const i=n.name;WA.room.onEnterLayer(i).subscribe(()=>{var s;r?o=WA.ui.openPopup(r,"",[{label:(s=t.getString("bellButtonText"))!==null&&s!==void 0?s:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.onLeaveLayer(i).subscribe(()=>{o&&(o.close(),o=void 0)})}else{const i=n.name;WA.room.area.onEnter(i).subscribe(()=>{var s;r?o=WA.ui.openPopup(r,"",[{label:(s=t.getString("bellButtonText"))!==null&&s!==void 0?s:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.area.onLeave(i).subscribe(()=>{o&&(o.close(),o=void 0)})}}async function Nt(e){e=e??Lt;const t=await at();be=await $();for(const n of t.values())n.properties.get("door")&&Rt(n),n.properties.get("bell")&&Bt(n);for(const n of be.values()){const o=new F(n.properties),r=o.getString("doorVariable");if(r&&n.type==="tilelayer"){const s=t.get(r);if(s===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of layer "'+n.name+'"');Re(n,s,o,e)}const i=o.getString("bellVariable");i&&n.type==="tilelayer"&&_e(i,o,n)}for(const n of await et()){const o=new F(n.properties),r=o.getString("doorVariable");if(r){const s=t.get(r);if(s===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of object "'+n.name+'"');Re(n,s,o,e)}const i=o.getString("bellVariable");i&&_e(i,o,n)}WA.player.onPlayerMove(n=>{Pe=n.x,ke=n.y})}function xt(e,t){const n=e.getString("bindVariable");if(n){const o=e.get("enterValue"),r=e.get("leaveValue"),i=e.getString("triggerMessage"),s=e.getString("tag");Ot(n,t,o,r,i,s)}}let oe;function Ot(e,t,n,o,r,i){i&&!WA.player.tags.includes(i)||(n!==void 0&&WA.room.onEnterLayer(t).subscribe(()=>{r?oe=WA.ui.displayActionMessage({type:"message",message:r,callback:()=>{WA.state[e]=n}}):WA.state[e]=n}),o!==void 0&&WA.room.onLeaveLayer(t).subscribe(()=>{WA.state[e]=o,oe&&(oe.remove().catch(s=>{console.error(s)}),oe=void 0)}))}async function Gt(){const e=await $();for(const t of e.values()){const n=new F(t.properties);xt(n,t.name)}}let Be;async function jt(e){const t=await WA.room.getTiledMap();e=e??Je,Be=await $();const n=t.layers.find(o=>o.name==="configuration");if(n){const r=new F(n.properties).getString("tag");(!r||WA.player.tags.includes(r))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(e+"/configuration.html",!0)});for(const i of Be.values()){const s=new F(i.properties),a=s.getString("openConfig");a&&i.type==="tilelayer"&&Ut(a.split(","),i.name,s)}}}function Ut(e,t,n){let o;const r=n.getString("openConfigAdminTag");let i=!0;r&&!WA.player.tags.includes(r)&&(i=!1);function s(){var c;o&&o.remove(),o=WA.ui.displayActionMessage({message:(c=n.getString("openConfigTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE or touch here to configure",callback:()=>Ee(e)})}function a(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(t).subscribe(()=>{const c=n.getString("openConfigTrigger");i&&(c&&c==="onaction"?s():Ee(e))}),WA.room.onLeaveLayer(t).subscribe(()=>{o&&o.remove(),a()})}function Dt(){return WA.onInit().then(()=>{Nt().catch(e=>console.error(e)),Gt().catch(e=>console.error(e)),jt().catch(e=>console.error(e)),Mt().catch(e=>console.error(e)),Ct().catch(e=>console.error(e))}).catch(e=>console.error(e))}let N;function Vt(){WA.room.area.onEnter("clock").subscribe(()=>{const e=new Date,t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");N&&N.close(),N=WA.ui.openPopup("clockPopup",`It's ${t}:${n}`,[])}),WA.room.area.onLeave("clock").subscribe(()=>{N&&(N.close(),N=void 0)})}let re;function Yt(){const e=()=>{re&&(re.close(),re=void 0)};WA.room.area.onEnter("board").subscribe(()=>{e();const t="The bulletin board hums with strange energy. Five portals shimmer before youâ€”choose your path: ðŸ’œ Malware â€” malicious code that corrupts, spies, and destroys â€¢ ðŸ”µ Phishing/Quishing â€” fake messages or QR Codes that trick you into giving secrets â€¢ ðŸ”´ Identity Theft â€” criminals using your identity â€¢ ðŸŸ¡ xxxxxxxxxxxx â€¢ ðŸ’š Password Security â€” strong, unique passwords and MFA to protect your accounts.";re=WA.ui.openPopup("boardPopup",t,[])}),WA.room.area.onLeave("board").subscribe(e)}let U;function pe(){var e;if(U){try{(e=U.close)==null||e.call(U)}catch{}U=void 0}}function Ht(){var e,t;try{const n=(t=(e=WA.room.object)==null?void 0:e.get)==null?void 0:t.call(e,"MarvieZone");if(n&&n.properties){const o=n.properties;if(Array.isArray(o)){const r=o.find(i=>i.name==="marvieMessage"||i.name==="marviePopup");if(r!=null&&r.value)return String(r.value)}else if(o.marvieMessage)return String(o.marvieMessage)}}catch{}return["ðŸ‘‹ Hi â€” I'm Marvie.","","Welcome to the Room of Malware.","Do you think you can find the 3 easter eggs around the map?","Tip: Check the walls, the chairs or the floor for suspicious objects."].join(`
`)}function Qt(){console.log("[Marvie] init"),WA.room.area.onEnter("MarvieZone").subscribe(()=>{pe();const e=Ht();U=WA.ui.openPopup("marviePopup",e,[{label:"Got it",callback:()=>pe()}])}),WA.room.area.onLeave("MarvieZone").subscribe(()=>{pe()})}const Ft={library:{tasks:[{key:"phishing_SMSphishing",label:"SMS",area:"phishing_SMSphishing"},{key:"phishing_MurdochEmail",label:"MurdochEmail",area:"phishing_MurdochEmail"},{key:"phishing_QRcode",label:"QRcode",area:"phishing_QRcode"},{key:"phishing_Brock",label:"Brock",area:"phishing_Brock"}],exitGate:{area:"to-canteen",nextRoom:"canteen.tmj#from-library",warnAnchorId:"phishing_gate_popup"}},canteen:{tasks:[{key:"malware_instructions",label:"Slides",area:"malware_instructions"}]}},Ae="cr:goals:";function Se(e){return`${Ae}${e}`}function Kt(e,t){try{localStorage.setItem(Se(e),JSON.stringify(t))}catch{}}function qt(e){try{const t=localStorage.getItem(Se(e));return t?JSON.parse(t):null}catch{return null}}function Ne(e){try{for(let n=0;n<localStorage.length;n++){const o=localStorage.key(n);o&&o.startsWith(Ae)&&o.endsWith(e)}const t=[];for(let n=0;n<localStorage.length;n++){const o=localStorage.key(n);o&&o.startsWith(Ae)&&!o.endsWith(e)&&t.push(o)}t.forEach(n=>localStorage.removeItem(n))}catch{}}let B={},Q=[],xe=0,M,fe=0,D=!1,Oe="";function zt(){WA.onInit().then(async()=>{const e=await Jt()||"";if(!e){console.log("[ProgressChecker] No mapId resolved.");return}if(Oe===e)return;Oe=e;const t=Ft[e];if(!t){console.log("[ProgressChecker] No config for map:",e),ie(),Ne(e);return}ie(),Ne(e),console.log("[ProgressChecker] Init for map:",e),Q=t.tasks;const n=qt(e);if(B={...Object.fromEntries(Q.map(r=>[r.key,!1])),...n??{}},window.addEventListener("beforeunload",()=>ie(),{passive:!0}),Q.forEach(r=>{try{WA.room.area.onEnter(r.area).subscribe(()=>{D||B[r.key]||(B[r.key]=!0,Kt(e,B),je(),Ge()&&WA.ui.displayActionMessage({message:"âœ… All tasks done! You may proceed to the exit.",callback:()=>{}}))})}catch(i){console.warn(`[ProgressChecker] area '${r.area}' not found on this map`,i)}}),t.exitGate){const{area:r,nextRoom:i,warnAnchorId:s}=t.exitGate;WA.room.area.onEnter(r).subscribe(()=>{if(D)return;if(Ge()){D=!0,ie();try{WA.controls.disablePlayerControls()}catch{}try{localStorage.removeItem(Se(e))}catch{}setTimeout(()=>WA.nav.goToRoom(i),40);return}const a=Date.now();if(a-fe<500)return;fe=a;const c=Xt();if(s)try{ae(),M=WA.ui.openPopup(s,`ðŸš§ Hold up!

You still need to complete:
â€¢ ${c.join(`
â€¢ `)}

Find all tasks in this room before leaving.`,[{label:"Close",className:"primary",callback:()=>ae()}]);return}catch{}WA.ui.displayActionMessage({message:`ðŸš§ Hold up! Missing: ${c.join(", ")}`,callback:()=>{}})}),WA.room.area.onLeave(r).subscribe(()=>{ae(),D||(fe=0)})}setTimeout(()=>{D||je()},300)})}function Ge(){return Q.every(e=>B[e.key])}function Xt(){return Q.filter(e=>!B[e.key]).map(e=>e.label)}function je(){if(D)return;const e=Date.now();if(e-xe<150)return;xe=e;const t=Q.map(n=>B[n.key]?`âœ… ${n.label}`:`â¬œ ${n.label}`).join("   ");WA.ui.displayActionMessage({message:`Progress:  ${t}`,callback:()=>{}})}function ae(){var e;try{(e=M==null?void 0:M.close)==null||e.call(M)}catch{}M=void 0}function ie(){ae()}async function Jt(){var e,t,n;try{const o=decodeURIComponent(location.href).match(/\/([^\/?#]+)\.tmj/i);if(o!=null&&o[1])return o[1].toLowerCase()}catch{}try{const o=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),r=o==null?void 0:o.properties,i=(n=r==null?void 0:r.find(s=>(s==null?void 0:s.name)==="mapId"))==null?void 0:n.value;if(typeof i=="string"&&i.trim())return i.trim().toLowerCase()}catch{}return""}let L;const Ue="phishing_QRcode",Zt="phishing_QRcodePopup";function $t(){WA.onInit().then(()=>{WA.room.area.onEnter(Ue).subscribe(()=>{he(),L=WA.ui.openPopup(Zt,"ðŸ— You spot a poster in the library:â€œFREE NUGGETS FOR LIFE â€“ Scan Me!â€ Your friend insists it looks real, but scanning random QR codes can lead to fake websites or data theft. What would you do? Press SPACE to help!",[{label:"Got it",callback:()=>he()}])}),WA.room.area.onLeave(Ue).subscribe(()=>{he()})})}function he(){var e;try{L&&((e=L.close)==null||e.call(L),L=void 0)}catch{L=void 0}}let T;const De="phishing_MurdochEmail",en="phishing_MurdochEmailPopup";function tn(){WA.onInit().then(()=>{WA.room.area.onEnter(De).subscribe(()=>{de(),T=WA.ui.openPopup(en,`ðŸ“§ You received an email: â€œYour university fees are overdue. Click here to pay immediately.â€

âš ï¸ This looks suspicious... What would you do? Press SPACE to help!`,[{label:"Got it",callback:()=>de()}])}),WA.room.area.onLeave(De).subscribe(()=>{de()})})}function de(){var e;try{T&&((e=T.close)==null||e.call(T),T=void 0)}catch{T=void 0}}let I;const Ve="phishing_SMSphishing",nn="phishing_SMSphishingPopup";function on(){WA.onInit().then(()=>{WA.room.area.onEnter(Ve).subscribe(()=>{ge(),I=WA.ui.openPopup(nn,"ðŸ”— You received a message: â€œYour Murdoch account needs verification! Click here: https://tinyurl.com/murdoch-reset. Shortened links can hide where they actually lead. Always check the real destination before clicking! What would you do? Press SPACE to help!",[{label:"Got it",callback:()=>ge()}])}),WA.room.area.onLeave(Ve).subscribe(()=>{ge()})})}function ge(){var e;try{I&&((e=I.close)==null||e.call(I),I=void 0)}catch{I=void 0}}let V;function rn(){WA.onInit().then(()=>{console.log("[WA] Phishing sign instructions ready"),WA.room.area.onEnter("phishing_instructions").subscribe(()=>{sn()}),WA.room.area.onLeave("phishing_instructions").subscribe(()=>{ve()})})}function sn(){ve(),V=WA.ui.openPopup("phishing_instructionsPopup","ðŸ§‘â€ðŸ’» Quick! We saw one of the hackers going through this room! They are using phishing emails and dodgy QR codes to endanger students on campus! Before you chase after him, you should read these slides to learn how you can defend against Phishing.  ",[{label:"Got it!",className:"primary",callback:()=>ve()}])}function ve(){var e;V&&((e=V.close)==null||e.call(V),V=void 0)}let b,A;function ye(){var e,t;try{(e=b==null?void 0:b.close)==null||e.call(b)}catch{}b=void 0;try{(t=A==null?void 0:A.unsubscribe)==null||t.call(A)}catch{}A=void 0}function Ye(){var e,t;try{(e=b==null?void 0:b.close)==null||e.call(b)}catch{}b=WA.ui.openPopup("phishing_librarySpawnPopup","ðŸ“Œ Please proceed and talk to Professor Byte.",[{label:"OK",callback:ye}]);try{(t=A==null?void 0:A.unsubscribe)==null||t.call(A)}catch{}A=WA.room.area.onLeave("from-garden").subscribe(ye),setTimeout(()=>{ye()},5e3)}function an(){WA.onInit().then(()=>{WA.room.area.onEnter("from-garden").subscribe(Ye),setTimeout(()=>{WA.player.getPosition().then(()=>Ye())},250)})}let se;function cn(){const e="phishing_BrockPopup",t=()=>{se&&(se.close(),se=void 0)};WA.room.area.onEnter("phishing_Brock").subscribe(()=>{t();const n="ðŸ§‘â€ðŸ« Brock: Hey there! Before you move on, have you checked out all the phishing clues? Make sure youâ€™ve seen the email, QR code, and SMS examples â€” theyâ€™ll help you spot scams in the future!";se=WA.ui.openPopup(e,n,[{label:"Got it!",callback:()=>t()}])}),WA.room.area.onLeave("phishing_Brock").subscribe(t)}let R,x,O,He=!1;const Qe="billboard",ln="billboardPopup";function J(){var e;try{(e=R==null?void 0:R.close)==null||e.call(R)}catch{}R=void 0}function un(){He||(He=!0,WA.onInit().then(()=>{var e,t,n,o,r,i;try{(e=x==null?void 0:x.unsubscribe)==null||e.call(x)}catch{}try{(t=O==null?void 0:O.unsubscribe)==null||t.call(O)}catch{}x=WA.room.area.onEnter(Qe).subscribe(()=>{console.log("[billboard] enter"),J(),R=WA.ui.openPopup(ln,`ðŸ“œ The community billboard

âž¡ï¸ Move towards the ladder on the right and begin your adventure!`,[{label:"Close",className:"primary",callback:()=>J()}])}),O=WA.room.area.onLeave(Qe).subscribe(()=>{console.log("[billboard] leave"),J()}),(i=(o=(n=WA.room).onLeaveLayer)==null?void 0:(r=o.call(n,"**")).subscribe)==null||i.call(r,()=>J()),window.addEventListener("blur",J)}))}let Y;function pn(){WA.onInit().then(()=>{setTimeout(fn,50)})}function fn(){Fe(),Y=WA.ui.openPopup("spawnIntroPopup","ðŸ‘‹ Welcome! Use the Arrow Keys or WASD to move. Explore the map and look for Professor Byte for guidance. Tip: Walk close to objects (signs, boards, NPCs) to interact with them.",[{label:"Got it",className:"primary",callback:e=>{var t;try{(t=e.close)==null||t.call(e)}catch{}Fe()}}])}function Fe(){var e;if(Y){try{(e=Y.close)==null||e.call(Y)}catch{}Y=void 0}}let _,G,j,Ke=!1;const qe="instructions",hn="instructionsPopup";function dn(){Ke||(Ke=!0,WA.onInit().then(()=>{var e,t;try{(e=G==null?void 0:G.unsubscribe)==null||e.call(G)}catch{}try{(t=j==null?void 0:j.unsubscribe)==null||t.call(j)}catch{}G=WA.room.area.onEnter(qe).subscribe(()=>{me(),_=WA.ui.openPopup(hn,"ðŸ« Thank the heavens you're here! Brave student, Murdoch University is under a Cyber Attack! We need your help to protect the school against evildoers who wish us harm. Please proceed through the school and learn about how you can help us!",[{label:"Close",className:"primary",callback:()=>me()}])}),j=WA.room.area.onLeave(qe).subscribe(()=>{me()})}))}function me(){var e;try{(e=_==null?void 0:_.close)==null||e.call(_)}catch{}_=void 0}const gn="posterPopup";let v;function yn(e){var t;try{(t=v==null?void 0:v.close)==null||t.call(v)}catch{}v=WA.ui.openPopup(gn,e,[])}function mn(){var e;try{(e=v==null?void 0:v.close)==null||e.call(v)}catch{}v=void 0}function bn(){WA.room.area.onEnter("poster").subscribe(()=>{yn(`ðŸª§ You notice a faded poster: "Think Before You Click! Your Cyber Kingdom Depends On It."

ðŸ’­ You: (to yourself) 'Think before you click.' That's a good motto.

ðŸ“¢ Narrator: Always pause before clicking unknown links. Your vigilance protects your cyber kingdom!`)}),WA.room.area.onLeave("poster").subscribe(mn)}const An="usbdrivePopup";let w;function vn(e){var t;try{(t=w==null?void 0:w.close)==null||t.call(w)}catch{}w=WA.ui.openPopup(An,e,[])}function wn(){var e;try{(e=w==null?void 0:w.close)==null||e.call(w)}catch{}w=void 0}function Wn(){WA.room.area.onEnter("usbdrive").subscribe(()=>{vn(`ðŸ’¾ You spot a random USB drive on the floor.

ðŸ’­ You: Should I plug this into a PC and see what's inside?

ðŸ“¢ Narrator: Never plug in unknown USBs. They can hide malware that runs automatically. If you find one in real life, hand it to IT/Security instead of investigating it yourself.`)}),WA.room.area.onLeave("usbdrive").subscribe(wn)}const Pn="stickynotePopup";let W;function kn(e){var t;try{(t=W==null?void 0:W.close)==null||t.call(W)}catch{}W=WA.ui.openPopup(Pn,e,[])}function Sn(){var e;try{(e=W==null?void 0:W.close)==null||e.call(W)}catch{}W=void 0}function En(){WA.room.area.onEnter("stickynote").subscribe(()=>{kn(`ðŸ“ A sticky note is stuck to the monitor: â€œEmail PW: P@ssw0rd123â€.

ðŸ’­ You: Wahâ€¦ someone actually wrote their password here.

ðŸ“¢ Narrator: Donâ€™t write passwords on paper or share them. Use a password manager, create unique passphrases, and always enable MFA (multi-factor authentication).`)}),WA.room.area.onLeave("stickynote").subscribe(Sn)}const Cn="instructions_safeinternetpracticesPopup";let P;function Mn(e){var t;try{(t=P==null?void 0:P.close)==null||t.call(P)}catch{}P=WA.ui.openPopup(Cn,e,[])}function Ln(){var e;try{(e=P==null?void 0:P.close)==null||e.call(P)}catch{}P=void 0}function Tn(){WA.room.area.onEnter("instructions_safeinternetpractices").subscribe(()=>{Mn(`ðŸ›¡ï¸ Welcome to the Safe Internet Practices office!

â€¢ Explore the room and look for hidden clues (poster, USB drive, sticky note).
â€¢ Read your characterâ€™s thoughts and the narratorâ€™s tips.
â€¢ Learn to: think before you click, protect passwords, and avoid risky devices.

When youâ€™re done, proceed to the exit to continue your mission.`)}),WA.room.area.onLeave("instructions_safeinternetpractices").subscribe(Ln)}const h={poster:!1,usbdrive:!1,stickynote:!1,AmeliaZone:!1},In="to-hall",Rn="hall.tmj#from-canteen";function _n(){WA.onInit().then(()=>{console.log("[OfficeProgress] ready"),["poster","usbdrive","stickynote"].forEach(e=>{WA.room.area.onEnter(e).subscribe(()=>{console.log(`[OfficeProgress] ENTER ${e}`),h[e]||(h[e]=!0,Xe())})}),WA.room.area.onEnter("AmeliaZone").subscribe(()=>{console.log("[OfficeProgress] ENTER AmeliaZone"),h.AmeliaZone||(h.AmeliaZone=!0,Xe())}),WA.room.area.onEnter(In).subscribe(()=>{console.log("[OfficeProgress] ENTER EXIT, allDone =",ze()),ze()?WA.nav.goToRoom(Rn):WA.ui.openPopup("safeinternet_gate_popup",`ðŸš§ Hold up!

You still need to complete:
â€¢ ${Bn().join(`
â€¢ `)}

Find all 3 clues and talk to Amelia before leaving.`,[{label:"OK",className:"primary",callback:e=>e.close()}])})})}function ze(){return h.poster&&h.usbdrive&&h.stickynote&&h.AmeliaZone}function Bn(){const e=[];return h.poster||e.push("Old Security Poster"),h.usbdrive||e.push("USB Drive"),h.stickynote||e.push("Sticky Note"),h.AmeliaZone||e.push("Talk to Amelia (NPC)"),e}function Xe(){const e=[h.poster?"âœ… Poster":"â¬œ Poster",h.usbdrive?"âœ… USB":"â¬œ USB",h.stickynote?"âœ… Sticky":"â¬œ Sticky Note",h.AmeliaZone?"âœ… Amelia":"â¬œ Amelia"].join("   ");WA.ui.displayActionMessage({message:`Progress: ${e}`,callback:()=>{}})}let H;function Nn(){WA.onInit().then(()=>{console.log("[WA] Malware instructions ready"),WA.room.area.onEnter("malware_instructions").subscribe(()=>{xn()}),WA.room.area.onLeave("malware_instructions").subscribe(()=>{we()})})}function xn(){we(),H=WA.ui.openPopup("malware_instructionsPopup","ðŸ§‘â€ðŸ’» Congratulations on clearing the first room! But we have a long way to go before weâ€™re ready to really protect Murdoch... In this room, youâ€™ll learn more about Malware and the best ways to protect against it. To begin, go through the slides by pressing SPACE.",[{label:"Got it!",className:"primary",callback:()=>we()}])}function we(){var e;if(H){try{(e=H.close)==null||e.call(H)}catch{}H=void 0}}console.log("Script started");WA.onInit().then(async()=>{console.log("Scripting API ready"),await Dt(),Vt(),Yt(),Qt(),zt();const e=await On();console.log("[Router] mapId =",e||"(unknown)"),e==="garden"?(console.log("[Router] Initializing GARDEN featuresâ€¦"),un(),pn(),dn(),bn(),Wn(),En(),Tn(),_n()):e==="library"?(console.log("[Router] Initializing LIBRARY (Phishing) featuresâ€¦"),$t(),tn(),on(),rn(),an(),cn()):e==="canteen"?(console.log("[Router] Initializing CANTEEN (Malware) featuresâ€¦"),Nn()):console.warn("[Router] Unknown map; only common features started. Set a Tiled Map Property `mapId` (string) to enable map-specific inits.")});async function On(){var e,t,n;try{const r=decodeURIComponent(window.location.href).match(/\/([^\/?#]+)\.tmj/i);if(r!=null&&r[1])return r[1].toLowerCase()}catch{}try{const o=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),r=((o==null?void 0:o.url)??(o==null?void 0:o.name)??"").toString();if(r){const a=(r.split("/").pop()||r).toLowerCase();return a.endsWith(".tmj")?a.replace(/\.tmj$/,""):a}const i=o==null?void 0:o.properties,s=(n=i==null?void 0:i.find(a=>(a==null?void 0:a.name)==="mapId"))==null?void 0:n.value;if(typeof s=="string"&&s.trim())return s.trim().toLowerCase()}catch{}return""}
//# sourceMappingURL=main-24dd272a.js.map
