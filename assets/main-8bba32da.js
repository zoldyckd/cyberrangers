class he{constructor(t){this.properties=t??[]}get(t){const o=this.properties.filter(n=>n.name===t).map(n=>n.value);if(o.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(o.length!==0)return o[0]}getString(t){return this.getByType(t,"string")}getNumber(t){return this.getByType(t,"number")}getBoolean(t){return this.getByType(t,"boolean")}getByType(t,o){const n=this.get(t);if(n!==void 0){if(o!=="json"&&typeof n!==o)throw new Error('Expected property "'+t+'" to have type "'+o+'"');return n}}mustGetString(t){return this.mustGetByType(t,"string")}mustGetNumber(t){return this.mustGetByType(t,"number")}mustGetBoolean(t){return this.mustGetByType(t,"boolean")}mustGetByType(t,o){const n=this.get(t);if(n===void 0)throw new Error('Property "'+t+'" is missing');if(o!=="json"&&typeof n!==o)throw new Error('Expected property "'+t+'" to have type "'+o+'"');return n}getType(t){const o=this.properties.filter(n=>n.name===t).map(n=>n.type);if(o.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(o.length!==0)return o[0]}}const Ht="https://unpkg.com/@workadventure/scripting-api-extra@1.9.10/dist";class oo{constructor(t){this.name=t.name,this.x=t.x,this.y=t.y,this.properties=new he(t.properties)}get isReadable(){const t=this.properties.getString("readableBy");return t?WA.player.tags.includes(t):!0}get isWritable(){const t=this.properties.getString("writableBy");return t?WA.player.tags.includes(t):!0}}function mt(e){const t=e?"#"+e.join():"";WA.nav.openCoWebSite(Ht+"/configuration.html"+t,!0)}async function no(e,t){const o=await WA.room.getTiledMap(),n=new Map;return Vt(o.layers,n,e,t),n}function Vt(e,t,o,n){for(const r of e)if(r.type==="objectgroup"){for(const s of r.objects)if(s.type==="variable"||s.class==="variable"){if(o&&r.name!==o||n&&!n.includes(s.name))continue;t.set(s.name,new oo(s))}}else r.type==="group"&&Vt(r.layers,t,o,n)}let xe;async function ve(){return xe===void 0&&(xe=ro()),xe}async function ro(){return so(await WA.room.getTiledMap())}function so(e){const t=new Map;return zt(e.layers,"",t),t}function zt(e,t,o){for(const n of e)n.type==="group"?zt(n.layers,t+n.name+"/",o):(n.name=t+n.name,o.set(n.name,n))}async function qt(){const e=await ve(),t=[];for(const o of e.values())if(o.type==="objectgroup")for(const n of o.objects)(n.type==="area"||n.class==="area")&&t.push(n);return t}function io(e){let t=1/0,o=1/0,n=0,r=0;const s=e.data;if(typeof s=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let i=0;i<e.height;i++)for(let a=0;a<e.width;a++)s[a+i*e.width]!==0&&(t=Math.min(t,a),r=Math.max(r,a),o=Math.min(o,i),n=Math.max(n,i));return{top:o,left:t,right:r+1,bottom:n+1}}function Qt(e){let t=1/0,o=1/0,n=0,r=0;for(const s of e){const i=io(s);i.left<t&&(t=i.left),i.top<o&&(o=i.top),i.right>r&&(r=i.right),i.bottom>n&&(n=i.bottom)}return{top:o,left:t,right:r,bottom:n}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var ao=Object.prototype.toString,ye=Array.isArray||function(t){return ao.call(t)==="[object Array]"};function dt(e){return typeof e=="function"}function co(e){return ye(e)?"array":typeof e}function Te(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function gt(e,t){return e!=null&&typeof e=="object"&&t in e}function lo(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var uo=RegExp.prototype.test;function po(e,t){return uo.call(e,t)}var ho=/\S/;function fo(e){return!po(ho,e)}var yo={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function mo(e){return String(e).replace(/[&<>"'`=\/]/g,function(o){return yo[o]})}var go=/\s*/,bo=/\s+/,bt=/\s*=/,Ao=/\s*\}/,wo=/#|\^|\/|>|\{|&|=|!/;function vo(e,t){if(!e)return[];var o=!1,n=[],r=[],s=[],i=!1,a=!1,c="",u=0;function d(){if(i&&!a)for(;s.length;)delete r[s.pop()];else s=[];i=!1,a=!1}var f,C,Pe;function me(I){if(typeof I=="string"&&(I=I.split(bo,2)),!ye(I)||I.length!==2)throw new Error("Invalid tags: "+I);f=new RegExp(Te(I[0])+"\\s*"),C=new RegExp("\\s*"+Te(I[1])),Pe=new RegExp("\\s*"+Te("}"+I[1]))}me(t||m.tags);for(var p=new We(e),_,l,b,ge,ke,L;!p.eos();){if(_=p.pos,b=p.scanUntil(f),b)for(var Le=0,to=b.length;Le<to;++Le)ge=b.charAt(Le),fo(ge)?(s.push(r.length),c+=ge):(a=!0,o=!0,c+=" "),r.push(["text",ge,_,_+1]),_+=1,ge===`
`&&(d(),c="",u=0,o=!1);if(!p.scan(f))break;if(i=!0,l=p.scan(wo)||"name",p.scan(go),l==="="?(b=p.scanUntil(bt),p.scan(bt),p.scanUntil(C)):l==="{"?(b=p.scanUntil(Pe),p.scan(Ao),p.scanUntil(C),l="&"):b=p.scanUntil(C),!p.scan(C))throw new Error("Unclosed tag at "+p.pos);if(l==">"?ke=[l,b,_,p.pos,c,u,o]:ke=[l,b,_,p.pos],u++,r.push(ke),l==="#"||l==="^")n.push(ke);else if(l==="/"){if(L=n.pop(),!L)throw new Error('Unopened section "'+b+'" at '+_);if(L[1]!==b)throw new Error('Unclosed section "'+L[1]+'" at '+_)}else l==="name"||l==="{"||l==="&"?a=!0:l==="="&&me(b)}if(d(),L=n.pop(),L)throw new Error('Unclosed section "'+L[1]+'" at '+p.pos);return Po(Wo(r))}function Wo(e){for(var t=[],o,n,r=0,s=e.length;r<s;++r)o=e[r],o&&(o[0]==="text"&&n&&n[0]==="text"?(n[1]+=o[1],n[3]=o[3]):(t.push(o),n=o));return t}function Po(e){for(var t=[],o=t,n=[],r,s,i=0,a=e.length;i<a;++i)switch(r=e[i],r[0]){case"#":case"^":o.push(r),n.push(r),o=r[4]=[];break;case"/":s=n.pop(),s[5]=r[2],o=n.length>0?n[n.length-1][4]:t;break;default:o.push(r)}return t}function We(e){this.string=e,this.tail=e,this.pos=0}We.prototype.eos=function(){return this.tail===""};We.prototype.scan=function(t){var o=this.tail.match(t);if(!o||o.index!==0)return"";var n=o[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};We.prototype.scanUntil=function(t){var o=this.tail.search(t),n;switch(o){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,o),this.tail=this.tail.substring(o)}return this.pos+=n.length,n};function fe(e,t){this.view=e,this.cache={".":this.view},this.parent=t}fe.prototype.push=function(t){return new fe(t,this)};fe.prototype.lookup=function(t){var o=this.cache,n;if(o.hasOwnProperty(t))n=o[t];else{for(var r=this,s,i,a,c=!1;r;){if(t.indexOf(".")>0)for(s=r.view,i=t.split("."),a=0;s!=null&&a<i.length;)a===i.length-1&&(c=gt(s,i[a])||lo(s,i[a])),s=s[i[a++]];else s=r.view[t],c=gt(r.view,t);if(c){n=s;break}r=r.parent}o[t]=n}return dt(n)&&(n=n.call(this.view)),n};function y(){this.templateCache={_cache:{},set:function(t,o){this._cache[t]=o},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}y.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};y.prototype.parse=function(t,o){var n=this.templateCache,r=t+":"+(o||m.tags).join(":"),s=typeof n<"u",i=s?n.get(r):void 0;return i==null&&(i=vo(t,o),s&&n.set(r,i)),i};y.prototype.render=function(t,o,n,r){var s=this.getConfigTags(r),i=this.parse(t,s),a=o instanceof fe?o:new fe(o,void 0);return this.renderTokens(i,a,n,t,r)};y.prototype.renderTokens=function(t,o,n,r,s){for(var i="",a,c,u,d=0,f=t.length;d<f;++d)u=void 0,a=t[d],c=a[0],c==="#"?u=this.renderSection(a,o,n,r,s):c==="^"?u=this.renderInverted(a,o,n,r,s):c===">"?u=this.renderPartial(a,o,n,s):c==="&"?u=this.unescapedValue(a,o):c==="name"?u=this.escapedValue(a,o,s):c==="text"&&(u=this.rawValue(a)),u!==void 0&&(i+=u);return i};y.prototype.renderSection=function(t,o,n,r,s){var i=this,a="",c=o.lookup(t[1]);function u(C){return i.render(C,o,n,s)}if(c){if(ye(c))for(var d=0,f=c.length;d<f;++d)a+=this.renderTokens(t[4],o.push(c[d]),n,r,s);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")a+=this.renderTokens(t[4],o.push(c),n,r,s);else if(dt(c)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(o.view,r.slice(t[3],t[5]),u),c!=null&&(a+=c)}else a+=this.renderTokens(t[4],o,n,r,s);return a}};y.prototype.renderInverted=function(t,o,n,r,s){var i=o.lookup(t[1]);if(!i||ye(i)&&i.length===0)return this.renderTokens(t[4],o,n,r,s)};y.prototype.indentPartial=function(t,o,n){for(var r=o.replace(/[^ \t]/g,""),s=t.split(`
`),i=0;i<s.length;i++)s[i].length&&(i>0||!n)&&(s[i]=r+s[i]);return s.join(`
`)};y.prototype.renderPartial=function(t,o,n,r){if(n){var s=this.getConfigTags(r),i=dt(n)?n(t[1]):n[t[1]];if(i!=null){var a=t[6],c=t[5],u=t[4],d=i;c==0&&u&&(d=this.indentPartial(i,u,a));var f=this.parse(d,s);return this.renderTokens(f,o,n,d,r)}}};y.prototype.unescapedValue=function(t,o){var n=o.lookup(t[1]);if(n!=null)return n};y.prototype.escapedValue=function(t,o,n){var r=this.getConfigEscape(n)||m.escape,s=o.lookup(t[1]);if(s!=null)return typeof s=="number"&&r===m.escape?String(s):r(s)};y.prototype.rawValue=function(t){return t[1]};y.prototype.getConfigTags=function(t){return ye(t)?t:t&&typeof t=="object"?t.tags:void 0};y.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!ye(t))return t.escape};var m={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){we.templateCache=e},get templateCache(){return we.templateCache}},we=new y;m.clearCache=function(){return we.clearCache()};m.parse=function(t,o){return we.parse(t,o)};m.render=function(t,o,n,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+co(t)+'" was given as the first argument for mustache#render(template, view, partials)');return we.render(t,o,n,r)};m.escape=mo;m.Scanner=We;m.Context=fe;m.Writer=y;class Xt{constructor(t,o){this.template=t,this.state=o,this.ast=m.parse(t)}getValue(){return this.value===void 0&&(this.value=m.render(this.template,this.state)),this.value}onChange(t){const o=[];for(const n of this.getUsedVariables().values())o.push(this.state.onVariableChange(n).subscribe(()=>{const r=m.render(this.template,this.state);r!==this.value&&(this.value=r,t(this.value))}));return{unsubscribe:()=>{for(const n of o)n.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const t=new Set;return this.recursiveGetUsedVariables(this.ast,t),t}recursiveGetUsedVariables(t,o){for(const n of t){const r=n[0],s=n[1],i=n[4];["name","&","#","^"].includes(r)&&o.add(s),i!==void 0&&typeof i!="string"&&this.recursiveGetUsedVariables(i,o)}}}async function ko(){var e;const t=await qt();for(const o of t){const n=(e=o.properties)!==null&&e!==void 0?e:[];for(const r of n){if(r.type==="int"||r.type==="bool"||r.type==="object"||typeof r.value!="string")continue;const s=new Xt(r.value,WA.state);if(s.isPureString())continue;const i=s.getValue();await At(o.name,r.name,i),s.onChange(async a=>{await At(o.name,r.name,a)})}}}async function So(){var e;const t=await ve();for(const[o,n]of t.entries())if(n.type!=="objectgroup"){const r=(e=n.properties)!==null&&e!==void 0?e:[];for(const s of r){if(s.type==="int"||s.type==="bool"||s.type==="object"||typeof s.value!="string")continue;const i=new Xt(s.value,WA.state);if(i.isPureString())continue;const a=i.getValue();wt(o,s.name,a),i.onChange(c=>{wt(o,s.name,c)})}}}async function At(e,t,o){console.log(e),(await WA.room.area.get(e)).setProperty(t,o)}function wt(e,t,o){WA.room.setProperty(e,t,o),t==="visible"&&(o?WA.room.showLayer(e):WA.room.hideLayer(e))}const Eo="https://admin.workadventu.re/html";let Ye,ht=0,ft=0;function vt(e){if(WA.state[e.name]){let t=e.properties.mustGetString("openLayer");for(const o of t.split(`
`))WA.room.showLayer(o);t=e.properties.mustGetString("closeLayer");for(const o of t.split(`
`))WA.room.hideLayer(o)}else{let t=e.properties.mustGetString("openLayer");for(const o of t.split(`
`))WA.room.hideLayer(o);t=e.properties.mustGetString("closeLayer");for(const o of t.split(`
`))WA.room.showLayer(o)}}function Co(e){const t=e.properties.getString("openSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=$t(e.properties.mustGetString("openLayer").split(`
`));if(r>o)return;n=1-r/o}t&&WA.sound.loadSound(t).play({volume:n})}function _o(e){const t=e.properties.getString("closeSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=$t(e.properties.mustGetString("closeLayer").split(`
`));if(r>o)return;n=1-r/o}t&&WA.sound.loadSound(t).play({volume:n})}function Kt(e){return e.map(t=>Ye.get(t)).filter(t=>(t==null?void 0:t.type)==="tilelayer")}function $t(e){const t=Kt(e),o=Qt(t),n=((o.right-o.left)/2+o.left)*32,r=((o.bottom-o.top)/2+o.top)*32;return Math.sqrt(Math.pow(ht-n,2)+Math.pow(ft-r,2))}function Io(e){WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]?Co(e):_o(e),vt(e)}),vt(e)}function Wt(e,t,o,n){const r=e.name;let s,i,a=!1;const c=o.getString("tag");let u=!0;c&&!WA.player.tags.includes(c)&&(u=!1);const d=!!c;function f(){var l;s&&s.remove(),s=WA.ui.displayActionMessage({message:(l=o.getString("closeTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to close the door",callback:()=>{WA.state[t.name]=!1,C()}})}function C(){var l;s&&s.remove(),s=WA.ui.displayActionMessage({message:(l=o.getString("openTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to open the door",callback:()=>{WA.state[t.name]=!0,f()}})}function Pe(){let l;if(e.type==="tilelayer")l=Qt(Kt(t.properties.mustGetString("closeLayer").split(`
`)));else{if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)throw new Error(`Doorstep zone "${e.name}" is missing x, y, width or height`);l={top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}i=WA.room.website.create({name:"doorKeypad"+r,url:n+"/keypad.html#"+encodeURIComponent(r),position:{x:l.right*32,y:l.top*32,width:32*3,height:32*4},allowApi:!0})}function me(){i&&(WA.room.website.delete(i.name),i=void 0)}function p(){if(a=!0,o.getBoolean("autoOpen")&&u){WA.state[t.name]=!0;return}if(!WA.state[t.name]&&(d&&!u||!d)&&(o.getString("code")||o.getString("codeVariable"))){Pe();return}u&&(WA.state[t.name]?f():C())}function _(){a=!1,o.getBoolean("autoClose")&&(WA.state[t.name]=!1),s&&s.remove(),me()}e.type==="tilelayer"?(WA.room.onEnterLayer(r).subscribe(p),WA.room.onLeaveLayer(r).subscribe(_)):(WA.room.area.onEnter(r).subscribe(p),WA.room.area.onLeave(r).subscribe(_)),WA.state.onVariableChange(t.name).subscribe(()=>{a&&(!o.getBoolean("autoClose")&&WA.state[t.name]===!0&&f(),i&&WA.state[t.name]===!0&&me(),!o.getBoolean("autoOpen")&&WA.state[t.name]===!1&&C())})}function Mo(e){const t=e.properties.mustGetString("bellSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=Math.sqrt(Math.pow(e.x-ht,2)+Math.pow(e.y-ft,2));if(r>o)return;n=1-r/o}WA.sound.loadSound(t).play({volume:n})}function Lo(e){WA.state[e.name]===void 0&&(WA.state[e.name]=0),WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]&&Mo(e)})}function Pt(e,t,o){let n;const r=t.getString("bellPopup");if(o.type==="tilelayer"){const s=o.name;WA.room.onEnterLayer(s).subscribe(()=>{var i;r?n=WA.ui.openPopup(r,"",[{label:(i=t.getString("bellButtonText"))!==null&&i!==void 0?i:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.onLeaveLayer(s).subscribe(()=>{n&&(n.close(),n=void 0)})}else{const s=o.name;WA.room.area.onEnter(s).subscribe(()=>{var i;r?n=WA.ui.openPopup(r,"",[{label:(i=t.getString("bellButtonText"))!==null&&i!==void 0?i:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.area.onLeave(s).subscribe(()=>{n&&(n.close(),n=void 0)})}}async function xo(e){e=e??Eo;const t=await no();Ye=await ve();for(const o of t.values())o.properties.get("door")&&Io(o),o.properties.get("bell")&&Lo(o);for(const o of Ye.values()){const n=new he(o.properties),r=n.getString("doorVariable");if(r&&o.type==="tilelayer"){const i=t.get(r);if(i===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of layer "'+o.name+'"');Wt(o,i,n,e)}const s=n.getString("bellVariable");s&&o.type==="tilelayer"&&Pt(s,n,o)}for(const o of await qt()){const n=new he(o.properties),r=n.getString("doorVariable");if(r){const i=t.get(r);if(i===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of object "'+o.name+'"');Wt(o,i,n,e)}const s=n.getString("bellVariable");s&&Pt(s,n,o)}WA.player.onPlayerMove(o=>{ht=o.x,ft=o.y})}function To(e,t){const o=e.getString("bindVariable");if(o){const n=e.get("enterValue"),r=e.get("leaveValue"),s=e.getString("triggerMessage"),i=e.getString("tag");No(o,t,n,r,s,i)}}let Se;function No(e,t,o,n,r,s){s&&!WA.player.tags.includes(s)||(o!==void 0&&WA.room.onEnterLayer(t).subscribe(()=>{r?Se=WA.ui.displayActionMessage({type:"message",message:r,callback:()=>{WA.state[e]=o}}):WA.state[e]=o}),n!==void 0&&WA.room.onLeaveLayer(t).subscribe(()=>{WA.state[e]=n,Se&&(Se.remove().catch(i=>{console.error(i)}),Se=void 0)}))}async function Ro(){const e=await ve();for(const t of e.values()){const o=new he(t.properties);To(o,t.name)}}let kt;async function Go(e){const t=await WA.room.getTiledMap();e=e??Ht,kt=await ve();const o=t.layers.find(n=>n.name==="configuration");if(o){const r=new he(o.properties).getString("tag");(!r||WA.player.tags.includes(r))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(e+"/configuration.html",!0)});for(const s of kt.values()){const i=new he(s.properties),a=i.getString("openConfig");a&&s.type==="tilelayer"&&Oo(a.split(","),s.name,i)}}}function Oo(e,t,o){let n;const r=o.getString("openConfigAdminTag");let s=!0;r&&!WA.player.tags.includes(r)&&(s=!1);function i(){var c;n&&n.remove(),n=WA.ui.displayActionMessage({message:(c=o.getString("openConfigTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE or touch here to configure",callback:()=>mt(e)})}function a(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(t).subscribe(()=>{const c=o.getString("openConfigTrigger");s&&(c&&c==="onaction"?i():mt(e))}),WA.room.onLeaveLayer(t).subscribe(()=>{n&&n.remove(),a()})}function Bo(){return WA.onInit().then(()=>{xo().catch(e=>console.error(e)),Ro().catch(e=>console.error(e)),Go().catch(e=>console.error(e)),So().catch(e=>console.error(e)),ko().catch(e=>console.error(e))}).catch(e=>console.error(e))}let z;function jo(){WA.room.area.onEnter("clock").subscribe(()=>{const e=new Date,t=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");z&&z.close(),z=WA.ui.openPopup("clockPopup",`It's ${t}:${o}`,[])}),WA.room.area.onLeave("clock").subscribe(()=>{z&&(z.close(),z=void 0)})}let Ee;function Do(){const e=()=>{Ee&&(Ee.close(),Ee=void 0)};WA.room.area.onEnter("board").subscribe(()=>{e();const t="The bulletin board hums with strange energy. Five portals shimmer before you—choose your path: 💜 Malware — malicious code that corrupts, spies, and destroys • 🔵 Phishing/Quishing — fake messages or QR Codes that trick you into giving secrets • 🔴 Identity Theft — criminals using your identity • 🟡 xxxxxxxxxxxx • 💚 Password Security — strong, unique passwords and MFA to protect your accounts.";Ee=WA.ui.openPopup("boardPopup",t,[])}),WA.room.area.onLeave("board").subscribe(e)}let $;function Ne(){var e;if($){try{(e=$.close)==null||e.call($)}catch{}$=void 0}}function Uo(){var e,t;try{const o=(t=(e=WA.room.object)==null?void 0:e.get)==null?void 0:t.call(e,"MarvieZone");if(o&&o.properties){const n=o.properties;if(Array.isArray(n)){const r=n.find(s=>s.name==="marvieMessage"||s.name==="marviePopup");if(r!=null&&r.value)return String(r.value)}else if(n.marvieMessage)return String(n.marvieMessage)}}catch{}return["👋 Hi — I'm Marvie.","","Welcome to the Room of Malware.","Do you think you can find the 3 easter eggs around the map?","Tip: Check the walls, the chairs or the floor for suspicious objects."].join(`
`)}function Fo(){console.log("[Marvie] init"),WA.room.area.onEnter("MarvieZone").subscribe(()=>{Ne();const e=Uo();$=WA.ui.openPopup("marviePopup",e,[{label:"Got it",callback:()=>Ne()}])}),WA.room.area.onLeave("MarvieZone").subscribe(()=>{Ne()})}const Yo={library:{tasks:[{key:"phishing_SMSphishing",label:"SMS",area:"phishing_SMSphishing"},{key:"phishing_MurdochEmail",label:"MurdochEmail",area:"phishing_MurdochEmail"},{key:"phishing_QRcode",label:"QRcode",area:"phishing_QRcode"},{key:"phishing_instructions",label:"PPT Slides",area:"phishing_instructions"}],exitGate:{area:"to-canteen",nextRoom:"canteen.tmj#from-library",warnAnchorId:"phishing_gate_popup"}}},Ho={canteen:{tasks:[{key:"malware_instructions",label:"Slides",area:"malware_instructions"},{key:"malware_discord",label:"Discord",area:"malware_discord"},{key:"malware_usbdrive",label:"USB",area:"malware_usbdrive"},{key:"malware_trojan",label:"Trojan",area:"malware_trojan"}],exitGate:{area:"to-classroom",nextRoom:"classroom.tmj#from-canteen",warnAnchorId:"malware_gate_popup"}}},Vo={classroom:{tasks:[{key:"passwordsecurity_instructions",label:"Slides",area:"passwordsecurity_instructions"},{key:"passwordsecurity_lmsaccount",label:"LMS Account",area:"passwordsecurity_lmsaccount"},{key:"passwordsecurity_lmspasswordexpired",label:"Password Expired",area:"passwordsecurity_lmspasswordexpired"},{key:"passwordsecurity_unlockedpc",label:"Unlocked PC",area:"passwordsecurity_unlockedpc"}],exitGate:{area:"to-hall",nextRoom:"hall.tmj#from-classroom",warnAnchorId:"passwordsecurity_gate_popup"}}},zo={computerlab:{tasks:[{key:"idtheft_instructions",label:"Slides",area:"idtheft_instructions"},{key:"idtheft_sensitivepapers",label:"Sensitive Papers",area:"idtheft_sensitivepapers"},{key:"idtheft_customerservicecall",label:"Customer Service Call",area:"idtheft_customerservicecall"},{key:"idtheft_celebration",label:"Celebration",area:"idtheft_celebration"}],exitGate:{area:"to-office",nextRoom:"office.tmj#from-computerlab",warnAnchorId:"idtheft_gate_popup"}}},qo={hall:{tasks:[{key:"safeinternetpractices_instructions",label:"Slides",area:"safeinternetpractices_instructions"},{key:"safeinternetpractices_freewifi",label:"Free Wi-Fi",area:"safeinternetpractices_freewifi"},{key:"safeinternetpractices_fileuploads",label:"File Uploads",area:"safeinternetpractices_fileuploads"},{key:"safeinternetpractices_outdatedsoftware",label:"Outdated Software",area:"safeinternetpractices_outdatedsoftware"}],exitGate:{area:"to-computerlab",nextRoom:"computerlab.tmj#from-hall",warnAnchorId:"safeinternetpractices_gate_popup"}}},Qo={office:{tasks:[{key:"finalboss",label:"Face CipherX",area:"finalboss_cipherx"}]}},Xo={...Yo,...Ho,...Vo,...zo,...qo,...Qo},Jt="cr:goals:",yt=e=>`${Jt}${e}`;function Ko(e,t){try{localStorage.setItem(yt(e),JSON.stringify(t))}catch{}}function $o(e){try{const t=localStorage.getItem(yt(e));return t?JSON.parse(t):null}catch{return null}}function Jo(e){try{const t=[];for(let o=0;o<localStorage.length;o++){const n=localStorage.key(o);n&&n.startsWith(Jt)&&!n.endsWith(e)&&t.push(n)}t.forEach(o=>localStorage.removeItem(o))}catch{}}let M={},V=[],x,Re=0,Ae=!1,St="",g=null,Et=!1,Ce=!0,_e=null;const Zo=window.__CR_DEBUG__===!0;function en(){WA.onInit().then(async()=>{const e=await an()||"";if(!e){Me("[ProgressChecker] No mapId resolved.");return}if(St===e)return;St=e;const t=Xo[e];if(Ge(),Jo(e),!t){Me("[ProgressChecker] No config for map:",e);return}Me("[ProgressChecker] Init for map:",e),V=t.tasks;const o=$o(e);if(M={...Object.fromEntries(V.map(r=>[r.key,!1])),...o??{}},window.addEventListener("beforeunload",()=>Ge(),{passive:!0}),V.forEach(r=>{try{WA.room.area.onEnter(r.area).subscribe(()=>{Ae||M[r.key]||(M[r.key]=!0,Ko(e,M),on(),Ct()&&WA.ui.displayActionMessage({message:"✅ All tasks done! You may proceed to the exit.",callback:()=>{}}))})}catch(s){console.warn(`[ProgressChecker] area '${r.area}' not found on this map`,s)}}),t.exitGate){const{area:r,nextRoom:s,warnAnchorId:i}=t.exitGate;WA.room.area.onEnter(r).subscribe(()=>{if(Ae)return;if(Ct()){Ae=!0,Ge();try{WA.controls.disablePlayerControls()}catch{}try{localStorage.removeItem(yt(e))}catch{}setTimeout(()=>WA.nav.goToRoom(s),40);return}const a=Date.now();if(a-Re<500)return;Re=a;const c=tn();if(i)try{Ie(),x=WA.ui.openPopup(i,`🚧 Hold up!

You still need to complete:
• ${c.join(`
• `)}

Find all tasks in this room before leaving.`,[{label:"Close",className:"primary",callback:()=>Ie()}]);return}catch{}WA.ui.displayActionMessage({message:`🚧 Hold up! Missing: ${c.join(", ")}`,callback:()=>{}})}),WA.room.area.onLeave(r).subscribe(()=>{Ie(),Ae||(Re=0)})}sn()})}function Ct(){return V.every(e=>M[e.key])}function tn(){return V.filter(e=>!M[e.key]).map(e=>e.label)}function on(){if(!Zt()){const t=V.map(o=>M[o.key]?`✅ ${o.label}`:`⬜ ${o.label}`).join("   ");WA.ui.displayActionMessage({message:`Progress:  ${t}`,callback:()=>{}})}}function Ie(){var e;try{(e=x==null?void 0:x.close)==null||e.call(x)}catch{}x=void 0}function Ge(){Ie(),rn(),He()}function nn(){if(!document||!document.body)return!1;if(!Et){const e=document.createElement("style");e.id="cr-progress-hud-style",e.textContent=`
#cr-progress-hud {
  position: fixed;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  width: 240px;
  max-width: 36vw;
  background: rgba(22,24,40,0.85);
  color: #fff;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
  font-size: 14px;
  line-height: 1.35;
  border-radius: 14px;
  padding: 12px 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.35);
  z-index: 1000000;
  pointer-events: none;
  -webkit-backdrop-filter: blur(4px);
  backdrop-filter: blur(4px);
}
#cr-progress-hud .hdr {
  opacity: .85;
  text-transform: uppercase;
  letter-spacing: .06em;
  font-size: 11px;
  margin-bottom: 8px;
}
#cr-progress-hud .item {
  display: grid;
  grid-template-columns: 18px 1fr;
  align-items: center;
  gap: 8px;
  margin: 6px 0;
  opacity: .9;
}
#cr-progress-hud .box {
  width: 14px; height: 14px; border-radius: 4px;
  border: 2px solid rgba(255,255,255,.55);
  display: inline-block;
}
#cr-progress-hud .item.done .box {
  border-color: transparent;
  background: #4ade80;
  box-shadow: inset 0 0 0 2px rgba(0,0,0,.15);
}
#cr-progress-hud .label { user-select: none; }
@media (max-width: 900px) {
  #cr-progress-hud { right: 8px; width: 54vw; font-size: 13px; }
}
`,document.head.appendChild(e),Et=!0}return g||(g=document.createElement("div"),g.id="cr-progress-hud",g.style.display=Ce?"block":"none",document.body.appendChild(g)),!0}function Zt(){if(Ae)return!0;if(!nn())return Me("[ProgressChecker] HUD skipped (body not ready yet)."),!1;const e=['<div class="hdr">Progress</div>',...V.map(t=>`<div class="item ${!!M[t.key]?"done":""}">
        <span class="box"></span>
        <span class="label">${t.label}</span>
      </div>`)].join("");return g&&(g.innerHTML=e),!0}function rn(){try{g==null||g.remove()}catch{}g=null}function sn(){let e=0;const t=20;He(),_e=window.setInterval(()=>{e++,(Zt()||e>=t)&&He()},200)}function He(){_e!==null&&(window.clearInterval(_e),_e=null)}window.addEventListener("keydown",e=>{e.key.toLowerCase()==="p"&&(Ce=!Ce,g&&(g.style.display=Ce?"block":"none"))});async function an(){var e,t,o;try{const n=decodeURIComponent(location.href).match(/\/([^\/?#]+)\.tmj/i);if(n!=null&&n[1])return n[1].toLowerCase()}catch{}try{const n=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),r=n==null?void 0:n.properties,s=(o=r==null?void 0:r.find(i=>(i==null?void 0:i.name)==="mapId"))==null?void 0:o.value;if(typeof s=="string"&&s.trim())return s.trim().toLowerCase()}catch{}return""}function Me(...e){Zo&&console.log(...e)}let T;const _t="phishing_QRcode",cn="phishing_QRcodePopup";function ln(){WA.onInit().then(()=>{WA.room.area.onEnter(_t).subscribe(()=>{Oe(),T=WA.ui.openPopup(cn,"🍗 You spot a poster in the library:“FREE NUGGETS FOR LIFE – Scan Me!” Your friend insists it looks real, but scanning random QR codes can lead to fake websites or data theft. What would you do? Press SPACE to help!",[{label:"Got it",callback:()=>Oe()}])}),WA.room.area.onLeave(_t).subscribe(()=>{Oe()})})}function Oe(){var e;try{T&&((e=T.close)==null||e.call(T),T=void 0)}catch{T=void 0}}let N;const It="phishing_MurdochEmail",un="phishing_MurdochEmailPopup";function pn(){WA.onInit().then(()=>{WA.room.area.onEnter(It).subscribe(()=>{Be(),N=WA.ui.openPopup(un,`📧 You received an email: “Your university fees are overdue. Click here to pay immediately.”

⚠️ This looks suspicious... What would you do? Press SPACE to help!`,[{label:"Got it",callback:()=>Be()}])}),WA.room.area.onLeave(It).subscribe(()=>{Be()})})}function Be(){var e;try{N&&((e=N.close)==null||e.call(N),N=void 0)}catch{N=void 0}}let R;const Mt="phishing_SMSphishing",dn="phishing_SMSphishingPopup";function hn(){WA.onInit().then(()=>{WA.room.area.onEnter(Mt).subscribe(()=>{je(),R=WA.ui.openPopup(dn,"🔗 You received a message: “Your Murdoch account needs verification! Click here: https://tinyurl.com/murdoch-reset. Shortened links can hide where they actually lead. Always check the real destination before clicking! What would you do? Press SPACE to help!",[{label:"Got it",callback:()=>je()}])}),WA.room.area.onLeave(Mt).subscribe(()=>{je()})})}function je(){var e;try{R&&((e=R.close)==null||e.call(R),R=void 0)}catch{R=void 0}}let J;function fn(){WA.onInit().then(()=>{console.log("[WA] Phishing sign instructions ready"),WA.room.area.onEnter("phishing_instructions").subscribe(()=>{yn()}),WA.room.area.onLeave("phishing_instructions").subscribe(()=>{Ve()})})}function yn(){Ve(),J=WA.ui.openPopup("phishing_instructionsPopup","🧑‍💻 Quick! We saw one of the hackers going through this room! They are using phishing emails and dodgy QR codes to endanger students on campus! Before you chase after him, you should read these slides to learn how you can defend against Phishing.  ",[{label:"Got it!",className:"primary",callback:()=>Ve()}])}function Ve(){var e;J&&((e=J.close)==null||e.call(J),J=void 0)}let A,w;function De(){var e,t;try{(e=A==null?void 0:A.close)==null||e.call(A)}catch{}A=void 0;try{(t=w==null?void 0:w.unsubscribe)==null||t.call(w)}catch{}w=void 0}function Lt(){var e,t;try{(e=A==null?void 0:A.close)==null||e.call(A)}catch{}A=WA.ui.openPopup("phishing_librarySpawnPopup","📌 Please proceed and talk to Professor Byte.",[{label:"OK",callback:De}]);try{(t=w==null?void 0:w.unsubscribe)==null||t.call(w)}catch{}w=WA.room.area.onLeave("from-garden").subscribe(De),setTimeout(()=>{De()},5e3)}function mn(){WA.onInit().then(()=>{WA.room.area.onEnter("from-garden").subscribe(Lt),setTimeout(()=>{WA.player.getPosition().then(()=>Lt())},250)})}let G,q,Q,xt=!1;const Tt="billboard",gn="billboardPopup";function be(){var e;try{(e=G==null?void 0:G.close)==null||e.call(G)}catch{}G=void 0}function bn(){xt||(xt=!0,WA.onInit().then(()=>{var e,t,o,n,r,s;try{(e=q==null?void 0:q.unsubscribe)==null||e.call(q)}catch{}try{(t=Q==null?void 0:Q.unsubscribe)==null||t.call(Q)}catch{}q=WA.room.area.onEnter(Tt).subscribe(()=>{console.log("[billboard] enter"),be(),G=WA.ui.openPopup(gn,`📜 The community billboard

➡️ Move towards the ladder on the right and begin your adventure!`,[{label:"Close",className:"primary",callback:()=>be()}])}),Q=WA.room.area.onLeave(Tt).subscribe(()=>{console.log("[billboard] leave"),be()}),(s=(n=(o=WA.room).onLeaveLayer)==null?void 0:(r=n.call(o,"**")).subscribe)==null||s.call(r,()=>be()),window.addEventListener("blur",be)}))}let Z;function An(){WA.onInit().then(()=>{setTimeout(wn,50)})}function wn(){Nt(),Z=WA.ui.openPopup("spawnIntroPopup","👋 Welcome! Use the Arrow Keys or WASD to move. Explore the map and look for Professor Byte for guidance. Tip: Walk close to objects (signs, boards, NPCs) to interact with them.",[{label:"Got it",className:"primary",callback:e=>{var t;try{(t=e.close)==null||t.call(e)}catch{}Nt()}}])}function Nt(){var e;if(Z){try{(e=Z.close)==null||e.call(Z)}catch{}Z=void 0}}let O,X,K,Rt=!1;const Gt="instructions",vn="instructionsPopup";function Wn(){Rt||(Rt=!0,WA.onInit().then(()=>{var e,t;try{(e=X==null?void 0:X.unsubscribe)==null||e.call(X)}catch{}try{(t=K==null?void 0:K.unsubscribe)==null||t.call(K)}catch{}X=WA.room.area.onEnter(Gt).subscribe(()=>{Ue(),O=WA.ui.openPopup(vn,"🏫 Thank the heavens you're here! ${playerName}, Murdoch University is under a Cyber Attack! We need your help to protect the school against evildoers who wish us harm. Please proceed through the school and learn about how you can help us!",[{label:"Close",className:"primary",callback:()=>Ue()}])}),K=WA.room.area.onLeave(Gt).subscribe(()=>{Ue()})}))}function Ue(){var e;try{(e=O==null?void 0:O.close)==null||e.call(O)}catch{}O=void 0}const Pn="posterPopup";let v;function kn(e){var t;try{(t=v==null?void 0:v.close)==null||t.call(v)}catch{}v=WA.ui.openPopup(Pn,e,[])}function Sn(){var e;try{(e=v==null?void 0:v.close)==null||e.call(v)}catch{}v=void 0}function En(){WA.room.area.onEnter("poster").subscribe(()=>{kn(`🪧 You notice a faded poster: "Think Before You Click! Your Cyber Kingdom Depends On It."

💭 You: (to yourself) 'Think before you click.' That's a good motto.

📢 Narrator: Always pause before clicking unknown links. Your vigilance protects your cyber kingdom!`)}),WA.room.area.onLeave("poster").subscribe(Sn)}const Cn="usbdrivePopup";let W;function _n(e){var t;try{(t=W==null?void 0:W.close)==null||t.call(W)}catch{}W=WA.ui.openPopup(Cn,e,[])}function In(){var e;try{(e=W==null?void 0:W.close)==null||e.call(W)}catch{}W=void 0}function Mn(){WA.room.area.onEnter("usbdrive").subscribe(()=>{_n(`💾 You spot a random USB drive on the floor.

💭 You: Should I plug this into a PC and see what's inside?

📢 Narrator: Never plug in unknown USBs. They can hide malware that runs automatically. If you find one in real life, hand it to IT/Security instead of investigating it yourself.`)}),WA.room.area.onLeave("usbdrive").subscribe(In)}const Ln="stickynotePopup";let P;function xn(e){var t;try{(t=P==null?void 0:P.close)==null||t.call(P)}catch{}P=WA.ui.openPopup(Ln,e,[])}function Tn(){var e;try{(e=P==null?void 0:P.close)==null||e.call(P)}catch{}P=void 0}function Nn(){WA.room.area.onEnter("stickynote").subscribe(()=>{xn(`📝 A sticky note is stuck to the monitor: “Email PW: P@ssw0rd123”.

💭 You: Wah… someone actually wrote their password here.

📢 Narrator: Don’t write passwords on paper or share them. Use a password manager, create unique passphrases, and always enable MFA (multi-factor authentication).`)}),WA.room.area.onLeave("stickynote").subscribe(Tn)}const Rn="instructions_safeinternetpracticesPopup";let k;function Gn(e){var t;try{(t=k==null?void 0:k.close)==null||t.call(k)}catch{}k=WA.ui.openPopup(Rn,e,[])}function On(){var e;try{(e=k==null?void 0:k.close)==null||e.call(k)}catch{}k=void 0}function Bn(){WA.room.area.onEnter("instructions_safeinternetpractices").subscribe(()=>{Gn(`🛡️ Welcome to the Safe Internet Practices office!

• Explore the room and look for hidden clues (poster, USB drive, sticky note).
• Read your character’s thoughts and the narrator’s tips.
• Learn to: think before you click, protect passwords, and avoid risky devices.

When you’re done, proceed to the exit to continue your mission.`)}),WA.room.area.onLeave("instructions_safeinternetpractices").subscribe(On)}const h={poster:!1,usbdrive:!1,stickynote:!1,AmeliaZone:!1},jn="to-hall",Dn="hall.tmj#from-canteen";function Un(){WA.onInit().then(()=>{console.log("[OfficeProgress] ready"),["poster","usbdrive","stickynote"].forEach(e=>{WA.room.area.onEnter(e).subscribe(()=>{console.log(`[OfficeProgress] ENTER ${e}`),h[e]||(h[e]=!0,Bt())})}),WA.room.area.onEnter("AmeliaZone").subscribe(()=>{console.log("[OfficeProgress] ENTER AmeliaZone"),h.AmeliaZone||(h.AmeliaZone=!0,Bt())}),WA.room.area.onEnter(jn).subscribe(()=>{console.log("[OfficeProgress] ENTER EXIT, allDone =",Ot()),Ot()?WA.nav.goToRoom(Dn):WA.ui.openPopup("safeinternet_gate_popup",`🚧 Hold up!

You still need to complete:
• ${Fn().join(`
• `)}

Find all 3 clues and talk to Amelia before leaving.`,[{label:"OK",className:"primary",callback:e=>e.close()}])})})}function Ot(){return h.poster&&h.usbdrive&&h.stickynote&&h.AmeliaZone}function Fn(){const e=[];return h.poster||e.push("Old Security Poster"),h.usbdrive||e.push("USB Drive"),h.stickynote||e.push("Sticky Note"),h.AmeliaZone||e.push("Talk to Amelia (NPC)"),e}function Bt(){const e=[h.poster?"✅ Poster":"⬜ Poster",h.usbdrive?"✅ USB":"⬜ USB",h.stickynote?"✅ Sticky":"⬜ Sticky Note",h.AmeliaZone?"✅ Amelia":"⬜ Amelia"].join("   ");WA.ui.displayActionMessage({message:`Progress: ${e}`,callback:()=>{}})}let ee;function Yn(){WA.onInit().then(()=>{console.log("[WA] Malware instructions ready"),WA.room.area.onEnter("malware_instructions").subscribe(()=>{Hn()}),WA.room.area.onLeave("malware_instructions").subscribe(()=>{ze()})})}function Hn(){ze(),ee=WA.ui.openPopup("malware_instructionsPopup","🧑‍💻 Congratulations on clearing the first room! But we have a long way to go before we’re ready to really protect Murdoch... In this room, you’ll learn more about Malware and the best ways to protect against it. To begin, go through the slides by pressing SPACE.",[{label:"Got it!",className:"primary",callback:()=>ze()}])}function ze(){var e;if(ee){try{(e=ee.close)==null||e.call(ee)}catch{}ee=void 0}}let B;const jt="malware_discord",Vn="malware_discordPopup";function zn(){WA.onInit().then(()=>{console.log("[WA] Malware Discord popup ready"),WA.room.area.onEnter(jt).subscribe(()=>{qn()}),WA.room.area.onLeave(jt).subscribe(()=>{qe()})})}function qn(){qe(),B=WA.ui.openPopup(Vn,`💬 Your friend DMs you on Discord about a program that “unlocks Discord Nitro Premium for life” and says it’s safe because they used it.

What would you do? Press SPACE to help!`,[{label:"Got it!",className:"primary",callback:()=>qe()}])}function qe(){var e;try{(e=B==null?void 0:B.close)==null||e.call(B)}catch{}B=void 0}let j;const Dt="malware_usbdrive",Qn="malware_usbdrivePopup";function Xn(){WA.onInit().then(()=>{console.log("[WA] Malware USB Drive popup ready"),WA.room.area.onEnter(Dt).subscribe(()=>{Kn()}),WA.room.area.onLeave(Dt).subscribe(()=>{Qe()})})}function Kn(){Qe(),j=WA.ui.openPopup(Qn,"💾 You spot a USB drive on the canteen floor. You are curious about what’s inside. What would you do? Press SPACE to help!",[{label:"Got it!",className:"primary",callback:()=>Qe()}])}function Qe(){var e;try{(e=j==null?void 0:j.close)==null||e.call(j)}catch{}j=void 0}let D;const Ut="malware_trojan",$n="malware_trojanPopup";function Jn(){WA.onInit().then(()=>{console.log("[WA] Malware Trojan popup ready"),WA.room.area.onEnter(Ut).subscribe(()=>{Zn()}),WA.room.area.onLeave(Ut).subscribe(()=>{Xe()})})}function Zn(){Xe(),D=WA.ui.openPopup($n,"🛡️ A system alert appears: “Windows Defender Virus Protection found an unwanted app (type: Trojan).” What would you do? Press SPACE to help!",[{label:"Got it!",className:"primary",callback:()=>Xe()}])}function Xe(){var e;try{(e=D==null?void 0:D.close)==null||e.call(D)}catch{}D=void 0}let te;function er(){WA.onInit().then(()=>{console.log("[WA] Password Security instructions ready"),WA.room.area.onEnter("passwordsecurity_instructions").subscribe(()=>{tr()}),WA.room.area.onLeave("passwordsecurity_instructions").subscribe(()=>{Ke()})})}function tr(){Ke(),te=WA.ui.openPopup("passwordsecurity_instructionsPopup","🧑‍🏫 Thank goodness you’re here! The hackers are after our passwords, and we need your help to secure them! ➡️ To begin, go through the slides to learn more about Passsword Security by pressing SPACE. Afterwards, help us defend the school!",[{label:"Got it!",className:"primary",callback:()=>Ke()}])}function Ke(){var e;if(te){try{(e=te.close)==null||e.call(te)}catch{}te=void 0}}let oe;function or(){WA.onInit().then(()=>{console.log("[WA] Password Security - LMS Account scenario ready"),WA.room.area.onEnter("passwordsecurity_lmsaccount").subscribe(()=>{nr()}),WA.room.area.onLeave("passwordsecurity_lmsaccount").subscribe(()=>{$e()})})}function nr(){$e(),oe=WA.ui.openPopup("passwordsecurity_lmsaccountPopup","👩‍💻 Your classmate Joyce says she forgot her LMS login and asks to borrow your account to check the quiz questions. What would you do? Press SPACE to help!",[{label:"Let's decide!",className:"primary",callback:()=>$e()}])}function $e(){var e;if(oe){try{(e=oe.close)==null||e.call(oe)}catch{}oe=void 0}}let ne;function rr(){WA.onInit().then(()=>{console.log("[WA] Password Security - LMS Password Expired scenario ready"),WA.room.area.onEnter("passwordsecurity_lmspasswordexpired").subscribe(()=>{sr()}),WA.room.area.onLeave("passwordsecurity_lmspasswordexpired").subscribe(()=>{Je()})})}function sr(){Je(),ne=WA.ui.openPopup("passwordsecurity_lmspasswordexpiredPopup","🔑 Your LMS password has just expired! The system is asking you to create a new one. How will you choose your new password? Press SPACE to help!",[{label:"Let's find out!",className:"primary",callback:()=>Je()}])}function Je(){var e;if(ne){try{(e=ne.close)==null||e.call(ne)}catch{}ne=void 0}}let re;function ir(){WA.onInit().then(()=>{console.log("[WA] Password Security - Unlocked PC scenario ready"),WA.room.area.onEnter("passwordsecurity_unlockedpc").subscribe(()=>{ar()}),WA.room.area.onLeave("passwordsecurity_unlockedpc").subscribe(()=>{Ze()})})}function ar(){Ze(),re=WA.ui.openPopup("passwordsecurity_unlockedpcPopup","💻 You notice an unlocked PC with a teacher’s account signed in — an Excel sheet is open showing login details! What should you do? Press SPACE to help!",[{label:"I'll check!",className:"primary",callback:()=>Ze()}])}function Ze(){var e;if(re){try{(e=re.close)==null||e.call(re)}catch{}re=void 0}}let U;function cr(){WA.onInit().then(()=>{console.log("[WA] Safe Internet Practices – Free Wi-Fi ready"),WA.room.area.onEnter("safeinternetpractices_freewifi").subscribe(()=>lr()),WA.room.area.onLeave("safeinternetpractices_freewifi").subscribe(()=>et())})}function lr(){et(),U=WA.ui.openPopup("safeinternetpractices_freewifiPopup","📶 In the hall, you spot a wall sign offering **Free Wi-Fi**. Nearby, you see open networks like “HallGuest” and “CampusFree”. How would you get online safely? Press SPACE to help!",[{label:"Got it",className:"primary",callback:()=>et()}])}function et(){var e;try{(e=U==null?void 0:U.close)==null||e.call(U)}catch{}U=void 0}let F;function ur(){WA.onInit().then(()=>{console.log("[WA] Safe Internet Practices – File Uploads ready"),WA.room.area.onEnter("safeinternetpractices_fileuploads").subscribe(()=>pr()),WA.room.area.onLeave("safeinternetpractices_fileuploads").subscribe(()=>tt())})}function pr(){tt(),F=WA.ui.openPopup("safeinternetpractices_fileuploadsPopup","💬 Hey! Can you help me edit this PDF file? I found some free online tools that lets you upload and edit PDFs easily! What would you do? Press SPACE to help!",[{label:"Let’s see!",className:"primary",callback:()=>tt()}])}function tt(){var e;try{(e=F==null?void 0:F.close)==null||e.call(F)}catch{}F=void 0}let Y;function dr(){WA.onInit().then(()=>{console.log("[WA] Safe Internet Practices – Outdated Software ready"),WA.room.area.onEnter("safeinternetpractices_outdatedsoftware").subscribe(()=>hr()),WA.room.area.onLeave("safeinternetpractices_outdatedsoftware").subscribe(()=>ot())})}function hr(){ot(),Y=WA.ui.openPopup("safeinternetpractices_outdatedsoftwarePopup","🧑‍💻 You saw a laptop on the floor, you picked it up and open your browser to check your bank account, but a message appears saying your browser needs an update. What will you do? Press SPACE to help!",[{label:"Let’s decide!",className:"primary",callback:()=>ot()}])}function ot(){var e;try{(e=Y==null?void 0:Y.close)==null||e.call(Y)}catch{}Y=void 0}let H;function fr(){WA.onInit().then(()=>{console.log("[WA] Safe Internet Practices instructions ready"),WA.room.area.onEnter("safeinternetpractices_instructions").subscribe(()=>yr()),WA.room.area.onLeave("safeinternetpractices_instructions").subscribe(()=>nt())})}function yr(){nt(),H=WA.ui.openPopup("safeinternetpractices_instructionsPopup","🏫 You’ve made it through 3 of the topics, well done! But there’s more we need to learn before we’re truly ready to defeat the malicious actors. Please press SPACE to talk to me before you explore the room!",[{label:"Got it!",className:"primary",callback:()=>nt()}])}function nt(){var e;try{(e=H==null?void 0:H.close)==null||e.call(H)}catch{}H=void 0}let se;function mr(){WA.onInit().then(()=>{console.log("[WA] ID Theft instructions ready"),WA.room.area.onEnter("idtheft_instructions").subscribe(()=>{gr()}),WA.room.area.onLeave("idtheft_instructions").subscribe(()=>{rt()})})}function gr(){rt(),se=WA.ui.openPopup("idtheft_instructionsPopup","🧑‍🏫 It’s hard to believe it but we seem to be in the last topic! We’re almost ready to face the hackers and help defend the school! One of the students recently fell victim to ID Theft via a phishing email, and they’re now being impersonated online! Press SPACE to read the slides on the basics you need to learn first. Afterwards, please check the PC nearby to see if you can help.",[{label:"Got it!",className:"primary",callback:()=>rt()}])}function rt(){var e;if(se){try{(e=se.close)==null||e.call(se)}catch{}se=void 0}}let ie;function br(){WA.onInit().then(()=>{console.log("[WA] ID Theft - Sensitive Papers ready"),WA.room.area.onEnter("idtheft_sensitivepapers").subscribe(()=>{Ar()}),WA.room.area.onLeave("idtheft_sensitivepapers").subscribe(()=>{st()})})}function Ar(){st(),ie=WA.ui.openPopup("idtheft_sensitivepapersPopup","📄 While cleaning out some old documents from your locker, you notice a pile of old bank statements. They might contain sensitive information — how you handle them could determine whether your data stays safe! Press SPACE to investigate what happens next.",[{label:"Got it!",className:"primary",callback:()=>st()}])}function st(){var e;if(ie){try{(e=ie.close)==null||e.call(ie)}catch{}ie=void 0}}let ae;function wr(){WA.onInit().then(()=>{console.log("[WA] ID Theft - Customer Service Call ready"),WA.room.area.onEnter("idtheft_customerservicecall").subscribe(()=>{vr()}),WA.room.area.onLeave("idtheft_customerservicecall").subscribe(()=>{it()})})}function vr(){it(),ae=WA.ui.openPopup("idtheft_customerservicecallPopup","📞 You notice a phone lying on the floor and decide to pick it up. As soon as you do, you receive a call — the person on the other end claims to be a bank representative who somehow knows your name and partial account number. Press SPACE to find out what happens next!",[{label:"Got it!",className:"primary",callback:()=>it()}])}function it(){var e;if(ae){try{(e=ae.close)==null||e.call(ae)}catch{}ae=void 0}}let ce;function Wr(){WA.onInit().then(()=>{console.log("[WA] ID Theft - Celebration ready"),WA.room.area.onEnter("idtheft_celebration").subscribe(()=>{Pr()}),WA.room.area.onLeave("idtheft_celebration").subscribe(()=>{at()})})}function Pr(){at(),ce=WA.ui.openPopup("idtheft_celebrationPopup","📸 You’ve just passed your driving test and gotten your new license! Excited, you picked up your phone from the bench and took a selfie with it in hand to celebrate your big achievement. But should you post it online? Press SPACE to see what happens next!",[{label:"Got it!",className:"primary",callback:()=>at()}])}function at(){var e;if(ce){try{(e=ce.close)==null||e.call(ce)}catch{}ce=void 0}}let S,E,Ft=!1;const eo="from-computerlab",kr="finalboss_spawnPopup";function Fe(){var e,t;try{(e=S==null?void 0:S.close)==null||e.call(S)}catch{}S=void 0;try{(t=E==null?void 0:E.unsubscribe)==null||t.call(E)}catch{}E=void 0}function Yt(){var e,t;if(!Ft){Ft=!0;try{(e=S==null?void 0:S.close)==null||e.call(S)}catch{}S=WA.ui.openPopup(kr,"🏢 You’ve entered the main office… it feels quiet, too quiet. Something’s off — the source of all the attacks must be here. Move forward carefully.",[{label:"Got it!",className:"primary",callback:Fe}]);try{(t=E==null?void 0:E.unsubscribe)==null||t.call(E)}catch{}E=WA.room.area.onLeave(eo).subscribe(Fe),setTimeout(()=>Fe(),6e3)}}function Sr(){WA.onInit().then(()=>{console.log("[WA] Final Boss spawn ready"),WA.room.area.onEnter(eo).subscribe(Yt),setTimeout(()=>{WA.player.getPosition().then(()=>Yt())},250)})}let le;function Er(){WA.onInit().then(()=>{console.log("[WA] Final Boss CipherX ready"),WA.room.area.onEnter("finalboss_cipherx").subscribe(()=>{Cr()}),WA.room.area.onLeave("finalboss_cipherx").subscribe(()=>{ct()})})}function Cr(){ct(),le=WA.ui.openPopup("finalboss_cipherxPopup","👾 So... you’ve made it through every challenge — phishing, malware, weak passwords, stolen identities. You’ve been a thorn in my plans for far too long! Press SPACE to face CipherX in the final showdown quiz!",[{label:"I’m ready!",className:"primary",callback:()=>ct()}])}function ct(){var e;if(le){try{(e=le.close)==null||e.call(le)}catch{}le=void 0}}let ue;function _r(){WA.onInit().then(()=>{console.log("[WA] Ending message ready"),WA.room.area.onEnter("endingmessage").subscribe(()=>{Ir()}),WA.room.area.onLeave("endingmessage").subscribe(()=>{lt()})})}function Ir(){lt(),ue=WA.ui.openPopup("endingmessagePopup","🏆 Congratulations, Cyber Ranger! You’ve defeated CipherX and restored peace to Murdoch University. Thanks to your actions, students can now browse, click, and share safely once again. Please move to the right towards the stairs and complete the survey. ",[{label:"Finish!",className:"primary",callback:()=>lt()}])}function lt(){var e;if(ue){try{(e=ue.close)==null||e.call(ue)}catch{}ue=void 0}}let pe;function Mr(){WA.onInit().then(()=>{console.log("[WA] Survey area ready"),WA.room.area.onEnter("survey").subscribe(()=>{Lr()}),WA.room.area.onLeave("survey").subscribe(()=>{ut()})})}function Lr(){ut(),pe=WA.ui.openPopup("surveyPopup","📝 Final Step: Please proceed to complete the post-game survey to help us improve Cyber Rangers! Press SPACE to begin.",[{label:"Open Survey",className:"primary",callback:()=>ut()}])}function ut(){var e;if(pe){try{(e=pe.close)==null||e.call(pe)}catch{}pe=void 0}}let de;function xr(){WA.onInit().then(()=>{console.log("[WA] Final Boss instructions ready"),WA.room.area.onEnter("finalboss_instructions").subscribe(()=>{Tr()}),WA.room.area.onLeave("finalboss_instructions").subscribe(()=>{pt()})})}function Tr(){pt();const e=WA.player.name||"Cyber Ranger";de=WA.ui.openPopup("finalboss_instructionsPopup",`🧑‍🏫 Welcome to the Final Challenge, ${e}!
Your mission in this room is simple: Find CipherX, defeat him and proceed to the stairs to finish. Good luck! This is where everything you've learned comes together!`,[{label:"Got it!",className:"primary",callback:()=>pt()}])}function pt(){var e;if(de){try{(e=de.close)==null||e.call(de)}catch{}de=void 0}}console.log("Script started");WA.onInit().then(async()=>{var t,o,n,r,s,i,a,c,u,d;console.log("Scripting API ready"),await Bo();try{(o=(t=WA.controls).turnOffWebcam)==null||o.call(t),(r=(n=WA.controls).turnOffMicrophone)==null||r.call(n),(i=(s=WA.controls).disableWebcam)==null||i.call(s),(c=(a=WA.controls).disableMicrophone)==null||c.call(a),(d=(u=WA.controls).disablePlayerProximityMeeting)==null||d.call(u)}catch(f){console.warn("[WA] Could not disable A/V overlay:",f)}jo(),Do(),Fo(),en();const e=await Nr();console.log("[Router] mapId =",e||"(unknown)"),e==="garden"?(console.log("[Router] Initializing GARDEN features…"),bn(),An(),Wn(),En(),Mn(),Nn(),Bn(),Un()):e==="library"?(console.log("[Router] Initializing LIBRARY (Phishing) features…"),ln(),pn(),hn(),fn(),mn()):e==="canteen"?(console.log("[Router] Initializing CANTEEN (Malware) features…"),Yn(),zn(),Xn(),Jn()):e==="classroom"?(console.log("[Router] Initializing CLASSROOM (Password Security) features…"),er(),or(),rr(),ir()):e==="computerlab"?(console.log("[Router] Initializing COMPUTER LAB (ID Theft) features…"),mr(),br(),wr(),Wr()):e==="hall"?(console.log("[Router] Initializing HALL (Safe Internet Practices) features…"),cr(),ur(),dr(),fr()):e==="office"?(console.log("[Router] Initializing OFFICE (Final Boss) features…"),Sr(),Er(),_r(),Mr(),xr()):console.warn("[Router] Unknown map; only common features started. Set a Tiled Map Property `mapId` (string) to enable map-specific inits.")});async function Nr(){var e,t,o;try{const r=decodeURIComponent(window.location.href).match(/\/([^\/?#]+)\.tmj/i);if(r!=null&&r[1])return r[1].toLowerCase()}catch{}try{const n=await((t=(e=WA.room).getTiledMap)==null?void 0:t.call(e)),r=((n==null?void 0:n.url)??(n==null?void 0:n.name)??"").toString();if(r){const a=(r.split("/").pop()||r).toLowerCase();return a.endsWith(".tmj")?a.replace(/\.tmj$/,""):a}const s=n==null?void 0:n.properties,i=(o=s==null?void 0:s.find(a=>(a==null?void 0:a.name)==="mapId"))==null?void 0:o.value;if(typeof i=="string"&&i.trim())return i.trim().toLowerCase()}catch{}return""}
//# sourceMappingURL=main-8bba32da.js.map
