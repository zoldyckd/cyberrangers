/// <reference types="@workadventure/iframe-api-typings" />

let popupRef: any | undefined;

export function initMalwareInstructions() {
  WA.onInit().then(() => {
    console.log("[WA] Malware instructions ready");

    // Show popup when entering the instructions area
    WA.room.area.onEnter("malware_instructions").subscribe(() => {
      openPopup();
    });

    // Close popup when leaving the area
    WA.room.area.onLeave("malware_instructions").subscribe(() => {
      closePopup();
    });
  });
}

function openPopup() {
  // Prevent duplicates
  closePopup();

  popupRef = WA.ui.openPopup(
    "malware_instructionsPopup",
    "🧑‍💻 Congratulations on clearing the first room! But we have a long way to go before we’re ready to really protect Murdoch... In this room, you’ll learn more about Malware and the best ways to protect against it. To begin, go through the slides by pressing SPACE.",
    [
      {
        label: "Got it!",
        className: "primary",
        callback: () => closePopup(),
      },
    ]
  );
}

function closePopup() {
  if (popupRef) {
    try {
      popupRef.close?.();
    } catch {}
    popupRef = undefined;
  }
}
